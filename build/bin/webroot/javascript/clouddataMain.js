require.config({baseUrl:"/javascript",waitSeconds:0,urlArgs:"bust="+(new Date).getTime(),paths:{jquery:"lib/jquery/jquery.min",underscore:"lib/underscore/underscore-min",nicescroll:"vendor/jquery.nicescroll/jquery.nicescroll.min",store2:"lib/store/dist/store2.min",Q:"lib/q/q",backbone:"lib/backbone/backbone-min",wreqr:"lib/backbone.wreqr/lib/backbone.wreqr.min",tpl:"lib/requirejs-tpl/tpl",text:"lib/requirejs-text/text",marionette:"lib/backbone.marionette/lib/backbone.marionette.min",jquery_ui:"vendor/jquery-ui/jquery-ui.min",easing:"lib/jquery-easing/jquery.easing.min",i18n:"lib/i18next/i18next.amd.withJQuery.min",jquery_event_drag:"lib/slickgrid/lib/jquery.event.drag-2.2",slickgrid_core:"lib/slickgrid/slick.core",slickgrid:"lib/slickgrid/slick.grid",slick_rowselect:"lib/slickgrid/plugins/slick.rowselectionmodel",slick_checkbox:"vendor/plugin/slick.checkboxselectcolumn",moment:"lib/moment/moment","moment-timezone":"lib/moment-timezone/builds/moment-timezone-with-data.min",zeroclipboard:"lib/zeroclipboard/dist/ZeroClipboard.min",daterangepicker:"vendor/bootstrap-daterangepicker/daterangepicker",pnotify:"vendor/pnotify/pnotify.core","pnotify.buttons":"vendor/pnotify/pnotify.buttons","pnotify.nonblock":"vendor/pnotify/pnotify.nonblock","visualcaptcha.jquery":"vendor/visualcaptcha.jquery/visualcaptcha.jquery",validate:"lib/jquery.validation/dist/jquery.validate.min",scrollTo:"lib/jquery.scrollTo/jquery.scrollTo.min",pace:"lib/pace/pace.min","jquery-sortable":"lib/jquery-sortable/source/js/jquery-sortable-min",basic:"core/basic",data:"core/basic/data",event:"core/basic/event",net:"core/basic/net",view:"core/basic/view",other:"core/basic/other",dispatcher:"core/functions/Dispatcher",U:"core/functions/Utils",Storage:"core/functions/Storage",Timezone:"core/functions/Timezone",Cookie:"core/functions/Cookie",Logger:"core/functions/Logger",State:"core/functions/State",app:"core/functions/App",formatter:"core/functions/Formatter",language:"core/functions/Language",UI:"core/functions/UI",layout:"core/layout",container:"core/container",component:"core/component",emptyView:"core/component/empty/view",store:"core/store",extend:"core/extend",Captcha:"core/functions/Captcha",C:"config/Config",API:"config/API",semanticui:"../semanticui/dist/semantic",semanticui_accordion:"../semanticui/dist/components/accordion.min",semanticui_checkbox:"../semanticui/dist/components/checkbox.min",semanticui_dimmer:"../semanticui/dist/components/dimmer.min",semanticui_dropdown:"../semanticui/dist/components/dropdown.min",semanticui_form:"../semanticui/dist/components/form.min",semanticui_modal:"../semanticui/dist/components/modal.min",semanticui_popup:"../semanticui/dist/components/popup.min",semanticui_progress:"../semanticui/dist/components/progress.min",semanticui_search:"../semanticui/dist/components/search.min",semanticui_dropdown2:"../semanticui/dist/components/select2.min",semanticui_site:"../semanticui/dist/components/site.min",semanticui_state:"../semanticui/dist/components/state.min",semanticui_tab:"../semanticui/dist/components/tab.min",semanticui_transition:"../semanticui/dist/components/transition.min",semanticui_visibility:"../semanticui/dist/components/visibility.min",com_fun:"modules/common/function",jsonview:"lib/jquery-jsonview/dist/jquery.jsonview",spinjs:"lib/spinjs/spin"},shim:{main:{deps:[],exports:"main"},jquery:{deps:[],exports:"jQuery"},"pnotify.buttons":{deps:["pnotify"]},"pnotify.nonblock":{deps:["pnotify"]},nicescroll:{deps:["jquery"]},"jquery-sortable":{deps:["jquery"]},jquery_event_drag:{deps:["jquery"]},underscore:{deps:[],exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},marionette:{deps:["backbone"],exports:"Marionette"},wreqr:{deps:["backbone"]},easing:{deps:["jquery"],exports:"easing"},i18n:{deps:["jquery"],exports:"i18n"},scrollTo:{deps:["jquery"]},slickgrid_core:{deps:["jquery"],exports:"slickgrid_core"},slickgrid:{deps:["jquery_ui","slickgrid_core","jquery_event_drag"],exports:"Slick"},slick_rowselect:{deps:["slickgrid"]},slick_checkbox:{deps:["slickgrid"]},moment:{exports:"moment",init:function(){return window.moment=this.moment,this.moment}},"moment-timezone":{deps:["moment"],exports:"moment-timezone"},semanticui:{deps:["jquery"]},semanticui_accordion:{deps:["jquery"]},semanticui_api:{deps:["jquery"]},semanticui_checkbox:{deps:["jquery"]},semanticui_dimmer:{deps:["jquery"]},semanticui_dropdown:{deps:["jquery"]},semanticui_form:{deps:["jquery"]},semanticui_nag:{deps:["jquery"]},semanticui_popup:{deps:["jquery"]},semanticui_progress:{deps:["jquery"]},semanticui_rating:{deps:["jquery"]},semanticui_search:{deps:["jquery"]},semanticui_dropdown2:{deps:["jquery"]},semanticui_shape:{deps:["jquery"]},semanticui_sidebar:{deps:["jquery"]},semanticui_site:{deps:["jquery"]},semanticui_state:{deps:["jquery"]},semanticui_tab:{deps:["jquery"]},semanticui_transition:{deps:["jquery"]},semanticui_video:{deps:["jquery"]},semanticui_visibility:{deps:["jquery"]},semanticui_modal:{deps:["semanticui_transition","semanticui_dimmer"],exports:"semanticui_modal"},jsonview:{deps:["jquery"]}}}),define("main",function(e){return function(){var t;return t||e.main}}(this)),define("app",["backbone","marionette"],function(e){var t=new e.Marionette.Application;return window.Application=t,t}),define("config/App",[],function(){return{isDebug:!1,isProduct:!0}}),define("config/User",[],function(){return{AppId:"",SessionToken:"",Timezone:"Asia/Shanghai"}}),define("config/Ajax",[],function(){return{TIMEOUT:2e4,HTTPHEADER:{}}}),define("config/UI",[],function(){return{SlickGrid:{editable:!0,headerRowHeight:46,rowHeight:40,autoEdit:!1,enableCellNavigation:!0,asyncEditorLoading:!1,forceFitColumns:!1},Table:{table_class:"ui single line sortable table",header_class:"",body_class:"",header_cell_class:"",cell_class:"",display_header:!0,row_color:!0}}}),define("config/Filter",[],function(){return{String:[{name:"=",value:"eq"},{name:"!=",value:"ne"},{name:"exists",value:"exists"},{name:"start with",value:"start with"}],Number:[{name:">",value:"gt"},{name:">=",value:"gte"},{name:"<",value:"lt"},{name:"<=",value:"lte"},{name:"=",value:"eq"},{name:"!=",value:"ne"},{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}],Boolean:[{name:"=",value:"eq"},{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}],Date:[{name:"before",value:"before"},{name:"after",value:"after"},{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}],File:[{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}],GeoPoint:[{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}],Array:[{name:"exists",value:"exists"},{name:"not exists",value:"not exists"},{name:"contains value",value:"contains"},{name:"does not contain value",value:"not contains"},{name:"contains one of",value:"in"},{name:"does not contain any of",value:"nin"}],Object:[{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}],Pointer:[{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}],ACL:[{name:"exists",value:"exists"},{name:"not exists",value:"not exists"}]}}),define("Storage",["store2"],function(e){return window.store2=e,{get:function(t){return e.local.get(t)},set:function(t,i){e.local.set(t,i)},remove:function(t){e.local.remove(t)},clear:function(){e.local.clearAll()}}}),function(e){"function"==typeof define&&define.amd?define("lang/en",["moment"],e):"object"==typeof exports?module.exports=e(require("../moment")):e(window.moment)}(function(e){return e.locale("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"YYYY-MM-DD",LL:"MMM D",LLL:"LL HH:mm",LLLL:"YYYY-MM-DD HH:mm:ss",ll:"MMM D",lll:"LL HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10,i=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+i}})}),function(e){"function"==typeof define&&define.amd?define("lang/zh",["moment"],e):"object"==typeof exports?module.exports=e(require("../moment")):e(window.moment)}(function(e){return e.locale("zh",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY-MM-DD HH:mm:ss",l:"YYYY-MM-DD",ll:"MMMD日",lll:"ll HH:mm",llll:"YYYY-MM-DD HH:mm:ss"},meridiem:function(e,t){var i=100*e+t;return 600>i?"凌晨":900>i?"早上":1130>i?"上午":1230>i?"中午":1800>i?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var t,i;return t=e().startOf("week"),i=this.unix()-t.unix()>=604800?"[下]":"[本]",0===this.minutes()?i+"dddAh点整":i+"dddAh点mm"},lastWeek:function(){var t,i;return t=e().startOf("week"),i=this.unix()<t.unix()?"[上]":"[本]",0===this.minutes()?i+"dddAh点整":i+"dddAh点mm"},sameElse:"LL"},ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"},week:{dow:1,doy:4}})}),function(e){"function"==typeof define&&define.amd?define("lang/ja",["moment"],e):"object"==typeof exports?module.exports=e(require("../moment")):e(window.moment)}(function(e){return e.locale("ja",{months:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"日曜日_月曜日_火曜日_水曜日_木曜日_金曜日_土曜日".split("_"),weekdaysShort:"日_月_火_水_木_金_土".split("_"),weekdaysMin:"日_月_火_水_木_金_土".split("_"),longDateFormat:{LT:"Ah時m分",L:"YYYY/MM/DD",LL:"M月D日",LLL:"M月D日LT",LLLL:"YYYY年M月D日LT dddd"},meridiem:function(e){return 12>e?"午前":"午後"},calendar:{sameDay:"[今日] LT",nextDay:"[明日] LT",nextWeek:"[来週]dddd LT",lastDay:"[昨日] LT",lastWeek:"[前週]dddd LT",sameElse:"L"},relativeTime:{future:"%s後",past:"%s前",s:"数秒",m:"1分",mm:"%d分",h:"1時間",hh:"%d時間",d:"1日",dd:"%d日",M:"1ヶ月",MM:"%dヶ月",y:"1年",yy:"%d年"}})}),define("language",["moment","jquery","i18n","Storage","config/App","semanticui_dropdown"],function(e,t,i,n,o){var a={zh:"zh",ja:"ja"},s={langCodes:{en:"en",en_US:"en",zh:"zh",zh_CN:"zh",zh_SG:"zh",zh_TW:"zh_TW",zh_HK:"zh_TW",ja:"ja",de:"de",ru:"ru",pt:"pt_PT",pt_PT:"pt_PT",pt_BR:"pt_BR",es:"es",es_ES:"es",es_AR:"es_419",es_BO:"es_419",es_CO:"es_419",es_CL:"es_419",es_CR:"es_419",es_DO:"es_419",es_EC:"es_419",es_GT:"es_419",es_HN:"es_419",es_MX:"es_419",es_NI:"es_419",es_PY:"es_419",es_PA:"es_419",es_PE:"es_419",es_PR:"es_419",es_SV:"es_419",es_UY:"es_419",es_VE:"es_419"},langNames:{en:"English",zh:"中文",zh_CN:"中文简体",zh_TW:"中文繁体",ja:"日本語",de:"Deutsch",ru:"Русский язык",pt:"Português",nl:"Nederlands",it:"Italiano",fr:"Français",es:"Español"},lowercase:{en:"en_us",zh:"zh_cn"},init:function(e){this.setDefaultLanguage("component",e)},i18n:function(e){return i.t(e)||i.t(e+".default")||""},_getCurLangCode:function(){return"undefined"!=typeof window.navigator.language?window.navigator.language:window.navigator.browserLanguage},getCurLangCode:function(){var e=this,t=n.get("language");if(t)return t;var i=e.langCodes,o="en_US",a=e._getCurLangCode().replace("-","_");return"undefined"!=typeof i[a]?o=i[a]:a.indexOf("_")>-1&&(a=a.split("_")[0],"undefined"!=typeof i[a]&&(o=i[a])),o},getLowerCase:function(e){return e=e||"en",this.lowercase[e]||"en_us"},getLangName:function(e){return this.langNames[e]},setLanguage:function(i,s,r){var l="/locales/__lng__/__ns__.json?t="+(new Date).getTime();o.isProduct||(l="/front/locales/__lng__/__ns__.json"),i=i||this.getCurLangCode(),n.set("language",i);var c=a[i]||"en";n.set("moment",c),e.locale(c),t.i18n.init({lng:i,resGetPath:l,parseMissingKey:function(){return""},objectTreeKeyHandler:function(){return""},ns:s||"component"},function(){r&&"function"==typeof r&&require(["lang/en","lang/zh","lang/ja"],function(){t("#language-menu").dropdown({action:"select",onChange:function(e){n.set("language",e),window.location.reload()}}),r()})})},setDefaultLanguage:function(e,t){var i=this.getCurLangCode()||"en";this.setLanguage(i,e,t)}};return s}),function(e){"function"==typeof define&&define.amd?define("pnotify.buttons",["jquery","pnotify"],e):e(jQuery,PNotify)}(function(e,t){t.prototype.options.buttons={closer:!0,closer_hover:!0,sticker:!0,sticker_hover:!0,labels:{close:"Close",stick:"Stick"}},t.prototype.modules.buttons={myOptions:null,closer:null,sticker:null,init:function(t,i){var n=this;this.myOptions=i,t.elem.on({mouseenter:function(){!n.myOptions.sticker||t.options.nonblock&&t.options.nonblock.nonblock||n.sticker.trigger("pnotify_icon").css("visibility","visible"),!n.myOptions.closer||t.options.nonblock&&t.options.nonblock.nonblock||n.closer.css("visibility","visible")},mouseleave:function(){n.myOptions.sticker_hover&&n.sticker.css("visibility","hidden"),n.myOptions.closer_hover&&n.closer.css("visibility","hidden")}}),this.sticker=e("<div />",{"class":"ui-pnotify-sticker",css:{cursor:"pointer",visibility:i.sticker_hover?"hidden":"visible"},click:function(){t.options.hide=!t.options.hide,t.options.hide?t.queueRemove():t.cancelRemove(),e(this).trigger("pnotify_icon")}}).bind("pnotify_icon",function(){e(this).children().removeClass(t.styles.pin_up+" "+t.styles.pin_down).addClass(t.options.hide?t.styles.pin_up:t.styles.pin_down)}).append(e("<span />",{"class":t.styles.pin_up,title:i.labels.stick})).prependTo(t.container),(!i.sticker||t.options.nonblock&&t.options.nonblock.nonblock)&&this.sticker.css("display","none"),this.closer=e("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",visibility:i.closer_hover?"hidden":"visible"},click:function(){t.remove(!1),n.sticker.css("visibility","hidden"),n.closer.css("visibility","hidden")}}).append(e("<i />",{"class":t.styles.closer,title:i.labels.close})).prependTo(t.container),(!i.closer||t.options.nonblock&&t.options.nonblock.nonblock)&&this.closer.css("display","none")},update:function(e,t){this.myOptions=t,!t.closer||e.options.nonblock&&e.options.nonblock.nonblock?this.closer.css("display","none"):t.closer&&this.closer.css("display","block"),!t.sticker||e.options.nonblock&&e.options.nonblock.nonblock?this.sticker.css("display","none"):t.sticker&&this.sticker.css("display","block"),this.sticker.trigger("pnotify_icon"),t.sticker_hover?this.sticker.css("visibility","hidden"):e.options.nonblock&&e.options.nonblock.nonblock||this.sticker.css("visibility","visible"),t.closer_hover?this.closer.css("visibility","hidden"):e.options.nonblock&&e.options.nonblock.nonblock||this.closer.css("visibility","visible")}},e.extend(t.styling.jqueryui,{closer:"ui-icon ui-icon-close",pin_up:"ui-icon ui-icon-pin-w",pin_down:"ui-icon ui-icon-pin-s"}),e.extend(t.styling.bootstrap2,{closer:"icon-remove",pin_up:"icon-pause",pin_down:"icon-play"}),e.extend(t.styling.bootstrap3,{closer:"icon remove",pin_up:"glyphicon glyphicon-pause",pin_down:"glyphicon glyphicon-play"}),e.extend(t.styling.fontawesome,{closer:"fa fa-times",pin_up:"fa fa-pause",pin_down:"fa fa-play"})}),define("Logger",["language","jquery","pnotify","app","Storage","pnotify.buttons"],function(e,t,i,n,o){function a(e){function t(e){return e=e||o.get("language")||"en",/en/i.test(e)?"en_us/index.html":"zh_cn/index.html"}var i=window.location.hostname;window.location.href=/^localhost/.test(i)?"/login":"/"+t(e)+"?error=session-expire"}var s={};return s.info=function(t,n){t=n&&1==n.doI18n?e.i18n(t):t||"Info",new i({text:t,type:"info",delay:1e3})},s.warning=function(t,n){t=n&&1==n.doI18n?e.i18n(t):t||"Warning",new i({text:t,type:"warning",delay:3e3})},s.success=function(t,n){t=n&&1==n.doI18n?e.i18n(t):t||"Success",new i({text:t,type:"success",icon:"icon check circle",delay:3e3,mouse_reset:!1,buttons:{closer:!0,closer_hover:!1}})},s.error=function(t,s){var r,l,c;if(t instanceof Error)l="Error",r=t.message;else if(t.statusText||t.status){if(l=t.status,t.status&&(200==t.status||201==t.status))return!1;if(t.responseText)try{var d=JSON.parse(t.responseText);r=d.errorMessage||e.i18n("error.net."+d.errorCode),401==t.status&&(c=o.get("language"),n.User.clearUserData(),a(c))}catch(u){r=t.statusText}else if(0==t.status&&"timeout"==t.statusText)r=e.i18n("error.net.0");else{if(0==t.status&&"abort"==t.statusText)return!1;r=t.status+" "+t.statusText}}else l="Error",r=s&&1==s.doI18n?e.i18n(t):t;new i({title:"error",text:r,type:"error",icon:"icon warning sign",delay:3e3,mouse_reset:!1,buttons:{closer:!0,closer_hover:!1}})},s}),define("U",["app","Storage","Logger","language","underscore","jquery","moment"],function(e,t,i,n,o,a,s){return{Clone:function(e,t){var i=this;if("object"==typeof e){var n=null!=e&&e.sort?[]:{};for(var o in e)o!=t&&(n[o]=i.Clone(e[o],t));return n}return"function"==typeof e?(new e).constructor:e},UC_First:function(e){var t=e.toLowerCase(),i=t.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)});return i},jumpTo:function(e){window.location.href=e},changeHash:function(e){e.hash&&(window.location.hash=e.hash),e.reload&&location.reload()},secToHou:function(e){var t=Math.floor(e),i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),o=t-3600*i-60*n;return{hour:i,minute:n,second:o}},formatAxis:function(e){var i=[];return s.locale(t.get("moment")),o.forEach(e,function(e){if(/^(\d{4})(\d{2})(\d{2})(\d{2})?$/.test(e)){if(RegExp.$4)var t=s(RegExp.$2+"/"+RegExp.$3+" "+RegExp.$4+":00","MM/DD HH:mm").format("lll");else var t=s(RegExp.$2+"/"+RegExp.$3,"MM/DD").format("ll");i.push(t)}else i.push(/^(\d{2})$/.test(e)?RegExp.$1:e)}),i},getLength:function(e){for(var t=0,i=e.length,n=-1,o=0;i>o;o++)n=e.charCodeAt(o),t+=n>=0&&128>=n?1:3;return t},forceRender:function(){var e=document.body;e.style.cssText+=";-webkit-transform:rotateZ(0deg)",e.offsetHeight,e.style.cssText+=";-webkit-transform:none"},isImage:function(e){return e?/^image\//.test(e.type):!1},parseUrl:function(e){return/^(http|https):\/\//.test(e)?e:"https://"+e},strEllip:function(e,t){var i=e.length;if(t>=2*i)return e;t-=3;for(var n=0;i>n&&t>0;)escape(e.charAt(n)).length>4&&t--,t--,n++;return t>0?e:e.substring(0,n)+"..."},ParseError:function(e,t,o,a,s){if(!e||!o||!t)return i.error(n.i18n("error"));try{var r="{"!=e.responseText.charAt(0)?e:JSON.parse(e.responseText);if(r&&(r.errorCode||r.status)){r.errorCode=r.errorCode?r.errorCode:r.status;var l=t+"."+o+"."+r.errorCode,c=t+".error";400!=e.status&&(r.errorMessage="Sever Error  "+r.errorCode),"function"==typeof a?a(e,s):a&&r.errorCode in a?a[r.errorCode](e,s):a&&a["default"]?a["default"](e,s):i.error(n.i18n(l)?n.i18n(l):r.errorMessage?r.errorMessage:n.i18n(c))}else i.error(text)}catch(d){i.error(n.i18n("error"))}},goTo:function(e,t,i){window.location.hash=e+(t?"/"+t:"")+(i?"/"+i:"")},navigateTo:function(t,i,n){e.Router.navigate(t+(i?"/"+i:"")+(n?"/"+n:""))},normalize:function(e){var t={ios:"iOS",android:"Android","app store":"App Store","google play":"Google Play"};return t[e.toLowerCase()]||e},parseCurrentUrl:function(){var e={origin:window.location.origin,pathname:window.location.pathname,module:"dashboard",appId:"",hash:window.location.hash,url:window.location.href},t=e.pathname.match(/^(.*?)\/(\w+)\/?/);t&&t.length>2&&(e.module=t[2]);var i=e.pathname.match(/\/apps\/(\w+)/);return i&&i.length>1&&(e.appId=i[1]),""==e.appId||/\/apps\/(\w+)/.test(window.location.href)||(e.url=e.url.replace(e.module,e.module+"/apps/"+e.appId)),e},getCreditCardFullType:function(e){var t=!1;return/^5[1-5][0-9]{14}$/.test(e)?t="MasterCard":/^4[0-9]{12}(?:[0-9]{3})?$/.test(e)?t="Visa":/^3[47][0-9]{13}$/.test(e)?t="American Express":/^(?:2131|1800|35\d{3})\d{11}$/.test(e)?t="JCB":/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/.test(e)?t="Diners Club":/^6(?:011|5[0-9]{2})[0-9]{12}$/.test(e)&&(t="Discover"),t},getCreditCardType:function(e){var t=!1;return/^5[1-5]/.test(e)?t="mastercard":/^4/.test(e)?t="visa":/^3[47]/.test(e)?t="ae":/^(?:2131|1800|35)/.test(e)?t="jcb":/^3(?:0[0-5]|[68])/.test(e)?t="dinner":/^6(?:011|5)/.test(e)&&(t="discover"),t},getPixelRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(Math.round(window.devicePixelRatio)||1)/t}}}),define("C",["config/App","config/User","config/Ajax","config/UI","config/Filter","U"],function(e,t,i,n,o,a){function s(e,t,i){return"undefined"==typeof e[t[i]]?!1:"undefined"!=typeof t[i+1]?s(e[t[i]]||{},t,i+1):e[t[i]]}function r(e,t,i,n){return"undefined"==typeof e[i[n]]&&(e[i[n]]={}),"undefined"==typeof i[n+1]?(e[i[n]]=t,t):void r(e[i[n]]||{},t,i,n+1)}var l={App:e,Ajax:i,User:t,UI:n,Filter:o},c={};return c.set=function(e,t){var i=e.split(".");return r(l,t,i,0)},c.get=function(e,t){var i=e.split("."),n=s(l,i,0);return t?a.Clone(n):n},c}),define("dispatcher",["U","underscore","backbone"],function(e,t,i){var n={};n.on=function(e,t,n,o){var a,s=e.split(".");switch(a=s.length>1?s[0]:"Event"){case"Event":i.Wreqr.radio.channel(o||"global").vent.on(s[1]||s[0],t,n);break;case"Command":i.Wreqr.radio.channel(o||"global").commands.setHandler(s[1],t,n);break;case"Request":i.Wreqr.radio.channel(o||"global").reqres.setHandler(s[1],t,n);break;default:throw new Error("None support Message Type")}};var o=function(e,t){var n,o=t.split(".");switch(n=o.length>1?o[0]:"Event"){case"Event":i.Wreqr.radio.channel(e||"global").vent.off(o[1]||o[0]);break;case"Command":i.Wreqr.radio.channel(e||"global").commands.removeHandler(o[1]);break;case"Request":i.Wreqr.radio.channel(e||"global").reqres.removeHandler(o[1]);break;default:throw new Error("None support Message Type")}};return n.off=function(e,i){t.isArray(i)?t.forEach(i,function(t){o(t,e)}):o(i||"global",e)},n.execute=function(e,n,o){t.isArray(o)?t.forEach(o,function(t){i.Wreqr.radio.channel(t).commands.execute(e,n)}):i.Wreqr.radio.channel(o||"global").commands.execute(e,n)},n.trigger=function(e,n,o){t.isArray(o)?t.forEach(o,function(t){i.Wreqr.radio.channel(t).vent.trigger(e,n)}):i.Wreqr.radio.channel(o||"global").vent.trigger(e,n)},n.request=function(e,t,n){return i.Wreqr.radio.channel(n||"global").reqres.request(e,t)},n}),define("API",["C","U"],function(e){var t={},i=document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:""),n="2.0",o={App:i+"/"+n+"/apps",Data:i+"/"+n+"/",Class:i+"/"+n+"/classes",User:i+"/"+n+"/users",Product:i+"/"+n+"/products",Passport:i+"/"+n+"/passport",Installation:i+"/"+n+"/installations",Role:i+"/"+n+"/roles",OrgUsers:i+"/"+n+"/orgUsers",Users:i+"/"+n+"/",Files:i+"/"+n+"/files",Schema:i+"/"+n+"/schemas",Country:i+"/"+n+"/location/country",Lang:i+"/"+n+"/location/lang",captcha:i+"/"+n+"/captcha/",Email:i+"/"+n+"/",DataIE:i+"/"+n+"/dataie",Pay:i+"/"+n+"/pay",SMS:i+"/"+n+"/sms"},a={EmailTpl:function(){return"apps/"+e.get("User.AppId")+"/emailtemplates"},SingleApp:function(){return"apps/"+e.get("User.AppId")},Schema:function(){return"/schemas/"},Batch:function(){return"/batch/"},Installation:function(){return"/_Installation"},register:function(){return"/register"},requestPasswordReset:function(){return"/requestPasswordReset"},requestEmailVerify:function(){return"/requestEmailVerify"},verifyEmail:function(){return"/verifyEmail"},resetPassword:function(){return"/resetPassword"}};return t.get=function(e){var t=e.split("."),i=o[t[0]];return t[1]?a[t[1]]?i+a[t[1]]():i+"/"+t[1].toLowerCase():i},t}),define("core/functions/UI",["app","dispatcher","U","C","language","i18n","Logger","jquery","underscore","Storage","semanticui_modal","API","semanticui_checkbox"],function(e,t,i,n,o,a,s,r,l,c,d,u){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){return-1}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||function(){return-1}}();var p=null;return{showDialog:function(e,i,n){n=n||{},n=r.extend({specialDialogUI:"",btns:{negative:"common.form.cancel",positive:"common.form.apply",others:[]}},n);var o=n.el||r("#app-dialog");o.attr("special-dialog-ui",n.specialDialogUI),o.parent().removeClass("hidden"),o.removeClass("hidden"),o.removeClass("small medium large x-large"),n.size&&o.addClass(n.size);var s=o.find(".header");s.html(e);var c=o.find(".actions");c.html(""),0!=n.footer&&(n.btns.negative&&""!=n.btns.negative&&c.append('<div class="ui button negative">'+a.t(n.btns.negative)+"</div>"),n.btns.positive&&""!=n.btns.positive&&c.append('<div class="ui button primary positive">'+a.t(n.btns.positive)+"</div>"),l.each(n.btns.others,function(e){if("string"==typeof e)c.append('<div class="ui primary button">'+a.t(e)+"</div>");else if("object"==typeof e){var i=a.t(e.name),n=e.className||"",o=r('<div class="ui button">'+i+"</div>");o.addClass(n),e.icon&&o.prepend('<i class="icon '+e.icon+'"></i>'),e.onClick&&o.bind("click",function(){t.trigger("click:"+e.onClick,{},"Component")}),c.append(o)}}));var d=o.find(".content");if(0==d.length&&(s.after('<div class="content"></div>'),d=o.find(".content")),"string"==typeof i)d.html(i);else{var u=new i(l.extend({},{el:o.find(".content")},n));o.data("dialog-view",u),u.init&&u.init(),u.beforeShow&&u.beforeShow(),u.render(n),u.$(".ui.checkbox").length>0&&u.$(".ui.checkbox").checkbox()}var p=l.pick(n,["closable","useCss","transition","duration","easing","allowMultiple","observeChanges","onVisible","onHidden","options"]);p.transition=p.transition||"scale",0==n.closable?(p.closable=!1,o.children(".icon.close").hide()):o.children(".icon.close").show(),p.onApprove=function(){return n&&n.success&&n.success(o.data("dialog-view")),!1},p.onDeny=function(){n&&n.error&&n.error(o.data("dialog-view"))},p.onHidden=function(){o.removeAttr("special-dialog-ui");var e=o.data("dialog-view");e&&(e.$(".ui.checkbox").length>0&&e.$(".ui.checkbox").checkbox("destroy"),e.beforeHide&&e.beforeHide(),e.destroy(),o.data("dialog-view",null)),o.removeClass("hidden"),r(document).off("keyup.dialog")};var h=function(){r(document).on("keyup.dialog",function(e){13==(e.keyCode||e.which)&&p.onApprove()})};if(p.onVisible){var m=p.onVisible;p.onVisible=function(e){m(e),h()}}else p.onVisible=h;n.autofocus||(p.autofocus=!1),o.modal(p).modal("show")},hideDialog:function(e){e=e||{},e.el?e.el.modal("hide").removeClass("hidden"):r("#app-dialog").modal("hide").removeClass("hidden")},bindUploader:function(e,t,n){e.each(function(e,o){var a=r('<input type="file" style="display:none" />').insertAfter(r(o));r(o).on("click",function(){a.trigger("click")}),a.change(t?function(e){var o=new FileReader,a=r(this).get(0).files[0]||{type:""};i.isImage(a)&&(o.readAsDataURL(a),o.onloadend=function(e){r(t).css("opacity",1),r(t).css("background-repeat","no-repeat"),r(t).css("background-image","url("+e.target.result+")")}),n&&n(e)}:function(e){n&&n(e)})})},removeStatus:function(e){r(e).closest(".field").removeClass("success error"),r(e).closest(".field").children(".error-msg").remove()},toggleSuccess:function(e){this.removeStatus(e)},toggleError:function(e,t){this.removeStatus(e),e.closest(".field").addClass("error"),this._showMessage(e,t)},_showMessage:function(e,t){r(e).hasClass("logger-msg")?s.error(a.t(t)):0==r(e).siblings(".error-msg").length?r(e).closest(".field").append('<span class="error-msg"><i class="warning circle icon"></i>'+a.t(t)+"</span>"):r(e).siblings(".error-msg").text(a.t(t))},_visible:function(e){return document.body.scrollTop<e.offset().top},createCaptcha:function(e){function t(){r("body").delegate("#captcha_img","click",function(){var e=r(this);e.attr("src","").css("background","url(images/ajax_loader_mini.gif) no-repeat center center"),i()})}function i(){var t=Math.random();r.ajax({url:u.get("captcha.secret"),type:"get",data:{_:t},dataType:"json"}).done(function(t,i,n){var o=n.getResponseHeader("X-LAS-SECRET");e.find("#captcha_img").attr("src",u.get("captcha")+"?secret="+o).data("HEADER_SECRET",o)}).fail(function(){e.find("#captcha_img").attr("src",""),s.error("prelogin.error.get-captcha",{doI18n:!0})}).always(function(){e.find(".captcha-warpper").show().end().find(".default-text").hide()})}if(e)return i(),t(),{getCaptchaValue:function(){return r("#captcha").val()},getCaptchaHeaderSecret:function(){return r("#captcha_img").data("HEADER_SECRET")},refresh:function(){r("#captcha_img").click()}}},initIconProgress:function(e){var t=r(e).get(0),i=t.getContext("2d");i.save(),i.fillStyle="#000000",i.fillRect(0,0,174,174),i.restore()},startUploadIcon:function(e){var t=r(e).get(0),i=t.getContext("2d");i.save(),i.beginPath(),i.arc(87,87,80,0,2*Math.PI),i.closePath(),i.clip(),i.clearRect(0,0,174,174),i.restore(),this.progressIcon(e,0)},progressIcon:function(e,t){var i=this,n=r(e).data("percent")||0;p&&cancelRequestAnimationFrame(p),i.progressAnimation(e,n,t)},progressAnimation:function(e,t,i){var n=this;t>i&&(t=i);var o=r(e).get(0),a=o.getContext("2d");a.save(),a.beginPath(),a.arc(87,87,80,0,2*Math.PI),a.closePath(),a.clip(),a.clearRect(0,0,174,174),a.restore(),a.fillStyle="#000000",a.beginPath(),a.arc(87,87,80,0,2*Math.PI),a.closePath(),a.stroke(),a.beginPath(),0==t?a.arc(87,87,60,0,2*Math.PI,!0):a.arc(87,87,60,1.5*Math.PI,Math.PI*(2*t/100+1.5),!0),a.lineTo(87,87),a.closePath(),a.fill(),a.restore(),r(e).data("percent",t),i>t?requestAnimationFrame(function(){n.progressAnimation(e,t+1,i)}):100==t&&n.completeIcon(e)},completeIcon:function(e){function t(){o+=2,o>130&&(o=130),n.save(),n.beginPath(),n.arc(87,87,o,0,2*Math.PI),n.closePath(),n.clip(),n.clearRect(0,0,174,174),n.restore(),130>o?requestAnimationFrame(t):r(e).remove()}var i=r(e).get(0),n=i.getContext("2d");p&&cancelRequestAnimationFrame(p);var o=80;requestAnimationFrame(t)},setIntroProps:function(e){r.each(e,function(e,t){t=r.extend(t,{"data-selector":e}),r(e).attr(t)})},initTooltips:function(){r("body").delegate("[data-sem-key]","mouseenter",function(e){r(e.currentTarget).popup(r.extend({},n.get("UI.Popup"),{offset:-10,html:o.i18n(r(e.currentTarget).attr("data-sem-key"))}))})},initScreenNotification:function(){var e=860,t=r("#screen-notification");r(window).bind("resize",function(){r(window).width()<e?t.show():t.hide()}).trigger("resize")},bindLogout:function(){r(".logout").unbind("click.logout").bind("click.logout",function(){e.User.logout()})}}}),define("core/functions/LayoutRender",["underscore"],function(e){var t={};return t.render=function(t){e.forEach(t,function(t,i){var n=t.constructor;if(!n.create)throw new Error("Illegal Layout!!");var o=n.create({action:i,root:t.root,stateRoot:t.stateRoot,defaultState:t.defaultState,template:t.template,store:t.store,stay:t.stay});o.render(),e.forEach(t.state,function(e,t){o.addState(t,e)})})},t}),define("core/functions/StoreLoader",["app","API","underscore"],function(e,t,i){var n={};return n.load=function(n){i.forEach(n,function(n){var o=n.name;if(!e.DataRepository.getStore(o)){var a,s=n.constructor.create({name:n.name,generator:n.generator,usePool:n.usePool||!1});i.forEach(n.state,function(e,t){s.addState(t,e)}),n.task?(n.taskOptions&&(n.taskOptions.url=t.get(n.taskOptions.url),n.taskOptions.queryUrl&&(n.taskOptions.queryUrl=t.get(n.taskOptions.queryUrl))),a=n.task.create(n.taskOptions||{})):a=n.data||{},s.setData(a),n.initialize&&s.refreshData()
}})},n}),define("basic/Object",["underscore"],function(e){function t(){}function i(t,i){var n,o=this;n=t&&e.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},e.extend(n,o,i);var a=function(){this.constructor=n};return a.prototype=o.prototype,n.prototype=new a,t&&e.extend(n.prototype,t),n.__super__=o.prototype,n}return t.create=function(e){var i=new t;return 0==i.initialize(e)?!1:i},t.extend=i,t.prototype.initialize=function(t){return t||(t={}),e.extend(this,t),!0},t.prototype.get=function(e){if(!e)throw new Error("CObject: method get need argument key");return this[e]},t.prototype.set=function(e,t){if(!e)throw new Error("CObject: method set need arguments key");return this[e]=t,this},t.prototype.destroy=function(){return delete this},t}),define("Cookie",[],function(){return{get:function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?JSON.parse(decodeURI(t[2])):null},set:function(e,t,i,n){var o=new Date;o.setTime(o.getTime()+24*("undefined"==typeof i?1:i)*60*60*1e3),document.cookie=e+"="+encodeURI(t)+";expires="+o.toGMTString()+";path="+n||"/"},remove:function(e){this.set(e,"",-1)},clear:function(){var e=document.cookie.match(/[^ =;]+(?=\=)/g);if(e)for(var t=e.length;t--;)document.cookie=e[t]+"=0;domain="+window.location.hostname+";path=/;expires="+new Date(0).toUTCString()}}}),define("other/Account",["basic/Object","Cookie","Storage","C","U","jquery","underscore","i18n","semanticui_dropdown"],function(e,t,i,n,o,a,s){var r=[],l=e.extend({initialize:function(e){return this._configure(e),this.syncAccountInfo(),!0},_configure:function(e){this.options&&(e=s.extend({},s.result(this,"options"),e)),this.options=s.pick(e,r)},syncAccountInfo:function(){this.set("username",i.get("username")),this.set("email",i.get("email")),this.set("userType",i.get("userType")),this.set("roleType",i.get("roleType")),/(\w+\.)?(\w+)\./.test(window.location.hostname);var e=RegExp.$1;this.set("userId",t.get(e+"userId")||i.get("userId"))},clearUserData:function(){var e=i.get("lastUrl"),n=i.get("vistedIntrosSelector");i.clear(),t.clear(),e&&i.set("lastUrl",e),n&&i.set("vistedIntrosSelector",n)},logout:function(){this.clearUserData(),o.jumpTo("/login")},renderUserInfo:function(){this.username||this.email||"";a("#user-menu").i18n(),a("#user-menu").dropdown({duration:100,action:"select",onChange:function(e,t,i){console.log(i),console.log(i.find("a")[0]),i.find("a")[0].click()}})},destroy:function(){}});return l.create=function(e){var t=new l;return 0==t.initialize(e)?!1:t},l}),define("other/StateMachine",["basic/Object"],function(e){var t=e.extend({initialize:function(){return this._state={},this._callback={},!0},register:function(e,t,i,n){this._state[e]||(this._state[e]={}),this._state[e][t]=i,this._callback[e]||(this._callback[e]={}),this._callback[e][t]=n},execute:function(e,t){if(!(this.currentState&&this._callback[this.currentState]&&this._state[this.currentState]&&this._state[this.currentState][e]))return!1;var i=this._callback[this.currentState][e];return this.currentState=this._state[this.currentState][e],i?i(t):!1},setState:function(e){this.currentState=e}}),i=new t;return 0==i.initialize()?!1:i}),define("data/Task",["basic/Object","API","Logger","C","Q","jquery","underscore","pace"],function(e,t,i,n,o,a,s,r){var l=["params","method","header","url","timeout","formatter","buffer","next","queryUrl","extractUrl"],c=0,d=1,u=2,p=3,h=e.extend({initialize:function(e){return this._configure(e),this.result={},this.state=c,this.defer=o.defer(),!0},_configure:function(e){this.options&&(e=s.extend({},s.result(this,"options"),e)),this.options=s.pick(e,l)},start:function(){var e,l=this;if(this.state==d)return this.defer.promise;(this.state==u||this.state==p)&&(this.defer=o.defer());var c=this.options.method||"GET",h=this.options.params,m=this.options.url||"";this.options.extractUrl&&(m=t.get(m));var f=this.options.timeout||n.get("Ajax.TIMEOUT"),v=s.extend({},n.get("Ajax.HTTPHEADER"),this.options.header);this.options.queryUrl&&(c="POST",m=this.options.queryUrl);try{e="GET"==c.toUpperCase()?h:JSON.stringify(h)}catch(g){console.log("Task: params format error")}this.state=d,r.restart();var b=a.ajax({url:m,type:c,dataType:"json",contentType:"application/json",data:e,timeout:f,headers:v});return this._ajax=b,o(b).then(function(e){return l.state=u,e},function(e){return i.error(e,l.options),l.state=p,l.options.buffer?l.options.buffer:e.responseText}).then(function(e){if(l.options.formatter&&"function"==typeof l.options.formatter){var t=l.options.formatter(e,l.options);if(t&&o.isPromise(t))return void t.then(function(e){l.result=e,l.defer.resolve(l.result)},function(e){l.result=e,l.defer.resolve(l.result)}).fail(function(){});l.result=t}else l.result=e;l.defer.resolve(l.result)}).fail(function(){}),l.defer.promise},abort:function(){return this._ajax?this._ajax.abort():!1}});return h.create=function(e){var t=new h;return 0==t.initialize(e)?!1:t},h}),define("data/DataRepository",["Logger","basic/Object","data/Task","dispatcher","Q","jquery","underscore"],function(e,t,i,n,o,a,s){var r=[],l=t.extend({initialize:function(e){return this.isRunning=!1,this._configure(e),this._store_list={},!0},_configure:function(e){this.options&&(e=s.extend({},s.result(this,"options"),e)),this.options=s.pick(e,r)},start:function(){this.isRunning=!0},stop:function(){this.isRunning=!1},push:function(e,t){return this.isRunning?void(this._store_list[e]=t):!1},getStore:function(e){return"undefined"==typeof this._store_list[e]?!1:this._store_list[e]},remove:function(e){return"undefined"==typeof this._store_list[e]?!1:delete this._store_list[e]},fetch:function(e,t,i){if("undefined"==typeof this._store_list[e])throw new Error('DataRepository: "'+e+'" is not existed');var n=this._store_list[e];return"string"==typeof t?n.getState(t,i):n.getData()},fetchNew:function(e,t){if("undefined"==typeof this._store_list[e])throw new Error('DataRepository: "'+e+'" is not existed');var i=this._store_list[e];return i.refreshData(t,!0)},refresh:function(t,i){if("undefined"==typeof this._store_list[t])throw new Error('DataRepository: "'+t+'" is not existed');var a=this._store_list[t];try{var s=a.refreshData(i);s&&o.isPromise(s)&&s.done(function(e){console.log('refresh:"'+t+'"'),n.trigger("refresh:"+t,e,"Component")})}catch(r){e.error(r)}return s}});return l.create=function(e){var t=new l;return 0==t.initialize(e)?!1:t},l}),define("net/RequestPool",["basic/Object","jquery","underscore"],function(e,t,i){var n=[],o=e.extend({initialize:function(e){return this._configure(e),this._request_list={},!0},_configure:function(e){this.options&&(e=i.extend({},i.result(this,"options"),e)),this.options=i.pick(e,n)},push:function(e,t){"undefined"==typeof this._request_list[e]&&(this._request_list[e]=[]),this._request_list[e].push(t._ajax)},clear:function(e){e?this._request_list[e]=[]:this._request_list={}},abortByStoreName:function(e){this._request_list[e]&&this._request_list[e].length>0&&(i.forEach(this._request_list[e],function(e){e.abort()}),this._request_list[e]=[])}});return o.create=function(e){var t=new o;return 0==t.initialize(e)?!1:t},window.rp12=o.create(),rp12}),define("data/Store",["app","basic/Object","net/RequestPool","data/Task","U","Q","jquery","underscore"],function(e,t,i,n,o,a,s,r){var l=["generator","usePool","name"],c=1,d=2,u=3,p=t.extend({initialize:function(e){return this._configure(e),this.QUEUE=!1,this._state_list={},this._resultStack=[],this._callbackStack=[],this._currentProgress=0,this.addDefaultState(),e.name&&this.register(e.name),!0},_configure:function(e){this.options&&(e=r.extend({},r.result(this,"options"),e)),this.options=r.pick(e,l)},register:function(t){e.DataRepository.push(t,this)},setData:function(e){var t={};e instanceof n?(t.data=e,t.type="task",e.state=d):(t.data=o.Clone(e),t.type="data"),this._origin_data=t},getTask:function(){var e=this._origin_data.type;return"task"==e?this._origin_data.data:!1},getData:function(){var e=a.defer(),t=this._origin_data.type;if("data"==t)e.resolve(o.Clone(this._origin_data.data));else{var i=this._origin_data.data,n=i.state;if(n==d||n==u)e.resolve(o.Clone(i.result));else{if(n==c)return i.defer.promise;e.reject(new Error("Store: unknown error"))}}return e.promise},addState:function(e,t){this._state_list[e]=t},addDefaultState:function(){this.addState("default",function(e){return e})},getState:function(e,t){if("undefined"==typeof this._state_list[e])throw new Error('State: "'+e+'" is not defined');var i=a.defer(),n=this._state_list[e];return this.getData().done(function(e){var a=n(o.Clone(e),t);a&&a.done?a.done(function(e){i.resolve(e)}):i.resolve(a)}),i.promise},refreshData:function(e,t){var o=this,s=this._origin_data.type;if("data"==s){var l=a.defer();return l.resolve(this._origin_data.data),l.promise}var p=this._origin_data.data,h=this.options.generator?this.options.generator(e||{},p.options):e||{},m=r.extend({},p.options,h),f=p.state;if(t){var v=n.create(m),g=v.start();return this.options.usePool&&i.push(this.options.name,v),g}if(f==c||1==this.QUEUE){if(this.checkEqual(m,p.options)&&0==this.QUEUE)return console.log("equal return same"),!1;console.log("unequal start new"),this.QUEUE=!0,0==this._callbackStack.length&&(this.MAIN_TASK=!1,p.defer.promise.done(function(){o.MAIN_TASK=!0;var e=0;for(console.log("main task clear: T");"undefined"!=typeof o._resultStack[e];)console.log("task call"+e),o._origin_data.data._configure(o._resultStack[e].options),o._origin_data.data.result=o._resultStack[e].result,o._callbackStack[e].resolve(o._resultStack[e].result),o._callbackStack[e]=void 0,e++}));var b=a.defer();b.index=this._callbackStack.length,this._callbackStack.push(b);var y=n.create(m);return y.start().done(function(){console.log("sub task clear:"+b.index),o._currentProgress++,o._resultStack[b.index]=y,o._currentProgress==o._callbackStack.length&&o.MAIN_TASK&&(o._currentProgress=0,r.forEach(o._callbackStack,function(e,t){e&&(console.log("task call"+t),o._origin_data.data._configure(o._resultStack[t].options),o._origin_data.data.result=o._resultStack[t].result,e.resolve(o._resultStack[t].result))}),o._callbackStack=[],o._resultStack=[],o.QUEUE=!1)}),this.options.usePool&&i.push(this.options.name,y),b.promise}if(f==d||f==u){p._configure(m);var w=p.start();return this.options.usePool&&i.push(this.options.name,p),w}},checkEqual:function(e,t){return r.isEqual(e.params,t.params)&&e.method==t.method&&e.url==t.url}});return p.create=function(e){var t=new p;return 0==t.initialize(e||{})?!1:t},p}),define("store/RestStore",["data/Store","data/Task","Q","underscore"],function(e,t,i,n){var o=e.extend({getDataById:function(e,o){var a,o=o||"objectId",s=this._origin_data.data,r=i.defer(),l=this._origin_data.type;if("data"==l)a=n.find(s,function(t){return t[o]==e}),r.resolve(a);else if(a=n.find(s.result,function(t){return t[o]==e}))r.resolve(a);else{var c=s.options.url+"/"+e;t.create({url:c}).start().done(function(e){r.resolve(e)})}return r.promise},addData:function(e){var n=this._origin_data.data,o=i.defer(),a=this._origin_data.type;if("data"==a)throw new Error('RestStore: "add" static data to be implement');var s=t.create({url:n.options.url,method:"post",params:e});return s.start().done(function(e){3!=s.state?o.resolve(e):o.reject(e)}),o.promise},deleteData:function(e){var n=this._origin_data.data,o=i.defer(),a=this._origin_data.type;if("data"==a)throw new Error('RestStore: "delete" static data to be implement');var s=n.options.url+"/"+e,r=t.create({url:s,method:"delete"});return r.start().done(function(e){3!=r.state?o.resolve(e):o.reject(e)}),o.promise},updateData:function(e,o){var a=this._origin_data.data,s=i.defer(),r=this._origin_data.type;if("data"==r){var l=n.find(a,function(t){return t.id==e});n.extend(l,o),s.resolve(l)}else{var c=a.options.url+"/"+e,d=t.create({url:c,method:"put",params:o});d.start().done(function(e){3!=d.state?s.resolve(e):s.reject(e)})}return s.promise}});return o.create=function(e){var t=new o;return 0==t.initialize(e||{})?!1:t},o}),define("text!modules/common/AppList/template.html",[],function(){return'<div class="ui floating dropdown pointing left top button">\n    <span class="text">\n        <img class="ui mini avatar image" src="/images/appicon.svg">\n        <span data-i18n="common.title.choose-app"></span>\n    </span>\n    <i class="dropdown icon"></i>\n    <div class="menu">\n        <div class="ui icon search input">\n            <i class="search icon"></i>\n            <input type="text" name="search" data-i18n="[placeholder]common.placeholder.search">\n        </div>\n        <div class="scrolling menu"></div>\n        <div class="divider"></div>\n        <a class="item create-app" href="/createapp">\n            <i class="plus icon"></i>\n            <span data-i18n="common.title.create-app"></span>\n        </a>\n    </div>\n</div>'}),define("modules/common/AppList/view",["app","C","U","Storage","Logger","dispatcher","core/functions/UI","text!./template.html","marionette","jquery","underscore","i18n","semanticui_dropdown"],function(e,t,i,n,o,a,s,r,l,c,d,u){return l.ItemView.extend({template:d.template(r),events:{"click .scrolling>.item":"changeApp","keyup input":"changeAppByKey"},init:function(){var e=window.location.pathname,t="";/^\/(\w+)(\/?|\/apps\/\w+(\/)?)$/.test(e)&&(t=RegExp.$1);var i=this.options.storeName;this.childTemplate=d.template('            <div class="item" data-name="<%= name %>" data-value="<%= objectId %>" data-link="/'+t+'/apps/<%= objectId %>">                <img class="ui mini avatar image" src="<% if(metadata.icon){ %><%= metadata.icon %><% }else{ %>/images/appicon.svg<% } %>">                <span><%= name %></span>            </div>'),a.on("refresh:"+i,this.renderComponent,this,"Component")},beforeShow:function(){var e=this.options.valueEventName;a.on("Request.getValue:"+e,this.getValue,this,"Component")},beforeHide:function(){var e=this.options.valueEventName;a.off("Request.getValue:"+e,"Component"),this.$(".ui.dropdown").each(function(e,t){c(t).data("moduleDropdown")&&c(t).dropdown("destroy")})},changeAppByKey:function(e){if(13==e.keyCode){var t=c(".scrolling>.item.selected").attr("data-link");i.jumpTo(t)}},changeApp:function(e){if(!c(e.currentTarget).hasClass("disabled")){var t=c(e.currentTarget).attr("data-link");i.jumpTo(t)}},renderDropdown:function(e){var i=[],n=this.childTemplate;d.forEach(e,function(e){i.push(c(n(e)))}),this.$(".scrolling").html(i),this.$el.i18n(),this.$(".ui.dropdown").dropdown({message:{noResults:u.t("common.title.not-found")}});var o=t.get("User.AppId");if(o){var a=d.find(e,function(e){return e.objectId==o});if(a){var s=a.metadata||{},r=s.icon||"/images/appicon.svg";this.setValue(o,a.name,r)}}},renderComponent:function(){var t=this,i=this.options.storeName,n=this.options.stateName;e.DataRepository.fetch(i,n).done(function(e){t.renderDropdown(e)})},render:function(){l.ItemView.prototype.render.call(this),this.renderComponent()},refresh:function(){var t=this.options.storeName;e.DataRepository.refresh(t)},setValue:function(e,t,i){this.$(".ui.dropdown").data("moduleDropdown")||this.$(".ui.dropdown").dropdown(),this.$(".ui.dropdown").dropdown("set text",'<img class="ui mini avatar image" src="'+i+'"><span>'+t+"</span>"),this.$(".ui.dropdown").dropdown("set value",e)},getValue:function(){return this.$(".ui.dropdown").dropdown("get value")}})}),define("tpl!modules/common/NotificationBar/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<a class="toggle-notification" href="javascript:void(0)">    <span class="badge">0</span>    <span class="icomoon icomoon-bell2"></span></a><div class="notification-dropdown" style="display:none">    <div class="ui breadcrumb" style="display: block!important;border-bottom: 0"></div>    <div class="notification-dropdown-content">        <ul class="notification-body">        </ul>        <div class="notification-empty-view">            <div class="notification-empty-view-icon"></div>            <div class="notification-empty-view-text"><span data-i18n="notification.content.nodata"></span></div>        </div>    </div>    <div class="notification-status">        <div class="ui button btn-refresh pull-left">        </div>        <span class="tip-updated" data-i18n="common.tip.update"></span>        <span class="tip-loading" data-i18n="common.tip.loading" style="display: none"></span>    </div></div>');return __p.join("")}}),define("tpl!modules/common/NotificationBar/childTemplate.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<li class="message">    <a href="/issues#issue/',objectId,'">        <div class="app-icon app-icon-head pull-left"></div>        <div class="pull-right">            <span class="from pull-left">',author,'</span>            <time class="pull-right">',time,'</time>        </div>        <span class="title pull-left" style="margin-left:18px;">',title,"</span>    </a></li>");return __p.join("")}}),define("modules/common/NotificationBar/view",["app","dispatcher","tpl!./template.html","tpl!./childTemplate.html","marionette","jquery","underscore","moment","nicescroll"],function(e,t,i,n,o,a){return o.ItemView.extend({template:i,childTemplate:n,events:{"click .toggle-notification":"toggleDisplay","click .notification-body>li":"toggleClose","click .ui.breadcrumb>.section":"toggleType",click:"cancelClick","click .btn-refresh":"refresh"},init:function(){},beforeShow:function(){},cancelClick:function(e){e.stopPropagation()},toggleClose:function(e){var t=this;this.$(".notification-dropdown").removeClass("open"),this.$(".notification-dropdown").stop(!0,!0).animate({opacity:0},200,"linear",function(){t.$(".notification-dropdown").css("transform","rotateY(180deg)").hide()}),a("body").unbind("click.notification"),e&&e.stopPropagation()},toggleShow:function(e){var t=this;a(".dropdown").removeClass("open"),this.$(".notification-dropdown").addClass("open"),this.$(".notification-dropdown").show(),this.$(".notification-dropdown").stop(!0,!0).animate({opacity:1},{duration:200,step:function(e){a(this).css({transform:"rotateY("+180*(1-e)+"deg)",opacity:e}),t.scrollContent.resize()}}),a("body").unbind("click.notification").bind("click.notification",function(){t.toggleClose()}),e&&e.stopPropagation()},toggleType:function(e){this.type=a(e.currentTarget).attr("data-value"),this.$(".ui.breadcrumb>.section").removeClass("active"),a(e.currentTarget).addClass("active"),this.renderComponent(),e.stopPropagation()},toggleDisplay:function(e){this.$(".notification-dropdown").hasClass("open")?this.toggleClose():this.toggleShow(),e.stopPropagation()},render:function(){o.ItemView.prototype.render.call(this),this.type="msgs",this.scrollContent=this.$(".notification-dropdown-content").niceScroll(),this.refresh()},renderComponent:function(){this.$(".btn-refresh").removeClass("loading"),this.$(".tip-updated, .tip-loading").toggle();var t=this.options.storeName,i=this;e.DataRepository.fetch(t,this.type).done(function(e){i.renderNotificationMsg(e)})},renderNotificationMsg:function(){var e=this;this.refreshTask&&clearTimeout(this.refreshTask),setTimeout(function(){e.refresh()},this.options.refreshInterval||18e4)},refresh:function(){var t=this.options.storeName;e.DataRepository.refresh(t)},beforeHide:function(){}})}),define("Timezone",["jquery","underscore","C","moment","moment-timezone"],function(e,t,i,n){var o={default_format:"llll",default_server_timezone_offset:"0",timezones:{0:"Greenwich",7:"Asia/Bangkok",8:"Asia/Shanghai"},init:function(){this.inited||(n.locale(i.get("moment")),this.timezone=this.getUserTimezone(),this.inited=!0)},getUserTimezone:function(){return i.get("User.Timezone")||"Asia/Shanghai"},getTimezoneOffsetByBrowser:function(){return-(new Date).getTimezoneOffset()/60},getTimezoneOffsetByString:function(e){return parseInt(n().tz(e).format("Z"))},getTimezoneOffset:function(e){return this.init(),e=e||this.timezone,this.getTimezoneOffsetByString(e)},convertTimestampToTimeByTimezone:function(e,t,i,o){if(e&&""!=e){o=o||this.default_format;var a=n.unix(e).format(o);return a}},convertByTimezone:function(e,t,i,o){if(e&&""!=e){this.init(),t=t||this.timezone,o=o||this.default_format;var a=n(e).tz(t),s=a.clone().tz(i).format(o);return s}},parseServerTime:function(e,t,i,n){this.init(),i=i||this.timezone,t=t||this.default_server_timezone_offset;var o=this.timezones[t];return this.convertByTimezone(e,o,i,n)},buildServerTime:function(e,t,i,n){this.init(),i=i||this.timezone,t=t||this.default_server_timezone_offset;var o=this.timezones[t];return this.convertByTimezone(e,i,o,n)},handlerTimeProperties:function(e,i,n){var o=this;e&&0!=e.length&&i&&0!=i.length&&(o.init(),n=n||{},n.server_timezone_offset=n.server_timezone_offset||o.default_server_timezone_offset,n.user_timezone=n.user_timezone||o.timezone,n.format=n.format||o.default_format,t.each(e,function(e){t.each(i,function(i){t.has(e,i)&&(e[i]=o.parseServerTime(e[i],n.server_timezone_offset,n.user_timezone,n.format))})}))},handlerTimePropertiesNoFormat:function(e,i){e&&0!=e.length&&i&&0!=i.length&&t.each(e,function(e){t.each(i,function(i){t.has(e,i)&&(e[i]=1e3*n.tz(e[i],"Greenwich").unix())})})},Convert2LocalTime:function(t,i){if(!e.isNumeric(t))throw new Error("must be timestamp");var o=n.tz(t,"Greenwich"),a=o.clone().tz(this.getUserTimezone());return 0==i?a:"undefined"!=typeof i?a.format(i):1e3*a.unix()}};return o}),define("modules/common/Contact",["jquery","Logger","language"],function(e,t,i){"zh"===i.getCurLangCode()?(window.jsI18nData={formValidation:{user:{loginid:"请输入合法的邮箱",email:"请输入合法的邮箱",username:"用户名不能少于6位",password:"密码不能少于8位",name:"请输入公司名称",phone:"请输入合法电话号码",captcha:"请输入验证码","password-confirm":"请确认您的密码","password-same":"两次输入的密码必须相同"},contact:{email:"请输入合法的邮箱",message:"请输入您的反馈信息"}},aboutus:{"send-success":"谢谢您的反馈，我们已经收到您的信息，会尽快与您联系。","send-fail":"发送失败，请稍后再试。"},updatebrowser:"为了您极致的体验，请使用IE11或其他现代浏览器。","get-captcha-error":"获取验证码失败，请稍后重试。","server-error":"服务器异常，请稍后重试。","signout-success":"注销成功"},window.jsI18nData.module={analytics:"分析",segments:"用户群细分",clouddata:"云数据",cloudconfig:"云配置",cloudcode:"云代码",push:"推送",support:"支持",gamemaster:"管理",devcenter:"开发者中心",dashboard:"概况",marketing:"营销推广",appsettings:"设置",gamesettings:"设置",users:"用户",createapp:"创建应用程序",creategame:"创建应用程序"},e(".side-contact-article-en").remove()):(window.jsI18nData={formValidation:{user:{loginid:"Please enter a valid email",email:"Please enter a valid email",username:"User name cannot less than 6",password:"Password cannot less than 8",name:"Please enter orgnization name",phone:"Please input a valid number",captcha:"Please input a valid captcha","password-confirm":"Please confirm your password","password-same":"Two passwords must be the same"},contact:{email:"Please enter a valid email",message:"Please enter your message"}},aboutus:{"send-success":"Thanks for contacting us. We have received your message. Our support will get back to you as soon as possible.","send-fail":"Send fail, please try again latter."},updatebrowser:"In order to make your experience excellent, please use IE11 or other modern browsers.","get-captcha-error":"Get captcha fail, please try later.","server-error":"Server error.","signout-success":"Sign out success"},window.jsI18nData.module={analytics:"Analytics",segments:"Segments",clouddata:"Cloud Data",cloudconfig:"Cloud Config",cloudcode:"Cloud Code",push:"Push",support:"Support",gamemaster:"Master",devcenter:"Dev Center",dashboard:"Dashboard",marketing:"Marketing",appsettings:"Settings",gamesettings:"Settings",users:"Users",createapp:"Create App",creategame:"Create App"},e(".side-contact-article-zh").remove());var n={EMAIL:{SENDAPI:"/2.0/mails/sendmail",SENDTO:["support@leap.as"],DOMAIN:"mercury-browser.com"}},o=function(){function t(t,i,n){e(".validate_msg",t).remove(),t.removeClass("field-error"),n||(t.append('<div class="validate_msg"><i class="icomoon-attention-circled"></i>'+i+"</div>"),t.addClass("field-error"))}function i(i,n){var o=i.attr("name"),a=e.trim(i.val()),s=i.closest(".field"),r=!0,l="";if(s.hasClass("rpassword")){var c=e.trim(s.closest("form").find(".password input").val()),d=e.trim(i.val());""===d?(l=jsI18nData.formValidation.user["password-confirm"],r=!1):d!==c&&(l=jsI18nData.formValidation.user["password-same"],r=!1)}else{var u=n[o];if(void 0===u)return;l=u.msg;var p=u.rule;r="function"==typeof p?p(a):p.test(a)}t(s,l,r)}function n(t,n){return e("input, textarea",t).each(function(t,o){i(e(o),n)}),0===e(".field-error:visible",t).length?!0:!1}var o={from:{rule:function(e){return e.length?/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e):!0},msg:jsI18nData.formValidation.contact.email},text:{rule:function(e){return e.length>0},msg:jsI18nData.formValidation.contact.message}};return{contactFormRules:o,validateInput:i,validateForm:n}}(),a=function(){function i(){e(".close",r).bind("click",function(){r.slideOut()})}function a(){l.bind("click",function(){r.slideIn()}),s(e("form",r),e(".send-msg-btn",r)),i()}function s(i,a){i.delegate("input","keypress",function(e){return 13===e.keyCode?!1:void 0}),i.delegate("input, textarea","keyup",function(){o.validateInput(e(this),o.contactFormRules)}),a.bind("click",function(){var s=o.validateForm(i,o.contactFormRules),l={};s&&(e(i.serializeArray()).each(function(t,i){l[i.name]=e.trim(i.value)}),l=e.extend(l,{to:n.EMAIL.SENDTO,domain:n.EMAIL.DOMAIN}),l.from=l.from||"Anonymity",e.ajax({method:"POST",url:n.EMAIL.SENDAPI,data:JSON.stringify(l),contentType:"application/json",dataType:"json",beforeSend:function(){a.addClass("loading")},complete:function(){a.removeClass("loading"),r.slideOut()},success:function(){t.success(jsI18nData.aboutus["send-success"])},error:function(){t.error(jsI18nData.aboutus["send-fail"])}}))})}var r=e("#side-contact-article"),l=e("#side-contact-btn");return r.slideOut=function(){this.removeClass("visible")},r.slideIn=function(){this.addClass("visible")},{initContactBtn:a,initFormOp:s}}();a.initContactBtn()}),define("modules/common/bootstrapper",["app","language","dispatcher","core/functions/UI","other/Account","other/StateMachine","data/DataRepository","store/RestStore","data/Task","./AppList/view","./NotificationBar/view","API","U","C","Q","jquery","Storage","Cookie","underscore","moment","semanticui_popup","i18n","Timezone","./Contact"],function(e,t,i,n,o,a,s,r,l,c,d,u,p,h,m,f,v,g,b,y,w,_){function C(e){e&&(h.set("User.AppId",e),v.set("current_app_id",e))}function k(){if(!e.User)throw new Error("You should initialize Account first");e.User.logout()}function x(){var e=Z.module;"dashboard"!=e&&p.jumpTo("/nopermission")}function S(t){e.User.set("permissions",["DASHBOARD","DEV_CENTER","SETTINGS","ORG_PROFILE"]),e.User.set("orgId",t.orgId),e.User.set("roles",t.roles),e.User.set("timezone",t.timezone),e.User.set("email",t.email),e.User.set("username",t.username),e.User.set("userType",t.userType),e.User.set("orgId",t.orgId),v.get("language")||v.set("language",t.language)}function D(){e.DataRepository.fetch("Store:UserProfile").done(function(e){if(e.orgId){S(e);var t=(Z.module,!0);a.execute(t?"has_permission":"no_permission")}else a.execute("no_session_token")},function(){throw new Error("ServerError")})}function I(){var e=Z.module,t=-1!=f.inArray(e,J)?"not_need_app_list":"need_app_list";a.execute(t)}function T(){var t=l.create({url:u.get("OrgUsers")+"/"+e.User.get("userId"),formatter:function(e){return e},method:"GET",buffer:{}}),i=l.create({url:u.get("App"),formatter:function(e){return b.isArray(e)?e.sort(function(e,t){return e.name>t.name?1:-1}):[]},method:"GET",buffer:[]}),n=r.create({name:"Store:AllAppList"});n.setData(i),n.refreshData();var o=r.create({name:"Store:UserProfile"});o.setData(t),o.refreshData()}function j(){}function $(){e.DataRepository.fetch("Store:AllAppList").done(function(e){a.execute("load_success",e)},function(){a.execute("load_fail"),O.reject()})}function E(e){if(f.isArray(e)&&e.length){var t,i=h.get("User.AppId");if(!(t=b.findWhere(e,{objectId:i}))){if(!e[0]||!e[0].objectId)throw new Error("Dirty Data in AppList");i=e[0].objectId,t=e[0]}h.set("User.AppIcon",t.metadata?t.metadata.icon:""),h.set("User.AppName",t.name?t.name:""),C(i),a.execute("in_app_list")}else a.execute("not_in_app_list")}function R(e){a.execute("can_create",e)}function A(){U(),e.User.renderUserInfo(),f("#main-sidebar,#header-nav,#main-container,#main-container>.sidebar").i18n(),n.initTooltips(),n.initScreenNotification(),n.bindLogout(),f("#common-loader").fadeOut(),O.resolve()}function N(){A();var e=new c({storeName:"Store:AllAppList"});e.init(),e.setElement(document.getElementById("app-selector")),e.beforeShow(),e.render()}function P(){N(),f("#app-selector .create-app").remove()}function q(){var t=Z.module;"createapp"==t||"dashboard"==t&&2==e.User.get("userType")?x():(A(),f("#create_app").remove())}function L(){var e=Z.module;v.set("pagebeforecreateapp",e),p.jumpTo("/createapp")}function V(){a.setState("EnterPage"),a.register("EnterPage","no_session_token","NotLogin",k),a.register("EnterPage","expire_session_token","NotLogin",k),a.register("EnterPage","has_session_token","Login",D),a.register("Login","no_session_token","NotLogin",k),a.register("Login","no_permission","NoPermission",x),a.register("Login","has_permission","HasPermission",I),a.register("HasPermission","need_app_list","StartLoadingList",$),a.register("HasPermission","not_need_app_list","NotNeedApp",R),a.register("NotNeedApp","can_create","StartPage",A),a.register("NotNeedApp","can_not_create","StartPage",q),a.register("StartLoadingList","load_success","LoadingComplete",R),a.register("StartLoadingList","load_fail","LoadingError",j),a.register("LoadingComplete","can_create","CanCreate",E),a.register("CanCreate","not_in_app_list","NoApp",L),a.register("CanCreate","in_app_list","StartPage",N),a.register("LoadingComplete","can_not_create","CanNotCreate",E),a.register("CanNotCreate","not_in_app_list","NoPermission",x),a.register("CanNotCreate","in_app_list","NoPermission",P)}function U(){var t=f("#module-menu .menu-content"),i=Z.module,n=e.User.get("permissions"),o=[];if(b.forEach(H,function(e){if(f.inArray(K[e],n)>-1){var t=G[e]?G[e]:e,i=f('<li><a href="/'+e+'"><i class="icomoon '+B[e]+'"></i><span data-i18n="common.module.'+z(t)+'"></span></a></li>');if("userpermission"!=e&&"billing"!=e&&"orgprofile"!=e&&"subscription"!=e)o.push(i);else{var a='<div class="item"><a href="/'+e+'"><i class="'+Y[e]+'"></i><span data-i18n="common.module.'+z(t)+'"></span></a></div>';f(a).insertBefore(f("#user-menu .profile"))}}}),"dashboard"==i){b.forEach(o,function(e,t){0!=e.find("a[href='/dashboard'],a[href='/userpermission'],a[href='/billing']").length&&(o[t]="")}),f('<ul class="app-list app-menu-items"></ul>').insertBefore(f("#create_app_warpper")).append(o);for(var a=8-f("ul.app-menu-items>li").length,s=0;a>s;s++)f("ul.app-menu-items").append('<li class="empty"></li>');f("#header-nav").append('<div class=" page-title">'+_.t("common.module.dashboard")+"</div>")}else f('<ul class="app-list app-menu-items"></ul>').appendTo(t).append(o);f("#module-menu>.icomoon-menu").on("click.appmenu",function(e){function i(){f(document).off("click.appmenu"),t.removeClass("active")}t.hasClass("active")?i():(t.addClass("active"),e.stopPropagation(),f(document).on("click.appmenu",i),f(document).on("click.appmenu","#module-menu",function(e){e.stopPropagation()}))})}function z(e){return"settings"==e?"app-settings":e}function F(){function e(){var e=p.parseCurrentUrl();e&&v.set("lastUrl",e)}var t=v.get("lastUrl");if(Z&&""==Z.hash&&t&&""!=t.hash&&""!=Z.module&&Z.module==t.module&&f.inArray(Z.module.toLowerCase(),W)>-1){var i="";if(/^#(\w+)\//.test(t.hash)){var n=RegExp.$1;"analytics"==t.module&&"funnels"==n&&(n="conversions"),t.hash="#"+n}i=""!=Z.appId?Z.origin+"/"+Z.module+"/apps/"+Z.appId+"/"+t.hash:Z.origin+"/"+Z.module+t.hash,""!=i&&p.jumpTo(i)}else e(),window.onhashchange=function(){e()}}function M(){var e=v.get("current_app_id"),t=v.get("moment");h.set("moment",t),e&&h.set("User.AppId",e),/(\w+\.)?(\w+)\./.test(window.location.hostname);
var i=RegExp.$1,n=g.get(i+"sessionToken")||v.get("sessionToken");n&&h.set("User.SessionToken",n);var o=v.get("timezone");o&&h.set("User.Timezone",o);var a=window.location.pathname;/^\/\w+\/apps\/(\w+)(\/)?$/.test(a)&&C(RegExp.$1)}var O=m.defer(),H=["clouddata","settings"],Y={userpermission:"icomoon icomoon-useradm",orgprofile:"icomoon icomoon-orgprofile"},B={dashboard:"dashboard",clouddata:"icomoon-devcenter",settings:"icomoon-setting",profile:"icomoon-useri",orgprofile:"icomoon-orgprofile"},G={clouddata:"dev-center"},J=["dashboard","profile","createapp","product"],W=["settings"],K={dashboard:"DASHBOARD",clouddata:"DEV_CENTER",settings:"SETTINGS",orgprofile:"ORG_PROFILE"},Z=p.parseCurrentUrl();return{init:function(){return F(),e.DataRepository=s.create(),e.DataRepository.start(),e.User=o.create(),t.init(function(){var e=Z.module,t=G[e]?G[e]:e;if(f("#main-toolbar>.module-name").html('<div class="group-name" data-i18n="common.module.'+z(t)+'"></div><div class="menu-name"></div>'),M(),V(),h.get("User.SessionToken")){var i=h.get("User.SessionToken");i&&h.set("Ajax.HTTPHEADER.X-LAS-Session-Token",i),T(),a.execute("has_session_token")}else a.execute("no_session_token");f("#main-sidebar>.list>a").click(function(e){var t=f(e.currentTarget).attr("data-value"),i=f("#main-container>.sidebar li[data-module="+t+"]");i.length&&(window.location.hash=i.eq(0).children("a").attr("href"))})}),O.promise}}}),define("core/functions/Formatter",["C","moment","underscore"],function(e,t,i){return{AnalyticsTask:function(e,n){var o,a=[],s=[],r={},l=t(n.params.start_date,"YYYY-MM-DDHH"),c=t(n.params.end_date,"YYYY-MM-DDHH"),d=n.params.time_unit;if(i.forEach(e.stats,function(e){r[e.date+""]=e}),"hourly"==d)for(var u=l.unix(),p=c.subtract(-23,"hours").unix();p>=u;)o=parseInt(t.unix(u).format("YYYYMMDDHH")),a.push(o),s.push(r[o]?r[o]:{date:o}),u+=3600;else if("daily"==d)for(var h=l.clone();c>=h;)o=h.format("YYYYMMDD"),a.push(o),s.push(r[o]?r[o]:{date:o}),h.subtract(-1,"days");else if("weekly"==d){var m=l.clone();for(1==l.day()||(m=0==l.day()?m.day(1):m.subtract(-7,"days").day(1));c>=m;)o=m.format("YYYYMMDD"),a.push(o),s.push(r[o]?r[o]:{date:o}),m.subtract(-7,"days")}else if("monthly"==d){var f=l.clone();for(1!=l.date()&&(f=f.subtract(-1,"month").date(1));c>=f;)o=f.format("YYYYMMDD"),a.push(o),s.push(r[o]?r[o]:{date:o}),f.subtract(-1,"month").date(1)}return e.dates=a,e.stats=s,e.chart_name=l.format("ll")+" - "+c.format("ll"),e},Float2Money:function(e,t,i){if(!$.isNumeric(i)||Number(i)<0)return"0";/^(\d+)(\.\d+)?$/.test(Number(i));var n=RegExp.$1,o=RegExp.$2||"";o&&(o=o.slice(0,3));for(var a="";n.length>3;)a=","+n.slice(n.length-3)+a,n=n.slice(0,n.length-3);return n+a+o},Float2Percent:function(e,t,i){return"number"==typeof i?Math.round(1e4*i)/100+"%":i},Float2Percent100:function(e,t,i){return"number"==typeof i?i+"%":i},TotalPercent:function(e,t,i,n,o){var a=Math.round(1e4*o[n.field+"_rate"])/100+"%";return i+" ("+a+")"},DateFormat:function(e,i,n){if(10==(n+"").length)return t(n,"YYYYMMDDHH").format("lll");if(9==(n+"").length){var o=n.charAt(n.length-1),a=t(n,"YYYYMMDDHH").format("ll"),s="";if("W"==o)s=t(n,"YYYYMMDD").subtract(-6,"days").format("ll");else{var r=t(n,"YYYYMMDD"),l=1==r.date()?r:r.subtract(-1,"month");s=l.subtract(-1,"month").subtract(1,"days").format("ll")}return a+" - "+s}return t(n,"YYYYMMDDHH").format("ll")},Timestamp2Date:function(e,i,n){return n&&-1!=n?t.unix((n||0)/1e3).format("MM/DD/YYYY HH:mm"):"--"},NormalDateFormat:function(e,i,n){return t(n).format("MM/DD/YYYY HH:mm")},StringFormat:function(e,t,i){return"string"==typeof i?i:""},NumberFormat:function(e,t,i){return"number"==typeof i?i:0},ActionAllFormat:function(){return'<i class="action edit icon"></i><i class="action trash icon"></i>'},ActionDeleteFormat:function(){return'<i class="action trash icon"></i>'}}}),define("view/Layout",["app","basic/Object","U","Q","dispatcher","jquery","underscore"],function(e,t,i,n,o,a,s){var r=["store","action","root","stateRoot","template","defaultState"],l=t.extend({initialize:function(e){if(this._configure(e),"undefined"==typeof this.options.root)throw new Error("Layout: layout root must be set");return this._defaultState=this.options.defaultState?this.options.defaultState:"default",this._currentState=this._defaultState,this._state={},this._stateRoot=null,this._registerEvent(),!0},_configure:function(e){this.options&&(e=s.extend({},s.result(this,"options"),e)),this.options=s.pick(e,r)},_registerEvent:function(){o.on("hide",this.hide,this,"Layout"),o.on("show",this.show,this,"Layout")},show:function(t){this.beforeShow(),this.options.stay||"all"==this.options.action||a.inArray(this.options.action,t.actions)>-1?(t.options.stayState||this.changeState(t.state||this._defaultState),this.options.store&&this.loadStoreData(),this.renderState(t.options),a(this.options.root).show()):this.options.action==t.action&&(t.options.stayState||this.changeState(t.state||this._defaultState),this.options.store&&this.loadStoreData(),e.current_action=t.action,e.current_state=this._currentState,this.renderState(t.options),a(this.options.root).show())},hide:function(e){this.options.stay||this.options.action!=e.action&&"none"!=a(this.options.root).css("display")&&(a(this.options.root).hide(),this.clearState())},render:function(){var e=this.options.template?this.options.template:"";if(a(this.options.root).append(e).hide(),this.options.stateRoot){var t=a(this.options.root).find(this.options.stateRoot);if(!(t.length>0))throw new Error('Layout: "'+t+'" can not be found');this._stateRoot=t.get(0)}else this._stateRoot=a(this.options.root).get(0)},addDefaultState:function(e){this.addState(this._defaultState,e)},addState:function(e,t){var i=this;this._state[e]=[],s.isArray(t)||(t=[t]),s.forEach(t,function(t){if(!t.container.create)throw new Error("Illegal Container!!");var n=t.container.create(t);n.loadComponents(t.components),i._state[e].push(n)})},changeState:function(){throw new Error("Layout: You must implement changeState method")},renderState:function(){throw new Error("Layout: You must implement renderState method")},clearState:function(){throw new Error("Layout: You must implement clearState method")},loadStoreData:function(){throw new Error("Layout: You must implement loadStoreData method")}});return l.create=function(e){var t=new l;return 0==t.initialize(e)?!1:t},l}),define("layout/BasicLayout",["app","core/functions/StoreLoader","view/Layout","jquery","underscore"],function(e,t,i,n,o){var a=i.extend({renderState:function(e){var t=this._state[this._currentState];if(!t)throw new Error('BasicLayout: state "'+this._currentState+'" is not defined');var i=this._stateRoot;o.forEach(t,function(t){t.render(i,e)})},changeState:function(e){this.clearState(),this._currentState=e},show:function(t){this.options.action==t.action&&(this.changeState(t.state||this._defaultState),this.options.store&&this.loadStoreData(),e.current_action=t.action,e.current_state=this._currentState,this.renderState(t.options),n(this.options.root).show())},hide:function(e){this.options.action!=e.action&&"none"!=n(this.options.root).css("display")&&(n(this.options.root).hide(),this.clearState())},clearState:function(){var e=this._state[this._currentState];if(!e)throw new Error('BasicLayout: state "'+this._currentState+'" is not defined');var t=this._stateRoot;o.forEach(e,function(e){e.clear(t)})},loadStoreData:function(){var e=this.options.store;t.load(e)}});return a.create=function(e){var t=new a;return 0==t.initialize(e)?!1:t},a}),define("modules/clouddata/common/CloudDataLayout",["app","dispatcher","layout/BasicLayout","jquery","underscore","backbone"],function(e,t,i,n,o,a){var s=i.extend({show:function(i){if(this.options.action==i.action){this.changeState("default"),this.options.store&&this.loadStoreData(),e.current_action=i.action;var s=this,r=i.options.className;e.DataRepository.fetch("Store:Schemas").done(function(n){if(r){var l=o.find(n,function(e){return e.className==r});l&&(e.currentClass=r)}else r=n[0]?n[0].className:!1,e.currentClass=r;"class"==i.state?(s.renderState({className:e.currentClass}),a.history.navigate("classes/"+e.currentClass),t.trigger("show:Class",{className:e.currentClass},"Layout")):"pointer"==i.state?(s.renderState({className:e.currentClass}),t.trigger("show:Pointer",{className:e.currentClass,objectId:i.options.oid},"Layout")):"relation"==i.state&&(s.renderState({className:e.currentClass,objectId:i.options.oid,columnName:i.options.columnName}),t.trigger("show:Relation",{className:e.currentClass,objectId:i.options.oid,columnName:i.options.columnName},"Layout"))}),n(this.options.root).show()}},hide:function(e){this.options.action!=e.action&&"none"!=n(this.options.root).css("display")&&(n(this.options.root).hide(),this.clearState())},changeState:function(e){this._currentState=e}});return s.create=function(e){var t=new s;return 0==t.initialize(e)?!1:t},s}),define("core/functions/ComponentFactory",[],function(){var e={};return e.createComponent=function(e){e=e||{};var t=e.constructor,i=e.extend;i&&i.storeName&&(e.options=e.options||{},e.options.storeName=i.storeName);var n=new t(e.options);return n.init&&n.init(),n},e}),define("view/Container",["basic/Object","core/functions/ComponentFactory","jquery","underscore","i18n"],function(e,t,i,n){var o=["template","root"],a=e.extend({initialize:function(e){return this._configure(e||{}),this._renderindex=0,this._components=[],this._componentStack={},this._containerRoot=null,this._root=null,this.cid=n.uniqueId("container_"),!0},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),e.events&&(this.events=n.extend({},this.events||{},e.events)),this.options=n.pick(e,o)},loadComponents:function(e){var t=this;n.forEach(e,function(e){t.addComponent(e)})},getContainer:function(){return i('<div id="'+n.uniqueId("component-")+'"></div>')},getComponentByIndex:function(e){if(!this._components[e])return!1;var t=this._components[e].name;return this._componentStack[t]||!1},createComponent:function(e,t){return e.factory.createComponent(e,t)},addComponent:function(e){this._components.push({name:e.name,constructor:e.constructor,factory:e.factory||t,options:e.options,extend:e.extend})},renderComponents:function(e){var t,o=this;if(this.options.root){var a=this._containerRoot.filter(this.options.root),s=this._containerRoot.find(this.options.root);t=i(a.length>0?a.get(0):s.length>0?s.get(0):this._containerRoot.get(0))}else t=i(this._containerRoot.get(0));n.forEach(this._components,function(i){var n=i.name;"undefined"==typeof o._componentStack[n]&&(o._componentStack[n]=o.createComponent(i,e||{}));var a=o._componentStack[n],s=o.getContainer(n,e||{}).appendTo(t).get(0);a.setElement(s),a.beforeShow&&a.beforeShow(),a.render(e||{})})},beforeRenderComponents:function(){},render:function(e,t){var n;this._root=i(e),this.delegateEvents(),n=this.options.template?"function"==typeof this.options.template?i(this.options.template(t)).appendTo(i(e)):i(this.options.template).appendTo(i(e)):i(e),n.i18n(),this._containerRoot=n,this.beforeRenderComponents(),this.renderComponents(t),this.afterRenderComponents()},afterRenderComponents:function(){},clear:function(e){if(this.undelegateEvents(),n.forEach(this._componentStack,function(e){e.beforeHide&&e.beforeHide()}),!this._containerRoot)return!1;if(this._containerRoot.length>1)this._containerRoot.each(function(){i(this).remove()});else{var t=this._containerRoot.get(0);t&&t!=e?this._containerRoot.remove():i(e).html("")}},delegateEvents:function(){var e=this.events;if(e){this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),i){var o=t.match(/^(\S+)\s*(.*)$/),a=o[1],s=o[2];i=n.bind(i,this),a+=".delegateEvents"+this.cid,""===s?this._root.on(a,i):this._root.on(a,s,i)}}return this}return!1},undelegateEvents:function(){return this._root&&this._root.off(".delegateEvents"+this.cid),this}});return a.create=function(e){var t=new a;return 0==t.initialize(e)?!1:t},a}),define("container/BasicContainer",["view/Container","jquery","underscore"],function(e,t){var i=e.extend({getContainer:function(e){return t('<div id="'+e+'">')}});return i.create=function(e){var t=new i;return 0==t.initialize(e)?!1:t},i}),define("modules/clouddata/common/CloudDataContainer",["container/BasicContainer","core/functions/ComponentFactory","jquery","underscore"],function(e){var t=e.extend({initialize:function(t){return this.beRendered=!1,e.prototype.initialize.call(this,t)},render:function(t,i){if(!this.beRendered){try{e.prototype.render.call(this,t,i)}catch(n){console.log(n)}this.beRendered=!0}}});return t.create=function(e){var i=new t;return 0==i.initialize(e)?!1:i},t}),define("modules/clouddata/common/CloudDataToolbarContainer",["./CloudDataContainer"],function(e){var t=e.extend({render:function(t,i){if(!this.beRendered){try{e.prototype.render.call(this,"#main-toolbar>.toolbar-content",i)}catch(n){console.log(n)}this.beRendered=!0}}});return t.create=function(e){var i=new t;return 0==i.initialize(e)?!1:i},t}),define("text!modules/clouddata/main/toolbar/filter/FilterItem.html",[],function(){return'<div class="field" data-type="column">\n    <div class="ui basic button dropdown">\n        <input type="hidden" name="type">\n        <div class="text">\n            <%= isInColumnList(data.column_list,data.column,"common.tag.select-column") %>\n        </div>\n        <i class="angle down icon dropdown"></i>\n        <div class="menu">\n            <div class="scrolling menu">\n                <%= generateColumnList(data.column_list) %>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="field" data-type="op">\n    <div class="ui basic button dropdown">\n        <input type="hidden" name="type">\n        <div class="text">\n            <%= isInList(data.op_list[data.type]||[],data.op,"common.tag.select-op") %>\n        </div>\n        <i class="angle down icon dropdown"></i>\n        <div class="menu">\n            <%\n            if(data&&data.column=="objectId"){\n            var list = data.op_list[data.type];\n            print(generateList((list||[]).slice(0,list.length-1)));\n            }else{\n            print(generateList(data.op_list[data.type]||[]));\n            }\n            %>\n        </div>\n    </div>\n</div>\n<div class="field" data-type="value">\n    <%= generateValueEditor() %>\n</div>\n<i class="large remove circle icon"></i>'}),define("modules/clouddata/main/headerbar/ImportData/controller",["app","Logger","dispatcher","underscore","marionette","jquery","i18n"],function(e,t,i,n,o,a,s){return o.ItemView.extend({render:function(){},init:function(){},beforeShow:function(){i.on("Request.NewUpload",this.whenRequestNewUpload,this,"Component"),i.on("Request.setValue:UploadResult",this.whenRequestNewTask,this,"Component"),i.on("Request.getValue:LastUpload",this.whenRequestLastUpload,this,"Component")},beforeHide:function(){i.off("Request.NewUpload","Component"),i.off("Request.setValue:UploadResult","Component"),i.off("Request.getValue:LastUpload","Component")},whenRequestNewTask:function(e){this.lastUploadResult=e},whenRequestLastUpload:function(){return this.lastUploadResult||!1},whenRequestNewUpload:function(e){var i=e.handler,n=i.options.onSuccess,o=i.options.onError;i.options.onSuccess=function(e){n(e),a("#data-headerbar .item.data-import").removeClass("disabled"),a("#data-sidebar .button.import-class").removeClass("disabled"),a("#upload-icon").removeClass("loading").addClass("complete"),window.onbeforeunload=!1,t.success("common.success.upload",{doI18n:!0})},i.options.onError=function(e){var i=o(e);a("#data-headerbar .item.data-import").removeClass("disabled"),a("#data-sidebar .button.import-class").removeClass("disabled"),a("#upload-icon").removeClass("loading").addClass("error"),window.onbeforeunload=!1,t.error(i)},a("#data-headerbar .item.data-import").addClass("disabled"),a("#data-sidebar .button.import-class").addClass("disabled"),a("#upload-icon").removeClass("complete error").addClass("loading"),window.onbeforeunload=function(){return s.t("clouddata.tips.leave-page")}}})}),define("basic/net/Uploader",["API","Logger","C","core/functions/UI","U","underscore","jquery"],function(e,t,i,n,o,a){var s={method:"PUT",urlRoot:e.get("Files"),onProgress:function(e){console.log(e)},onSuccess:function(){console.log("success")},onComplete:function(){console.log("complete")},onError:function(){console.log("error")},onAbort:function(){console.log("abort")}},r=function(e){var t=a.extend({},s,e);if(!t.urlRoot)throw new Error("Need URL to Upload");if(!t.$el)throw new Error("Need FileInputNode to Upload");this.options=t};return r.prototype.uploadFile=function(){function e(e){var t=0;e.lengthComputable&&(t=e.loaded/e.total,t>=.9&&(t=.9),n.onProgress&&n.onProgress(t))}var n=this.options,a=n.$el.get(0).files[0]||{type:""};if(n.checkImage&&!o.isImage(a))return t.error("illegal Image File"),!1;var s=new XMLHttpRequest;s.upload.addEventListener("progress",e,!1),s.upload.addEventListener("load",n.onComplete,!1),s.upload.addEventListener("error",n.onError,!1),s.upload.addEventListener("abort",n.onAbort,!1),s.onreadystatechange=function(){if(4==s.readyState){var e=s.response;200==s.status||201==s.status?(n.onProgress(1),n.onSuccess(e,s)):n.onError(s)}};var r=n.url?n.url:n.urlRoot+"/"+encodeURIComponent(a.name);if(s.open(n.method,r,!0),s.setRequestHeader("X-LAS-AppId",i.get("User.AppId")),s.setRequestHeader("X-LAS-Session-Token",i.get("User.SessionToken")),this.xhr=s,n.key){var l=new FormData;l.append(n.key,a),s.send(l)}else s.send(a)},r.prototype.stopUpload=function(){this.xhr&&0==this.xhr.status&&this.xhr.abort()},r}),define("config/validate",["jquery"],function(e){return{required:{msg:"error.format.required",validator:function(t){return e.trim(t)&&null!=typeof t}},appname:{regex:/^[a-zA-Z0-9]+[0-9a-zA-Z_-\s\u4e00-\u9fa5]{1,}$/,msg:"error.format.appname",rules:["required"]},columnname:{regex:/^[A-Za-z_][A-Za-z0-9_]*$/,msg:"error.format.columnname",rules:["required"]},targetclass:{msg:"error.local.targetclass",validator:function(e,t){var i=t.type,n=t.target;return!(("Pointer"==i||"Relation"==i)&&!n)}},eid:{regex:/^[A-Za-z][A-Za-z0-9]+$/,msg:"error.format.appname",rules:["required"]},url:{regex:/^((http|https):\/\/(.*))?$/,msg:"error.format.url"},urlpathAndNotEmpty:{msg:"error.format.urlpathAndNotEmpty",validator:function(t){var t=e.trim(t);return t.length<1?!1:/^(?!http:\/\/|https:\/\/|:\/\/)(.*)+$/.test(t)}},json:{msg:"error.format.json",validator:function(e){try{var t=/(^\{.*\}$)|(^\[(.*)\]$)/;if(!t.test(e))return!1;JSON.parse(e)}catch(i){return!1}return!0}},number:{msg:"error.format.number",validator:function(t){return""==t?!0:e.isNumeric(t)}},numberAndNotempty:{msg:"error.format.number",validator:function(t){return""==t?!1:e.isNumeric(t)}},latitude:{msg:"error.format.geo",rules:["required","number"],validator:function(e){return Math.abs(e)<=180}},longitude:{msg:"error.format.geo",rules:["required","number"],validator:function(e){return Math.abs(e)<=90}},email:{regex:/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,msg:"error.format.email"},phone:{regex:/^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,msg:"error.format.phone"},object:{msg:"error.format.object",validator:function(e){if(!/^\s*\{/.test(e))return!1;try{JSON.parse(e)}catch(t){return!1}return!0}},array:{msg:"error.format.array",validator:function(e){if(!/^\s*\[/.test(e))return!1;try{JSON.parse(e)}catch(t){return!1}return!0}},passwordconfirm:{msg:"error.local.passwordconfirm",rules:["required"],validator:function(t,i,n){return e.trim(t)===e.trim(n.password)}},nonemptyemail:{rules:["required","email"]},username:{msg:"error.format.username",validator:function(t){return e.trim(t).length>=6}},password:{msg:"error.format.password",validator:function(t){return e.trim(t).length>=8}},arrayrequired:{msg:"error.format.required",validator:function(e){return e.split(",")[0].length>0}},marketingschedule:{msg:"error.format.marketingschedule",validator:function(e,t){var i=t.find(".begin-at").dropdown("get value");if(0==i){var n=t.next(),o=n.find(".end-at").dropdown("get value");if(0==o){var a=t.find("[name=start_date]").val()+" "+t.find("[name=start_time]").val(),s=n.find("[name=end_date]").val()+" "+t.find("[name=end_time]").val();return s>a}}return!0}},subsciption:{msg:"error.format.required",validator:function(e,t,i){return!(!i||0==i.length)}},exportdata:{msg:"error.format.required",validator:function(e,t,i){return!(!i.classNames||0==i.classNames.length)}},numberbigger:{msg:"error.format.bigger",rules:["number"],validator:function(e,t,i){return i=i||{},!e||!i.compareWithVal||parseInt(e)<parseInt(i.compareWithVal)?!1:!0}},numberGTE0:{msg:"error.format.numberGTE0",validator:function(t){return""==t?!1:e.isNumeric(t)&&/^[1-9][0-9]*$/.test(t)&&t>=0?!0:!1}},numberGTE1:{msg:"error.format.numberGTE1",validator:function(t){return""==t?!1:e.isNumeric(t)&&/^[1-9][0-9]*$/.test(t)&&t>=1?!0:!1}},numberGT0:{msg:"error.format.numberGT0",validator:function(t){return""==t?!1:e.isNumeric(t)&&/^[1-9][0-9]*$/.test(t)&&t>0?!0:!1}},numberBT1To7:{msg:"error.format.numberBT1To7",validator:function(t){return""==t?!1:e.isNumeric(t)&&/^[1-9][0-9]*$/.test(t)&&t>=1&&7>=t?!0:!1}},numberBT1To7AndBigger:{msg:"error.format.numberBT1To7AndBigger",validator:function(t,i,n){return n=n||{},!t||!n.compareWithVal||parseInt(t)<parseInt(n.compareWithVal)?!1:""==t?!1:e.isNumeric(t)&&/^[1-9][0-9]*$/.test(t)&&t>=1&&7>=t?!0:!1}},phoneAndNotempty:{msg:"error.format.phone",validator:function(t){var t=e.trim(t),i=/^(([0\+]\d{2,3}-)?(0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/.test(t),n=/^1[3|4|5|6|7|8|9][0-9]{1}[0-9]{8}$/.test(t);return i||n?!0:!1}},checkboxNotEmpty:{msg:"error.local.event-not-empty",validator:function(e,t){return t.find("input:checked").length>0}}}}),define("core/functions/Validator",["app","core/functions/UI","config/validate","jquery","underscore"],function(e,t,i,n,o){function a(e){this.__config=e,this.execute=function(e,t,i){var n={result:!0,msg:"success"},o={result:!1,msg:this.__config.msg},a=this.__config.rules;for(var s in a){var r=a[s].execute(e,t,i);if(!r.result)return r}var l=this.__config.regex;if(l&&!l.test(e))return o;var c=this.__config.validator;return c&&"function"==typeof c&&!c(e,t,i)?o:n}}function s(){this.__rules={},this.init()}s.prototype.addRules=function(e,t){var i=this,n=this.__rules,s=o.extend({},o.pick(t,"regex","msg","validator"));if(t.rules){s.rules=[];try{o.forEach(t.rules,function(e){if("string"==typeof e&&n[e])s.rules.push(n[e]);else{if("object"!=typeof e)throw new Error("Error:rule format error");var o=i.addRules("",t);s.rules.push(o)}})}catch(r){console.log(r)}}var l=new a(s);return e&&(n[e]=l),l},s.prototype.removeRules=function(e){rules[e]="",delete rules[e]},s.prototype.init=function(){var e=this;o.forEach(i,function(t,i){e.addRules(i,t)})},s.prototype.validate=function(e,i){if(1===e.length){/\s?validate-(\w+)\s?/.test(e.attr("class"));var n,o=RegExp.$1,a={};try{e.is(".select2-parts")?n=e.dropdown2("get value"):e.is(".ui.dropdown")?n=e.dropdown("get value"):e.is("input,textarea,select")&&(n=e.val())}catch(s){}return o&&this.__rules[o]&&(a=this.__rules[o].execute(n,e,i)),1==a.result?(t.toggleSuccess(e),!0):(e.unbind(".validate"),t.toggleError(e,a.msg),!1)}var r=this;for(var l in e)if(0==r.validate(e[l]))return!1;return!0},s.prototype.check=function(e){var t=!0,i=this;return n(e).find(".validate").each(function(e,o){0==i.validate(n(o))&&(t=!1)}),t};var r=new s;return r}),define("tpl!modules/clouddata/main/headerbar/ImportData/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="upload-form active">        <div class="upload-zone">            <i class="icon circle plus"></i>        </div>        <div class="progress-zone" style="display:none;">            <div class="progress-bar">                <div class="percent"></div>            </div>        </div>        <h4 data-i18n="clouddata.tips.upload-file"></h4>        <div class="info">            <p class="error-message"></p>            <p class="tip" data-i18n="clouddata.tips.json-support"></p>        </div>    </div>    <div class="import-form">        <div class="file-zone">            <i class="icomoon icomoon-file"></i>            <div class="file-name"></div>        </div>        <div class="choose-type">            <p class="tip" data-i18n="clouddata.tips.choose-class-type"></p>            <div class="type-list">                <div class="type active" data-value="0">                    <i class="icomoon icomoon-class"></i>                    <span>Class</span>                </div>                <div class="type" data-value="1">                    <i class="icomoon icomoon-user"></i>                    <span>User</span>                </div>                <div class="type" data-value="2">                    <i class="icomoon icomoon-installation"></i>                    <span>Installation</span>                </div>                <div class="type" data-value="3">                    <i class="icomoon icomoon-relation"></i>                    <span>Relation</span>                </div>            </div>        </div>        <div class="editor-zone"></div>        <div class="result-zone" style="display:none;">            <div class="info">                <p class="error-message"></p>                <p class="tip" data-i18n="clouddata.tips.finish-import"></p>            </div>        </div>    </div></div>');return __p.join("")}}),define("component/dialog/BasicDialog",["app","Logger","core/functions/Validator","marionette","jquery","underscore","semanticui_dropdown"],function(e,t,i,n,o,a){return n.ItemView.extend({template:a.template('<div class="ui form"></div>'),beforeShow:function(){},beforeHide:function(){this.$(".dropdown-parts").each(function(e,t){o(t).data("moduleDropdown")&&o(t).dropdown("destroy")})},showLoading:function(){this.$(".ui.form").addClass("loading"),o("#app-dialog .ui.primary.button").addClass("disabled")},hideLoading:function(){this.$(".ui.form").removeClass("loading"),o("#app-dialog .ui.primary.button").removeClass("disabled")},autoCheck:function(e){var t=o(e.currentTarget).closest(".field");i.check(t)},isValid:function(){return i.check(this.$el)},renderDropdown:function(){this.$(".dropdown-parts").each(function(e,t){o(t).data("moduleDropdown")||o(t).dropdown()})},renderTips:function(){this.$("[data-tip]").each(function(e,t){var i=o(t).attr("data-tip");o(t).append('<i class="sem-helper-tip icomoon icomoon-help" data-sem-key="'+i+'"></i>')})},render:function(){n.ItemView.prototype.render.call(this),this.renderDropdown(),this.$el.i18n(),this.renderTips()}})}),function(e){"function"==typeof define&&define.amd?define("pnotify.nonblock",["jquery","pnotify"],e):e(jQuery,PNotify)}(function(e,t){var i,n=/^on/,o=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,a=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,s=/^(scroll|resize|(un)?load|abort|error)$/,r=function(t,i){var r;if(t=t.toLowerCase(),document.createEvent&&this.dispatchEvent){if(t=t.replace(n,""),t.match(o)?(e(this).offset(),r=document.createEvent("MouseEvents"),r.initMouseEvent(t,i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget)):t.match(a)?(r=document.createEvent("UIEvents"),r.initUIEvent(t,i.bubbles,i.cancelable,i.view,i.detail)):t.match(s)&&(r=document.createEvent("HTMLEvents"),r.initEvent(t,i.bubbles,i.cancelable)),!r)return;this.dispatchEvent(r)}else t.match(n)||(t="on"+t),r=document.createEventObject(i),this.fireEvent(t,r)},l=function(t,n,o){t.elem.css("display","none");var a=document.elementFromPoint(n.clientX,n.clientY);t.elem.css("display","block");var s=e(a),l=s.css("cursor");t.elem.css("cursor","auto"!==l?l:"default"),i&&i.get(0)==a||(i&&(r.call(i.get(0),"mouseleave",n.originalEvent),r.call(i.get(0),"mouseout",n.originalEvent)),r.call(a,"mouseenter",n.originalEvent),r.call(a,"mouseover",n.originalEvent)),r.call(a,o,n.originalEvent),i=s};t.prototype.options.nonblock={nonblock:!1,nonblock_opacity:.2},t.prototype.modules.nonblock={myOptions:null,init:function(e,t){var n=this;this.myOptions=t,e.elem.on({mouseenter:function(t){n.myOptions.nonblock&&t.stopPropagation(),n.myOptions.nonblock&&e.elem.stop().animate({opacity:n.myOptions.nonblock_opacity},"fast")},mouseleave:function(t){n.myOptions.nonblock&&t.stopPropagation(),i=null,e.elem.css("cursor","auto"),n.myOptions.nonblock&&"out"!==e.animating&&e.elem.stop().animate({opacity:e.options.opacity},"fast")},mouseover:function(e){n.myOptions.nonblock&&e.stopPropagation()},mouseout:function(e){n.myOptions.nonblock&&e.stopPropagation()},mousemove:function(t){n.myOptions.nonblock&&(t.stopPropagation(),l(e,t,"onmousemove"))},mousedown:function(t){n.myOptions.nonblock&&(t.stopPropagation(),t.preventDefault(),l(e,t,"onmousedown"))},mouseup:function(t){n.myOptions.nonblock&&(t.stopPropagation(),t.preventDefault(),l(e,t,"onmouseup"))},click:function(t){n.myOptions.nonblock&&(t.stopPropagation(),l(e,t,"onclick"))},dblclick:function(t){n.myOptions.nonblock&&(t.stopPropagation(),l(e,t,"ondblclick"))}})},update:function(e,t){this.myOptions=t}}}),define("modules/clouddata/main/headerbar/ImportData/view",["app","dispatcher","C","API","Logger","basic/net/Uploader","core/functions/UI","core/functions/Validator","tpl!./template.html","component/dialog/BasicDialog","underscore","jquery","i18n","pnotify.nonblock"],function(e,t,i,n,o,a,s,r,l,c,d,u,p){function h(e){var t;try{var i=JSON.parse(e);t=i.errorMessage||p.t("error.net."+i.errorCode)}catch(n){t=p.t("error.net.90000")}return t}function m(e){var t=u("#app-dialog .content");t.removeClass("loading retry complete continue"),e&&t.addClass(e)}var f=10485760;return c.extend({events:{"click .type-list>.type":"toggleClassType","click .btn-import":"createImportTask","click .ui.dropdown .item":"autoCheck","keyup input":"autoCheck"},template:l,beforeShow:function(){u("#app-dialog .btn-wait").bind("click.dataie",this.waitForComplete.bind(this)),u("#app-dialog .btn-import").bind("click.dataie",this.createImportTask.bind(this)),u("#app-dialog .btn-retry").bind("click.dataie",this.retryUpload.bind(this)),u("#app-dialog .btn-continue").bind("click.dataie",this.continueUpload.bind(this))},beforeHide:function(){u("#app-dialog .btn-wait,#app-dialog .btn-import,#app-dialog .btn-retry,#app-dialog .btn-continue").unbind("click.dataie"),this.handler&&this.handler.stopUpload(),this.clearPage()},clearPage:function(){this.$(".ui.dropdown").each(function(e,t){u(t).data("moduleDropdown")&&u(t).dropdown("destroy")})},clearErrorMessage:function(){this.$(".info").removeClass("error"),this.$(".info>.error-message").text("")},showErrorMessage:function(e){this.$(".info").addClass("error"),this.$(".info>.error-message").text(e)},retryUpload:function(){this.$(".upload-zone").show(),this.clearErrorMessage(),this.$(".progress-zone").hide(),this.$(".progress-zone .progress-bar").removeClass("error"),this.$(".upload-form input[type=file]").val(""),this.setProgress(0),m()},continueUpload:function(){this.$(".ui.form").removeClass("visible"),this.$(".upload-form").show().addClass("active"),this.$(".import-form").removeClass("active"),this.retryUpload()},showProgressBar:function(){this.$(".upload-zone").hide(),this.$(".progress-zone").show()},startUploadAnimation:function(e){var t=this,i=409600/e;.1>i&&(i=.1),i>.8&&(i=.8);var n,o=0,a=.5,s=.98,r=function(){n=setTimeout(function(){o+=i,o>s&&(o=s),t.setProgress(o),i>.001&&(i*=a),s>o&&r()},400)};return r(),function(){clearTimeout(n)}},setProgress:function(e){this.$(".progress-zone .percent").css("width",100*e+"%")},toggleClassType:function(e){this.$(".type-list>.type").removeClass("active"),u(e.currentTarget).addClass("active"),this.renderEditorByType(u(e.currentTarget).index())},uploadJSON:function(e){var o=this;this.clearErrorMessage();var s=e.get(0).files[0].size,r=e.get(0).files[0].name,l=this.startUploadAnimation(s);
s>f&&m("loading"),this.handler=new a({$el:e,method:"POST",urlRoot:n.get("DataIE")+"/apps/"+i.get("User.AppId")+"/upload",checkImage:!1,key:"file",onSuccess:function(e){var i;try{i=JSON.parse(e)}catch(n){i={}}l(),o.setProgress(1),o.showImportSettingPage(r),i.filename=r,t.request("setValue:UploadResult",i,"Component")},onError:function(e){l();var t=h(e.responseText);return o.showErrorMessage(t),m("retry"),o.$(".progress-zone .progress-bar").addClass("error"),t}}),this.handler.uploadFile()},showImportSettingPage:function(e){var t=this;this.$(".import-form .editor-zone,.import-form .choose-type").show(),this.$(".import-form .result-zone").hide(),this.$(".import-form .file-zone,.upload-form").removeClass("active"),this.$(".file-zone .file-name").text(e),/^(.*)\.json$/.test(e);var i=RegExp.$1,n="_User"==i?1:"_Installation"==i?2:0;this.renderEditorByType(n,i),this.$(".import-form").addClass("active"),setTimeout(function(){t.$(".upload-form").hide(),t.$(".ui.form").addClass("visible"),m("complete")},200)},renderEditorByType:function(t,i){this.clearPage(),this.$(".editor-zone").html("");var n=this;if(this.$(".type-list .type").removeClass("active"),this.$(".type-list .type[data-value="+t+"]").addClass("active"),i||(i=""),0==t){var o='<div class="class-editor"><div class="inline field"><label data-i18n="clouddata.tag.class-name"></label><input class="validate validate-required" type="text" name="classname" value="'+i+'"/></div></div>';this.$(".editor-zone").html(o).i18n()}else 3==t?(this.$(".editor-zone").html('<div class="relation-editor"></div>'),e.DataRepository.fetch("Store:Schemas").done(function(e){var t=u('<div class="inline field"><label data-i18n="clouddata.tag.relation-property"></label><div class="ui basic button dropdown origin-selector validate validate-required"><span class="text" data-i18n="clouddata.tag.choose-class"></span><input type="hidden"/><i class="icon dropdown"></i><div class="menu"><div class="scrolling menu"></div></div></div></div>'),o=u('<div class="inline field"><div class="ui basic button dropdown relation-selector validate validate-required"><span class="text" data-i18n="clouddata.tag.choose-relation"></span><input type="hidden"/><i class="icon dropdown"></i><div class="menu"><div class="scrolling menu"></div></div></div></div>'),a=u('<div class="inline field"><input class="validate validate-required" type="text" name="target" value="'+i+'" data-i18n="[placeholder]clouddata.tag.target-column"/></div>');n.$(".editor-zone .relation-editor").append(t),n.$(".editor-zone .relation-editor").append(o),n.$(".editor-zone .relation-editor").append(a);var s=t.find(".scrolling.menu"),r=o.find(".scrolling.menu");d.forEach(e,function(e){r.append('<div class="item" data-value="'+e.className+'">'+e.className+"</div>"),s.append('<div class="item" data-value="'+e.className+'">'+e.className+"</div>")}),n.$(".editor-zone").i18n(),n.$(".ui.dropdown").dropdown()})):this.$(".editor-zone").html("")},render:function(e){var i=this;if(c.prototype.render.call(this,e),e.options.isWaiting){var n=t.request("getValue:LastUpload",{},"Component");this.showImportSettingPage(n.filename)}s.bindUploader(this.$(".upload-form>.upload-zone"),!1,function(e){var t=e.target.files;t[0]&&("application/json"!=t[0].type?i.showErrorMessage(p.t("error.local.json-support")):t[0].size>104857600?i.showErrorMessage(p.t("error.local.upload-size-limit")):(i.showProgressBar(),i.uploadJSON(u(e.target))))})},waitForComplete:function(){t.request("NewUpload",{handler:this.handler},"Component"),this.handler=null,u("#app-dialog").addClass("scale2corner"),setTimeout(function(){u("#app-dialog-wrapper").css("z-index",-1),u("#app-dialog").removeClass("hidden scale2corner").modal("hide",function(){u("#app-dialog-wrapper").removeAttr("style")})},300)},getFormValue:function(){var e=this.$(".type-list>.type.active").attr("data-value"),t={collectionType:e};if("0"==e){var i=this.$(".editor-zone [name=classname]").val();t.classNames=[i]}else"3"==e?(t.relationOwner=this.$(".ui.dropdown.origin-selector").dropdown("get value"),t.relationTarget=this.$(".ui.dropdown.relation-selector").dropdown("get value"),t.relationField=this.$(".editor-zone [name=target]").val()):t.classNames=["1"==e?"_User":"_Installation"];return t},createImportTask:function(){var i=t.request("getValue:LastUpload",{},"Component"),n=this.$(".editor-zone");if(r.check(n)){var o=this,a=this.getFormValue();a.bucketKey=i.bucketKey,a.total=i.total,a.s3Path=i.s3Path,i&&e.DataRepository.getStore("Store:DataIE").ImportData(a).then(function(e){o.clearErrorMessage(),o.showTaskProgress(e.taskId)},function(e){var t=h(e);o.showErrorMessage(t)}).finally(function(){o.$(".import-form .editor-zone,.import-form .choose-type").hide(),o.$(".import-form .result-zone").show(),o.$(".import-form .file-zone").addClass("active"),m("continue")})}},showTaskProgress:function(t){if(t){var i=new PNotify({text:'<p class="title">'+p.t("clouddata.tag.data-import")+'</p><p class="progress"><span class="percent"></span></p>',type:"success",icon:"icon check circle",mouse_reset:!1,hide:!1,nonblock:{nonblock:!0,nonblock_opacity:.4}}),n=function(){setTimeout(function(){e.DataRepository.getStore("Store:DataIE").getProcess([t]).done(function(o){d.forEach(o,function(o){if(-1!=o){var a=parseFloat(o);isNaN(a)&&(a=0),i.elem.find("span.percent").css("width",100*a+"%"),n()}else e.DataRepository.getStore("Store:DataIE").updateTaskById(t).done(function(t){var n=parseFloat(t.process);isNaN(n)&&(n=0),i.elem.find("span.percent").css("width",100*n+"%"),100!=t.status?i.elem.find("p.title").text(p.t("clouddata.success.import")):(i.elem.children(".alert-success").removeClass("alert-success").addClass("alert-danger"),i.elem.find("p.title").text(p.t("clouddata.fail.import"))),e.DataRepository.refresh("Store:Schemas"),setTimeout(function(){PNotify.removeAll()},1500)})})})},1e3)};n()}}})}),define("tpl!modules/clouddata/main/headerbar/ExportData/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="field class-list validate validate-exportdata">        <div class="ui master checkbox">            <input type="checkbox" name="fruits">            <label style="color:#444" data-i18n="clouddata.tag.all-class"></label>        </div>        <div class="list" style="margin-top:15px;"></div>    </div>    <div class="field">        <label data-i18n="clouddata.tag.desc"></label>        <input type="text" name="desc"/>    </div></div>');return __p.join("")}}),define("modules/clouddata/main/headerbar/ExportData/view",["app","core/functions/Validator","tpl!./template.html","component/dialog/BasicDialog","underscore","jquery"],function(e,t,i,n,o,a){return n.extend({events:{"click .list>.checkbox":"toggleAll","click .master.checkbox":"toggleMaster","keyup input":"autoCheck"},template:i,toggleMaster:function(e){this.$(".list>.ui.checkbox").checkbox(a(e.currentTarget).hasClass("checked")?"set checked":"set unchecked"),this.isValid()},toggleAll:function(){var e=this.$(".list .checkbox").not(".checked").length;this.$(".ui.checkbox.master").checkbox(0==e?"set checked":"set unchecked"),this.isValid()},getValue:function(){var e=[];this.$(".list>.checkbox.checked").each(function(t,i){var n=a(i).attr("data-value");e.push(n)});var t=this.$("[name=desc]").val();return{classNames:e,desc:t}},isValid:function(){return t.validate(this.$(".validate.class-list"),this.getValue())},render:function(t){n.prototype.render.call(this,t);var i=this;e.DataRepository.fetch("Store:Schemas").done(function(e){var t=[];o.forEach(e,function(e){t.push(a('<div class="ui checkbox" data-value="'+e.className+'"><input type="checkbox"><label>'+e.className+"</label></div>"))}),i.$(".list").html(t),i.$(".list>.ui.checkbox").checkbox()})}})}),define("tpl!modules/clouddata/main/headerbar/TaskList/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="toolbar">        <div class="pull-left" style="margin-right: 10px;">            <div class="dropdown-parts time ui dropdown selection">                <input type="hidden" name="status" value="week">                <i class="dropdown icon"></i>                <div class="default text" data-i18n="cloudconfig.tag.time"></div>                <div class="menu">                    <div class="item" data-value="week" data-i18n="clouddata.tag.last-week"></div>                    <div class="item" data-value="month" data-i18n="clouddata.tag.last-month"></div>                    <div class="item" data-value="3month" data-i18n="clouddata.tag.last-3-month"></div>                </div>            </div>        </div>        <div class="pull-left">            <div class="dropdown-parts type ui dropdown selection">                <input type="hidden" name="status" value="all">                <i class="dropdown icon"></i>                <div class="default text" data-i18n="cloudconfig.tag.type"></div>                <div class="menu">                    <div class="item" data-value="all" data-i18n="clouddata.tag.all-type"></div>                    <div class="item" data-value="1" data-i18n="clouddata.tag.data-import"></div>                    <div class="item" data-value="0" data-i18n="clouddata.tag.data-export"></div>                </div>            </div>        </div>        <div class="pull-right">            <div class="ui search">                <div class="ui icon input">                    <input type="text" data-i18n="[placeholder]common.placeholder.search" name="search">                    <i class="search icon"></i>                </div>            </div>        </div>    </div>    <div class="table-content"></div>    <div class="sub-table" style="display:none;">        <table class="ui definition celled table segment">            <tbody>                <tr>                    <td data-i18n="clouddata.tag.class-name"></td>                    <td class="class-name"></td>                </tr>                <tr>                    <td data-i18n="clouddata.tag.type"></td>                    <td class="type"></td>                </tr>                <tr>                    <td data-i18n="clouddata.tag.desc"></td>                    <td class="desc"></td>                </tr>                <tr>                    <td data-i18n="clouddata.tag.logs"></td>                    <td class="logs">                        <div class="log-content">                        </div>                    </td>                </tr>            </tbody>        </table>    </div></div>');return __p.join("")}}),define("tpl!component/table/PageTable/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="portlet">    <div class="portlet-title">        <div class="caption"></div>        <div class="tabs"></div>        <div class="tools"></div>    </div>    <div class="portlet-body">        <div class="table-view" style="min-height:39px;">            <div class="view-placeholder">                <div class="no-data-view" style="display:none">                    <div class="empty-icon"></div>                    <div class="empty-message" data-i18n="common.title.no-data-view"></div>                </div>                <div class="loading-view" style="display:none">                    <div class="loading-icon">                        <div class="cube cube1"></div>                        <div class="cube cube2"></div>                        <div class="cube cube3"></div>                        <div class="cube cube4"></div>                    </div>                </div>            </div>        </div>    </div>    <div class="pagination">        <div class="ui basic buttons perpage pull-left"></div>        <div class="ui basic buttons page pull-right">            <div class="ui button prev disabled" data-i18n="common.tag.prev"></div>            <div class="ui button page-status">1 - 1</div>            <div class="ui button next disabled" data-i18n="common.tag.next"></div>        </div>    </div></div>');return __p.join("")}}),define("tpl!component/table/BasicTable/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="portlet">    <div class="portlet-title">        <div class="caption"></div>        <div class="tabs">            <ul class="nav nav-tabs" role="tablist">            </ul>        </div>        <div class="tools"></div>    </div>    <div class="portlet-body">        <div class="table-view" style="min-height:39px;">            <div class="view-placeholder">                <div class="no-data-view" style="display:none">                    <div class="empty-icon"></div>                    <div class="empty-message" data-i18n="common.title.no-data-view"></div>                </div>                <div class="loading-view" style="display:none">                    <div class="loading-icon">                        <div class="cube cube1"></div>                        <div class="cube cube2"></div>                        <div class="cube cube3"></div>                        <div class="cube cube4"></div>                    </div>                </div>            </div>        </div>    </div></div>');return __p.join("")}}),define("extend/ui/AdvancedTable",["jquery","underscore","i18n"],function(e,t,i){var n={display_header:!0,table_class:"",header_class:"",body_class:"",header_cell_class:"",cell_class:"",row_color:!1},o=function(i,o,a,s){var r=t.extend({},n,s);if(0==e(i).length)throw new Error("AdvancedTable: 1st argument must be root");this.root=e('<table class="'+r.table_class+'"><thead class="'+r.header_class+'"></thead><tbody class="'+r.body_class+'"></tbody></table>').prependTo(e(i)),this.render(o,a,r)};return o.prototype.render=function(e,i,o){var a=t.extend({},n,o),s=this.root,r=s.children("thead"),l=s.children("tbody");r.html(""),l.html(""),a.display_header&&this.renderHead(i,a),this.renderBody(e,i,a)},o.prototype.renderBody=function(t,i,n){var o=this.root.children("tbody");for(var a in t){var s=t[a],r=e("<tr></tr>").appendTo(o);if(n.row_color){var l=a%2==0?"even":"odd";r.addClass(l)}for(var c in i){var d=i[c],u=d.field,p=d.cssClass,h=d.formatter,m=h?h(a,c,s[u],d,s):s[u],f=e("<td>"+m+"</td>").appendTo(r).addClass(n.cell_class);d.visible&&f.css("overflow","visible"),p&&f.addClass(p)}}},o.prototype.clearBody=function(){var e=this.root.children("tbody");e.html("")},o.prototype.renderHead=function(t,n){var o=this.root.children("thead");for(var a in t){var s=t[a],r=n.doI18n?i.t(s.name)||s.name:s.name,l=s.cssClass,c=e('<th data-value="'+s.field+'">'+r+"</th>");s.sortable&&c.addClass("sorted"),n.field==s.field&&c.addClass(n.rule>0?"ascending":"descending"),s.width&&c.attr("width",s.width),c.appendTo(o).addClass(n.header_cell_class),l&&c.addClass(l)}},o.prototype.destroy=function(){var e=this.root,t=e.children("thead"),i=e.children("tbody");t.html(""),i.html("")},o}),define("component/table/BasicTable/view",["app","U","dispatcher","tpl!./template.html","marionette","jquery","underscore","extend/ui/AdvancedTable","i18n"],function(e,t,i,n,o,a,s,r,l){return o.ItemView.extend({template:n,events:{"click th.sorted":"changeSort"},init:function(){var e=this.options.storeName;i.on("refresh:"+e,this.renderComponent,this,"Component")},beforeShow:function(){},initGrid:function(){var e=this.options.doI18n?l.t(this.options.title):this.options.title;this.$(".caption").text(e),this.initSort()},initSort:function(){this.order=this.options.order},setSort:function(e,t){this.$("th.sorted").removeClass("ascending descending"),this.$('th[data-value="'+e+'"]').addClass(t),this.order=""==t?!1:{rule:"ascending"==t?1:-1,field:e}},changeSort:function(e){var t=a(e.currentTarget).attr("data-value"),i=a(e.currentTarget).hasClass("descending")?"ascending":"descending";this.setSort(t,i),this.options.static_data?this.renderComponent():this.refresh(),e.stopPropagation()},renderComponent:function(){var t=this,i=this.options.storeName,n=this.options.stateName,o=this.getValue();e.DataRepository.fetch(i,n,o).done(function(e){t.renderGrid(e)})},showLoading:function(){this.$(".view-placeholder").addClass("show"),this.$("tbody").hide(),this.$(".view-placeholder>.no-data-view").is(":visible")&&this.$(".view-placeholder>.no-data-view").hide(),this.$(".view-placeholder>.loading-view").show()},hideLoading:function(){this.$(".view-placeholder").removeClass("show"),this.$("tbody").show(),this.$(".view-placeholder>.loading-view").hide()},showNoData:function(){this.$(".view-placeholder").addClass("show relative"),this.$(".view-placeholder>.no-data-view").show(),this.$("thead").addClass("no-border")},hideNoData:function(){this.$(".view-placeholder").removeClass("show relative"),this.$(".view-placeholder>.no-data-view").hide(),this.$("thead").removeClass("no-border")},renderGrid:function(e){this.hideLoading(),e&&0!=e.length?this.hideNoData():this.showNoData(),this.table.render(e,this.options.columns,s.extend({},this.options.options,this.order))},render:function(){o.ItemView.prototype.render.call(this),this.table=new r(this.$(".table-view"),{},this.options.columns,this.options.options),this.initGrid(),this.$el.i18n(),this.options.static_data?this.renderComponent():this.refresh()},getValue:function(){var e=this.order;return{order:e}},refresh:function(){var t=this.options.storeName;this.showLoading(),e.DataRepository.refresh(t)},beforeHide:function(){this.table&&this.table.destroy()}})}),define("component/table/PageTable/view",["app","U","dispatcher","tpl!./template.html","component/table/BasicTable/view","jquery","underscore","i18n","semanticui_dropdown"],function(e,t,i,n,o,a,s,r){return o.extend({template:n,events:{"click .perpage.buttons>.button":"changePerpage","click .page.buttons>.button":"changePage","click th.sorted":"changeSort"},beforeShow:function(){var e=this.options.valueEventName;i.on("Request.getValue:"+e,this.getValue,this,"Component"),i.on("Request.restorePager:"+e,this.restorePager,this,"Component")},initGrid:function(){var e=this.options.doI18n?r.t(this.options.title):this.options.title;this.$(".caption").text(e),this.options.page&&this.options.page.length>0&&this.initPage(),this.initSort()},initPage:function(){var e=this.options.page,t=[];s.forEach(e,function(e){var i=a('<div class="ui button" data-value="'+e.value+'">'+e.name+"</div>");t.push(i)}),this.pagebar={start:1,end:1},this.perpage=e[0].value,this.page=1,this.maxPage=1,this.$(".perpage.buttons").html(t),this.$(".perpage.buttons>.button[data-value="+this.perpage+"]").addClass("active")},changePerpage:function(e){a(e.currentTarget).is(".active")||a(e.currentTarget).is(".disabled")||(this.$(".perpage.buttons>.button").removeClass("active"),a(e.currentTarget).addClass("active"),this.perpage=parseInt(a(e.currentTarget).attr("data-value")),this.page=1,this.options.static_data?this.renderComponent():this.refresh())},changePage:function(e){a(e.currentTarget).hasClass("disabled")||(a(e.currentTarget).hasClass("prev")?this.page>1&&(a(e.currentTarget).addClass("disabled"),this.page--,this.options.static_data?this.renderComponent():this.refresh()):a(e.currentTarget).hasClass("next")&&this.page<this.maxPage&&(a(e.currentTarget).addClass("disabled"),this.page++,this.options.static_data?this.renderComponent():this.refresh()))},getValue:function(){var e=this.perpage+1,t=(this.page-1)*this.perpage,i=this.order;return{limit:e,skip:t,order:i}},renderPagebar:function(e,t){this.pagebar.start=e,this.pagebar.end=t,this.$(".page-status").text(e+" - "+t),this.$(".button.next,.button.prev").addClass("disabled"),this.maxPage>this.page&&this.$(".page.buttons>.next").removeClass("disabled"),this.page>1&&this.$(".page.buttons>.prev").removeClass("disabled")},restorePager:function(){var e=this.options.page;0!==e.length&&(this.page=1)},renderGrid:function(e){var t,i;this.hideLoading(),e&&0!=e.length?this.hideNoData():this.showNoData();var n=(this.page-1)*this.perpage+1;e&&e.length>this.perpage?(this.maxPage=this.page+1,t=e.slice(0,-1),i=n+e.length-2):(this.maxPage=this.page,t=e,i=n+e.length-1),this.renderPagebar(n,i),this.table.render(t,this.options.columns,s.extend({},this.options.options,this.order))},showLoading:function(){this.$(".view-placeholder").removeClass("relative").addClass("show"),this.$("tbody").hide(),this.$(".view-placeholder>.no-data-view").is(":visible")&&this.$(".view-placeholder>.no-data-view").hide(),this.$(".view-placeholder>.loading-view").show()},hideLoading:function(){this.$(".view-placeholder").removeClass("show"),this.$("tbody").show(),this.$(".view-placeholder>.loading-view").hide()},showNoData:function(){this.$(".view-placeholder").addClass("show relative"),this.$(".view-placeholder>.no-data-view").show(),this.$(".pagination").hide(),this.$("thead").addClass("no-border")},hideNoData:function(){this.$(".view-placeholder").removeClass("show relative"),this.$(".view-placeholder>.no-data-view").hide(),this.$(".pagination").show(),this.$("thead").removeClass("no-border")},renderComponent:function(){var t=this,i=this.options.storeName,n=this.options.stateName;this.options.static_data||this.showLoading();var o=this.getValue();e.DataRepository.fetch(i,n,o).done(function(e){t.renderGrid(e)})},beforeHide:function(){var e=this.options.valueEventName;i.off("Request.getValue:"+e,"Component"),i.off("Request.restorePager:"+e,"Component"),this.table&&this.table.destroy()}})}),define("modules/clouddata/main/headerbar/TaskList/PageTable/view",["app","dispatcher","component/table/PageTable/view","extend/ui/AdvancedTable","marionette","underscore","i18n"],function(e,t,i,n,o,a,s){return i.extend({beforeShow:function(){i.prototype.beforeShow.call(this);var e=this.options.storeName;t.on("refresh:"+e,this.renderComponent,this,"Component"),t.on("startRefresh:"+e,this.showLoading,this,"Component"),t.on("Request.stopFetchProcess",this.stopFetchProcess,this,"Component"),t.on("Request.startFetchProcess",this.startFetchProcess,this,"Component"),t.on("Request.updateStatus",this.updateStatus,this,"Component")},beforeHide:function(){var e=this.options.storeName;t.off("refresh:"+e,"Component"),t.off("startRefresh:"+e,"Component"),t.off("Request.stopFetchProcess","Component"),t.off("Request.startFetchProcess","Component"),t.off("Request.updateStatus","Component"),this.stopFetchProcess(),i.prototype.beforeHide.call(this)},startFetchProcess:function(){this.fetchProcess()},stopFetchProcess:function(){this.fetchProcessHandler&&clearTimeout(this.fetchProcessHandler)},updateStatus:function(i){if(-1!=i.process){var n=this.$("td>span[data-value="+i.taskId+"]"),o=parseFloat(i.process);isNaN(o)&&(o=0),n.text((100*o).toFixed(0)+"%"),i.status&&n.parent().next().text(s.t("clouddata.tag.task-status-"+i.status))}else e.DataRepository.getStore("Store:DataIE").updateTaskById(i.taskId).done(function(e){t.request("updateStatus",{taskId:e.objectId,process:e.process,status:e.status},"Component")})},fetchProcess:function(){var i=this;0!=this.runningTask.length&&(this.fetchProcessHandler=setTimeout(function(){e.DataRepository.getStore("Store:DataIE").getProcess(i.runningTask).done(function(e){i.runningTask=[],a.forEach(e,function(e,n){-1!=e&&i.runningTask.push(n),t.request("updateStatus",{taskId:n,process:e},"Component")}),i.fetchProcess()})},1e3))},renderComponent:function(e){this.stopFetchProcess(),this.runningTask=[];var t=this;a.forEach(e,function(e){1==e.status&&t.runningTask.push(e.objectId)}),this.startFetchProcess(),i.prototype.renderComponent.call(this)},showLoading:function(){this.$(".view-placeholder").addClass("relative show"),this.$("tbody").hide(),this.$(".view-placeholder>.no-data-view").is(":visible")&&this.$(".view-placeholder>.no-data-view").hide(),this.$(".view-placeholder>.loading-view").show()},hideLoading:function(){this.$(".view-placeholder").removeClass("relative show"),this.$("tbody").show(),this.$(".view-placeholder>.loading-view").hide()},render:function(){o.ItemView.prototype.render.call(this),this.$el.i18n(),this.table=new n(this.$(".table-view"),{},this.options.columns,this.options.options),this.initGrid(),this.refresh()}})}),define("modules/clouddata/main/headerbar/TaskList/view",["app","dispatcher","core/functions/Validator","tpl!./template.html","component/dialog/BasicDialog","./PageTable/view","underscore","jquery","i18n"],function(e,t,i,n,o,a,s,r,l){return o.extend({template:n,events:{"click .dropdown-parts .item":"updateFilter","keyup input[name=search]":"changeInput","click .btn-detail":"showDetail"},beforeShow:function(){o.prototype.beforeShow.call(this),t.on("Request.getValue:TaskCondition",this.getValue,this,"Component"),r("#app-dialog .btn-back").bind("click.dataie",this.showMainTable.bind(this))},beforeHide:function(){this.tableView&&(this.tableView.beforeHide(),this.tableView.destroy(),this.tableView=null),t.off("Request.getValue:TaskCondition","Component"),o.prototype.beforeHide.call(this),r("#app-dialog .btn-back").unbind("click.dataie")},changeInput:function(e){var t=this;this.onInterval&&clearTimeout(this.onInterval),this.onInterval=setTimeout(function(){t.updateFilter(e)},200)},updateFilter:function(){t.trigger("startRefresh:Store:DataIE",{},"Component"),e.DataRepository.refresh("Store:DataIE")},getValue:function(){var e=this.$(".dropdown-parts.time").dropdown("get value"),t=this.$(".dropdown-parts.type").dropdown("get value"),i=this.$("[name=search]").val();return{time:e,type:t,search:i}},renderTable:function(e){var t=new a(e.table);t.setElement(this.$(".table-content").get(0)),t.beforeShow(),this.tableView=t,t.render()},renderSubTable:function(e){this.$(".sub-table td.class-name").text(r.isArray(e.classNames)?e.classNames.join(" ,"):""),this.$(".sub-table td.type").text(l.t("clouddata.tag.task-type-"+e.type)),this.$(".sub-table td.desc").text(e.desc)},renderLogs:function(e){this.$(".sub-table .log-content").append(e.error),this.$(".sub-table .log-content").append(e.info)},showMainTable:function(){this.$(".toolbar").show(),this.$(".table-content").show(),this.$(".sub-table .log-content").html(""),this.$(".sub-table").hide(),r("#app-dialog .btn-back").removeClass("visible"),t.request("startFetchProcess",{},"Component")},showSubTable:function(){this.$(".toolbar").hide(),this.$(".table-content").hide(),this.$(".sub-table").show(),r("#app-dialog .btn-back").addClass("visible"),t.request("stopFetchProcess",{},"Component")},render:function(e){o.prototype.render.call(this,e),this.$(".dropdown-parts.type").dropdown("set selected","all"),this.$(".dropdown-parts.time").dropdown("set selected","week"),this.renderTable(e)},showDetail:function(t){var i=this,n=r(t.currentTarget).attr("data-value");e.DataRepository.getStore("Store:DataIE").getDataById(n).done(function(e){i.renderSubTable(e),i.showSubTable()}),e.DataRepository.getStore("Store:DataIE").getLogFromTask(n).done(function(e){i.renderLogs(e)})}})}),define("tpl!modules/clouddata/main/headerbar/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<!-- henrytodo:临时加上隐藏此元素, 上传文件支持后应显示 --><div class="pull-right" style="display: none;">    <div class="ui basic pointing top right dropdown button migrate">        <span class="text" data-i18n="clouddata.tag.data-migrate"></span>        <i class="angle down icon dropdown"></i>        <div class="menu">            <div class="item data-import">                <span data-i18n="clouddata.tag.data-import"></span>            </div>            <div class="item data-export">                <span data-i18n="clouddata.tag.data-export"></span>            </div>            <div class="item task-list">                <span data-i18n="clouddata.tag.task-list"></span>            </div>        </div>    </div></div>');return __p.join("")}}),define("modules/clouddata/main/headerbar/view",["app","U","Logger","./ImportData/view","./ExportData/view","./TaskList/view","core/functions/UI","dispatcher","tpl!./template.html","marionette","jquery","i18n","semanticui_dropdown","semanticui_checkbox"],function(e,t,i,n,o,a,s,r,l,c,d,u){return c.ItemView.extend({events:{"click .item.data-import":"importData","click .item.data-export":"exportData","click .item.task-list":"showTaskList"},template:l,beforeShow:function(){r.on("Request.ImportClass",this.importData,this,"Component")},beforeHide:function(){r.off("Request.ImportClass","Component")},render:function(){c.ItemView.prototype.render.call(this),this.$el.i18n(),this.$(".ui.dropdown").dropdown({action:"hide"})},importData:function(e){s.showDialog(u.t("clouddata.tag.import-class"),n,{specialDialogUI:"import-class",options:{isWaiting:e.isWaiting},btns:{negative:"common.form.cancel",others:[{name:"clouddata.tag.finish-import",className:"blue btn-import"},{name:"clouddata.tag.wait-complete",className:"red btn-wait"},{name:"clouddata.tag.retry",className:"red btn-retry"},{name:"clouddata.tag.continue-import",className:"blue btn-continue"}]}})},exportData:function(){s.showDialog(u.t("clouddata.tag.data-export"),o,{btns:{negative:"common.form.cancel",positive:"clouddata.tag.data-export"},success:function(t){if(t.isValid()){var n=t.getValue();t.showLoading(),e.DataRepository.getStore("Store:DataIE").ExportData(n).then(function(){i.success(u.t("common.success.create")),s.hideDialog()}).finally(function(){t.hideLoading()})}}})},showTaskList:function(){s.showDialog(u.t("clouddata.tag.task-list"),a,{btns:{others:[{name:"clouddata.tag.back",className:"basic btn-back"}]},observeChanges:!0,specialDialogUI:"task-list",table:this.options.table})}})}),define("tpl!modules/clouddata/main/sidebar/newClass/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="field">        <label data-i18n="clouddata.tag.classname"></label>        <input class="validate validate-columnname" type="text" data-i18n="[placeholder]clouddata.placeholder.add-class" name="name">    </div>    <p class="tip" data-i18n="clouddata.tip.new-class"></p>    <div class="grouped fields">        <label data-i18n="clouddata.tips.set-permission"></label>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="Shared" checked="checked">                <label data-i18n="clouddata.tips.shared"></label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="Private">                <label data-i18n="clouddata.tips.private"></label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="ReadOnly">                <label data-i18n="clouddata.tips.readonly"></label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="Full">                <label data-i18n="clouddata.tips.full"></label>            </div>        </div>    </div>    <div class="ui info message">        <p data-i18n="[html]clouddata.tips.permission-type"></p>    </div></div>');return __p.join("")}}),define("modules/clouddata/main/sidebar/newClass/view",["app","tpl!./template.html","component/dialog/BasicDialog","jquery","underscore"],function(e,t,i){return i.extend({events:{"keyup input":"autoCheck"},template:t,getValue:function(){var e=this.$("[name=name]").val();return{className:e,clientPermission:{"class":{restAcl:this.$("[name=acl-type]:checked").val()}}}}})}),define("tpl!modules/clouddata/main/sidebar/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="toolbar">    <div class="ui icon input">        <i class="search icon"></i>        <input type="text" class="search-input" data-i18n ="[placeholder]common.placeholder.search">    </div></div><div class="container">    <ul>        <li class="list-msg" style="display:none">            <i class="icomoon icomoon-attention-circled"></i>            <span data-i18n="clouddata.tips.not-found"></span>        </li>    </ul></div><div class="footer">    <div class="ui labeled icon green button add-class" style="margin-bottom:10px;">        <span data-i18n="clouddata.tag.add-class"></span>        <i class="icon plus"></i>    </div>    <!-- henrytodo:临时加上隐藏此元素, 上传文件支持后应显示 -->    <div class="ui labeled icon blue button import-class" style="display: none;">        <span data-i18n="clouddata.tag.import-class"></span>        <i class="icon cloud upload"></i>    </div></div>');
return __p.join("")}}),define("modules/clouddata/main/sidebar/view",["app","U","Logger","dispatcher","core/functions/UI","./newClass/view","tpl!./template.html","marionette","jquery","underscore","i18n","nicescroll"],function(e,t,i,n,o,a,s,r,l,c,d){return r.ItemView.extend({template:s,events:{"keyup .search-input":"filterList","click .ui.button.add-class":"addClass","click .ui.button.import-class":"importClass"},init:function(){var e=this.options.storeName;this.childTemplate=c.template('<li class="list-item" data-value="<%= objectId %>" data-count="<%= count %>" data-name="<%= className %>"><a href="#classes/<%= className %>"><%= classDisplayName %><span class="badge"><%= count %></span></a></li>'),n.on("refresh:"+e,this.renderComponent,this,"Component")},beforeShow:function(){var e=this.options.valueEventName;n.on("Request.getValue:"+e,this.getValue,this,"Component"),n.on("show:Class",this.highLightItem,this,"Layout"),n.on("show:Pointer",this.highLightItem,this,"Layout"),n.on("show:Relation",this.highLightSubItem,this,"Layout")},beforeHide:function(){var e=this.options.valueEventName;n.off("show:Class","Layout"),n.off("show:Pointer","Layout"),n.off("show:Relation","Layout"),n.off("Request.getValue:"+e,"Component")},addClass:function(){var n=this.options.storeName;o.showDialog(d.t("clouddata.title.new-class"),a,{size:"small",btns:{negative:"common.form.cancel",positive:"common.form.create"},success:function(a){if(a.isValid()){var s=a.getValue();a.showLoading(),e.DataRepository.getStore(n).addData(s).done(function(){e.DataRepository.refresh("Store:Schemas"),i.success(d.t("common.success.create")),t.goTo("classes/"+s.className),o.hideDialog()},function(){a.hideLoading()})}}})},importClass:function(){n.request("ImportClass",{},"Component")},filterList:function(e){var t=this;this.onInterval&&clearTimeout(this.onInterval),this.onInterval=setTimeout(function(){t.filterListHandler(e)},200)},filterListHandler:function(e){var t=l(e.currentTarget).val();this.$(".container>ul>.list-msg").hide(),this.$(".container>ul>.list-item").show();var i=0;t&&this.$(".container>ul>.list-item").each(function(){var e=l(this).attr("data-name").toLowerCase();-1==e.indexOf(t.toLowerCase())?l(this).hide():i++}),0>=i&&""!=t&&this.showNoData()},renderDropdown:function(t){var i=this.$(".container>ul");i.find(".list-item").remove();var n=[],o=this.childTemplate;c.forEach(t,function(e){if(e.className){var t=l(o(e)).addClass("list-item");n.push(t)}}),i.append(n),this.$(".container").niceScroll(),/relation\/[a-zA-Z0-9_]+\/\w+\/([a-zA-Z0-9_]+)/.test(window.location.hash)?this.highLightSubItem({className:e.currentClass,columnName:RegExp.$1}):this.highLightItem({className:e.currentClass})},highLightItem:function(e){this.$(".list-item.sub").remove(),e.className&&(this.$(".list-item").removeClass("active"),this.$(".list-item[data-name="+e.className+"]").addClass("active"))},highLightSubItem:function(e){this.$(".list-item").removeClass("active"),this.$(".list-item.sub").remove();var t=l('<li class="list-item active sub"><a href="javascript:void(0)"><i class="icomoon icomoon-arrow"></i>'+e.columnName+"</a></li>");this.$(".list-item[data-name="+e.className+"]").addClass("active").after(t)},getValue:function(){return!1},showNoData:function(){this.$(".container>ul>.list-msg").show()},hideNoData:function(){this.$(".container>ul>.list-msg").hide()},renderComponent:function(){var t=this,i=this.options.storeName,n=this.options.stateName;this.hideNoData(),e.DataRepository.fetch(i,n).done(function(e){t.renderDropdown(e)})},render:function(){r.ItemView.prototype.render.call(this),this.$el.i18n(),this.renderComponent()}})}),define("tpl!modules/clouddata/main/toolbar/addColumn/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="field required">        <label data-i18n="clouddata.title.column-name"></label>        <input type="text" class="validate validate-columnname" name="column-name" data-i18n="[placeholder]clouddata.placeholder.add-column">    </div>    <div class="two fields">        <div class="field required fluid">            <label data-i18n="clouddata.title.column-type"></label>            <div class="ui selection dropdown dropdown-parts validate validate-required type-selector">                <input type="hidden" name="type"/>                <div class="default text" data-i18n="clouddata.title.select-type"></div>                <i class="angle down icon dropdown"></i>                <div class="menu">                    <div class="item" data-value="String">String</div>                    <div class="item" data-value="Number">Number</div>                    <div class="item" data-value="Boolean">Boolean</div>                    <div class="item" data-value="Date">Date</div>                    <div class="item" data-value="File">File</div>                    <div class="item" data-value="GeoPoint">GeoPoint</div>                    <div class="item" data-value="Array">Array</div>                    <div class="item" data-value="Object">Object</div>                    <div class="item" data-value="Pointer">Pointer</div>                    <div class="item" data-value="Relation">Relation</div>                </div>            </div>        </div>        <div class="field required" style="display:none">            <label data-i18n="clouddata.title.target-class"></label>            <div class="ui selection dropdown dropdown-parts validate-targetclass target-selector">                <input type="hidden" name="target"/>                <div class="default text" data-i18n="clouddata.title.target-class"></div>                <i class="angle down icon dropdown"></i>                <div class="menu"></div>            </div>        </div>    </div>    <p class="tip" data-i18n="clouddata.tip.add-column"></p></div>');return __p.join("")}}),define("modules/clouddata/main/toolbar/addColumn/view",["app","core/functions/Validator","tpl!./template.html","component/dialog/BasicDialog","underscore","jquery"],function(e,t,i,n,o){return n.extend({events:{"click .type-selector .item":"chooseType","click .target-selector .item":"chooseTarget","click .dropdown-parts .item":"autoCheck","keyup input":"autoCheck"},template:i,isValid:function(){var e=this.$(".type-selector").dropdown("get value"),i=this.$(".target-selector").dropdown("get value");return t.validate(this.$(".target-selector"),{type:e,target:i})&&t.check(this.$el)},chooseTarget:function(){this.isValid()},getValue:function(){var e=this.$("[name=column-name]").val(),t=this.$(".type-selector").dropdown("get value"),i=this.$(".target-selector").dropdown("get value");return{type:t,className:e,targetClass:i}},chooseType:function(){var t=this,i=this.$(".type-selector").dropdown("get value");"Pointer"==i||"Relation"==i?e.DataRepository.fetch("Store:Schemas").done(function(n){var a=t.$(".target-selector .menu").html("");o.forEach(n,function(t){(t.className!=e.currentClass||"Relation"!=i)&&a.append('<div class=item data-value="'+t.className+'">'+t.className+"</div>")}),t.$(".target-selector").dropdown("refresh"),t.$(".target-selector").dropdown("clear").i18n(),t.$(".target-selector").closest(".field").show()}):(this.$(".target-selector").dropdown("clear"),this.$(".target-selector").closest(".field").hide())}})}),define("tpl!modules/clouddata/main/toolbar/deleteColumn/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="two fields">        <div class="field required">            <label data-i18n="clouddata.title.column-name"></label>            <div class="ui selection dropdown dropdown-parts validate validate-required column-selector">                <input type="hidden" name="target"/>                <div class="default text" data-i18n="clouddata.title.target-column"></div>                <i class="angle down icon dropdown"></i>                <div class="menu"></div>            </div>        </div>    </div></div>');return __p.join("")}}),define("modules/clouddata/main/toolbar/deleteColumn/view",["app","tpl!./template.html","component/dialog/BasicDialog","underscore"],function(e,t,i,n){return i.extend({events:{"click .dropdown-parts .item":"autoCheck"},template:t,getValue:function(){var e=this.$(".column-selector").dropdown("get value");return{className:e}},render:function(){i.prototype.render.call(this);var t=this;e.DataRepository.getStore("Store:Schemas").getKeysByName(e.currentClass).done(function(e){var i=t.$(".column-selector .menu").html("");n.forEach(e,function(e){i.append('<div class=item data-value="'+e.name+'">'+e.name+"</div>")}),t.$(".column-selector").dropdown("refresh")})}})}),define("tpl!modules/clouddata/main/toolbar/setPermission/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="grouped fields">        <label data-i18n="clouddata.tips.set-permission"></label>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="Shared" checked="checked">                <label data-i18n="clouddata.tips.shared"></label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="Private">                <label data-i18n="clouddata.tips.private"></label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="ReadOnly">                <label data-i18n="clouddata.tips.readonly"></label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="Full">                <label data-i18n="clouddata.tips.full"></label>            </div>        </div>    </div>    <div class="ui info message">        <p data-i18n="[html]clouddata.tips.permission-type"></p>    </div></div>');return __p.join("")}}),define("modules/clouddata/main/toolbar/setPermission/view",["app","C","U","Logger","API","tpl!./template.html","component/dialog/BasicDialog","jquery"],function(e,t,i,n,o,a,s,r){var l=["Shared","Private","ReadOnly","Full"];return s.extend({template:a,renderComponent:function(e){if(e["class"]&&e["class"].restAcl){var t=e["class"].restAcl;r.inArray(t,l)&&this.$("input[value="+t+"]").prop("checked",!0)}},getValue:function(){return{"class":{restAcl:this.$("[name=acl-type]:checked").val()}}},render:function(){var t=this;s.prototype.render.call(this),e.DataRepository.getStore("Store:Schemas").getPermissionByName(e.currentClass).done(function(e){t.renderComponent(e)})}})}),define("tpl!modules/clouddata/main/toolbar/filter/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form condition-editor">    <div class="condition-list"></div></div>');return __p.join("")}}),define("tpl!component/filter/BasicFilterGroup/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="multiple-conditions-dialog">    <div class="conditions-list"></div>    <div class="ui icon button add-condition">        <i class="icon plus"></i>        <span data-i18n="common.title.add-condition"></span>    </div></div>');return __p.join("")}}),define("component/filter/BasicFilterGroup/childView",["app","underscore","moment","jquery","marionette","i18n","semanticui_dropdown"],function(e,t,i,n,o,a){var s="YYYY-MM-DD HH:mm:ss.SSS",r="YYYY-MM-DDTHH:mm:ss.SSS";return o.ItemView.extend({events:{"click .icon.remove":"removeSelf","click .field .menu>.item":"clickDropdown","keyup .field>input":"keyupInput","change .date-editor":"changeDate"},init:function(){this.template=this.options.childTemplate?t.template(this.options.childTemplate):""},beforeHide:function(){this.$(".ui.dropdown").each(function(e,t){n(t).data("moduleDropdown")&&n(t).dropdown("destroy")}),this.$(".date-editor").each(function(){var e=n(this).data("daterangepicker");e&&e.remove()})},removeSelf:function(){this._parent.removeItem(this.cid)},renderComponent:function(){this.beforeHide(),this.$el.html(this.template(this)),this.$(".ui.dropdown").dropdown({action:"hide"}),"Date"==this.data.type&&this.data.value&&this.data.value.iso&&this.$(".date-editor").daterangepicker({singleDatePicker:!0,autoApply:!0,opens:"left",timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0})},render:function(e){this.data=e,this.renderComponent(),this.$el.i18n()},clickDropdown:function(e){var t=n(e.currentTarget).attr("data-value"),i=n(e.currentTarget).attr("data-type"),o=n(e.currentTarget).closest(".field").attr("data-type");this._parent.updateItem(this.cid,o,t,i)},keyupInput:function(e){var t=n(e.currentTarget).val(),i=n(e.currentTarget).closest(".field").attr("data-type")||"value";this._parent.updateItem(this.cid,i,t)},changeDate:function(e){var t=n(e.currentTarget).data("daterangepicker"),i=t?t.startDate:!1;if(i){var o=n(e.currentTarget).parents(".field").attr("data-type")||"value";this._parent.updateItem(this.cid,o,{__type:"Date",iso:i.format(r)+"Z"})}},generateList:function(e){var i="";return t.forEach(e,function(e){i+='<div class="item" data-name="'+e.name+'" data-value="'+e.value+'">'+(e.text?e.text:e.name)+"</div>"}),i},generateColumnList:function(e){var i="";return t.forEach(e,function(e){i+='<div class="item" data-name="'+e.name+'" data-value="'+e.name+'" data-type="'+e.value+'">'+(e.text?e.text:e.name)+"</div>"}),i},generateValueEditor:function(){var e=this.data.op;if(e){if(t.contains(["exists","not exists"],e))return"";if(t.contains(["before","after"],e)){var n;return n="undefined"!=typeof this.data.value&&this.data.value?i(this.data.value.iso,r).format(s):"",'<input type="text" class="date-editor value-editor" value="'+n+'">'}return'<input type="text" class="value-editor" value="'+(this.data.value?this.data.value:"")+'">'}return""},isInColumnList:function(e,i,n){var o=t.find(e,function(e){return e.name==i});return o?o.text?o.text:o.name:a.t(n)},isInList:function(e,i,n){var o=t.find(e,function(e){return e.value==i});return o?o.text?o.text:o.name:a.t(n)},isExist:function(e,t){return e?e:t}})}),define("component/filter/BasicFilterGroup/view",["app","U","tpl!./template.html","./childView","jquery","marionette","underscore","i18n"],function(e,t,i,n,o,a,s){return a.ItemView.extend({template:i,childViewContainer:".condition-list",events:{"click .button.add-condition":"addItemHandler"},beforeShow:function(){},beforeHide:function(){this.$(".ui.dropdown").each(function(e,t){o(t).data("moduleDropdown")&&o(t).dropdown("destroy")}),this.$(".date-editor").each(function(){var e=o(this).data("daterangepicker");e&&e.remove()})},initFilter:function(){this.childView=this.options.childView||n,this.children={}},getChildView:function(){return this.childView},getValue:function(){},addItemHandler:function(){var e=this.addItem();e.init(),e.beforeShow&&e.beforeShow(),e.render()},addItem:function(){var e=this.getChildView(),t=new e(this.options.childOptions),i=document.createElement("div");return t.setElement(i),this.$(this.childViewContainer).append(i),t.$el.addClass("fields"),t._parent=this,this.children[t.cid]=t,t},removeItem:function(e){var t=this.children[e];if(!t)throw new Error("BasicFilterGroup: child("+e+") not exist");t.beforeHide&&t.beforeHide(),t.destroy(),delete this.children[e]},clearAllItem:function(){var e=this;s.forEach(s.keys(this.children),function(t){e.removeItem(t)})},updateItem:function(e){var t=this.children[e];if(!t)throw new Error("BasicFilterGroup: child("+e+") not exist");t.renderComponent()},render:function(){a.ItemView.prototype.render.call(this),this.$el.i18n(),this.initFilter()}})}),define("modules/clouddata/main/toolbar/filter/FilterView",["app","Storage","dispatcher","C","tpl!./template.html","component/filter/BasicFilterGroup/view","jquery","underscore","moment","daterangepicker"],function(e,t,i,n,o,a,s,r,l){return a.extend({events:{"click .button.clear-all":"clearAllItem"},template:o,beforeShow:function(){a.prototype.beforeShow.call(this),i.on("click:addCondition",this.addItemHandler,this,"Component")},beforeHide:function(){i.off("click:addCondition","Component"),a.prototype.beforeHide.call(this)},addItemHandler:function(){var e=this.addItem();e.init(),e.beforeShow&&e.beforeShow(),e.render({op_list:n.get("Filter"),column_list:this.column_list})},updateItem:function(e,t,i,n){var o=this.children[e];if(!o)throw new Error("BasicFilterGroup: child("+e+") not exist");"column"==t&&o.data.column!=i?this.setColumn(o,i,n):"op"==t&&o.data.op!=i?this.setOp(o,i):"value"==t&&this.setValue(o,i)},setColumn:function(e,t,i){e.data.column=t,e.data.type=i,e.data.op=null,e.data.value=null,e.renderComponent()},setOp:function(e,i){e.data.op=i,e.data.value=null,e.renderComponent(),"before"==i||"after"==i?(this.$(".date-editor").each(function(){var e=s(this).data("daterangepicker");e&&e.remove()}),l.locale(t.get("moment")),this.$(".date-editor").daterangepicker({singleDatePicker:!0,autoApply:!0,opens:"left",timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0}),e.$(".date-editor").focus()):("exists"==i||"not exists"==i)&&(e.data.value="exists"==i?!0:!1)},setValue:function(e,t){e.data.value=t},setColumns:function(e){var t=[];t.push({name:"objectId",type:"String"}),t.push({name:"createdAt",type:"Date"}),t.push({name:"updatedAt",type:"Date"}),this.column_list=r.map(t.concat(e),function(e){return{name:e.name,value:e.type}})},getValue:function(){return this.condition},generateCondition:function(){var e=r.chain(this.children).values().map(function(e){var t=e.data.value;if("Number"==e.data.type){try{t=parseFloat(e.data.value)}catch(i){t=0}isNaN(t)&&(t=null)}return{field:e.data.column,op:e.data.op,type:e.data.type,value:t}}).reject(function(e){return!e.field||!e.op}).value(),t={};return r.forEach(e,function(e){var i;if(r.contains(["eq","ne","gt","gte","lt","lte"],e.op))i=JSON.parse('{"$'+e.op+'":'+JSON.stringify(e.value)+"}");else if("exists"==e.op||"not exists"==e.op)i={$exists:"exists"==e.op};else if("before"==e.op||"after"==e.op)i="before"==e.op?{$lte:e.value}:{$gte:e.value};else if("start with"==e.op)i={$regex:"^\\Q"+e.value+"\\E"};else if("in"==e.op||"nin"==e.op){var n=e.value?e.value.split(","):[];i="in"==e.op?{$in:n}:{$nin:n}}else i="contains"==e.op||"not contains"==e.op?"contains"==e.op?{$eq:e.value}:{$ne:e.value}:{};t[e.field]=r.extend({},t[e.field],i)}),t},resetCondition:function(){this.clearAllItem(),this.condition={},this.condition_count=0},clearAllItem:function(){a.prototype.clearAllItem.call(this),this.condition_count=0},applyCondition:function(){this.condition=this.generateCondition(),this.condition_count=r.keys(this.children).length,i.trigger("apply:Condition",this.condition,"Component"),this.clearAllItem()},renderCondition:function(){function e(e,t){var i;if("Object"==e||"Array"==e)try{i=JSON.stringify(t)}catch(n){}else i="Date"==e?t:t;return i}var t=this;r.forEach(this.condition,function(i,o){var a=t.addItem();a.init(),a.beforeShow&&a.beforeShow();var s={op_list:n.get("Filter"),column_list:t.column_list};s.column=o;var l=r.find(t.column_list,function(e){return e.name==o});s.type=l?l.value:"String",i.$eq?(s.op="Array"==s.type?"contains":"eq",s.value=e(s.type,i.$eq)):i.$ne?(s.op="Array"==s.type?"not contains":"ne",s.value=e(s.type,i.$ne)):i.$gt?(s.op="gt",s.value=e(s.type,i.$gt)):i.$gte?(s.op="Date"==s.type?"after":"gte",s.value=e(s.type,i.$gte)):i.$lt?(s.op="lt",s.value=e(s.type,i.$lt)):i.$lte?(s.op="Date"==s.type?"before":"lte",s.value=e(s.type,i.$lte)):"boolean"==typeof i.$exists?s.op=i.$exists?"exists":"not exists":i.$regex?(s.op="start with",s.value=i.$regex.slice(3,-2)):i.$in?(s.op="in",s.value=i.value):i.$nin&&(s.op="nin",s.value=i.value),a.render(s)})},render:function(e){a.prototype.render.call(this,e),e.columns&&this.setColumns(e.columns),this.condition=e.condition,this.renderCondition()}})}),define("tpl!modules/clouddata/main/toolbar/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<!--<div class="ui breadcrumb pull-left"></div>--><div class="ui info message" style="padding: 15px;margin-bottom: 20px;display:none;"><span data-i18n="[html]clouddata.tips.large-data"></span></div><div class="toolbar pull-left">    <div class="ui basic icon button add-row">        <i class="icomoon icomoon-plus"></i>        <span data-i18n="clouddata.tag.add-row"></span>    </div>    <div class="ui basic icon button delete-row disabled">        <i class="icomoon icomoon-minus"></i>        <span data-i18n="clouddata.tag.rm-row"></span>    </div>    <div class="ui basic icon button add-col">        <i class="icomoon icomoon-plus"></i>        <span data-i18n="clouddata.tag.add-col"></span>    </div>    <div class="ui basic icon button filter">        <i class="icomoon icomoon-filter"></i>        <span data-i18n="clouddata.tag.filter"></span>        <div id="filter-content"></div>    </div>    <div class="ui basic pointing top right dropdown button more">        <span class="text" data-i18n="clouddata.tag.more"></span>        <i class="angle down icon dropdown"></i>        <div class="menu">            <div class="item delete-col">                <span data-i18n="clouddata.tag.rm-col"></span>            </div>            <div class="item delete-class">                <span data-i18n="clouddata.tag.rm-class"></span>            </div>            <div class="item set-permission">                <span data-i18n="clouddata.tag.set-permission"></span>            </div>        </div>    </div></div><div class="toolbar pull-right">    <div class="ui pointing top right dropdown show-column">        <i class="icomoon icomoon-table"></i>        <div class="menu">            <div class="scrolling menu">                <div class="item"></div>            </div>        </div>    </div>    <div class="ui refresh">        <i class="icomoon icomoon-refresh"></i>    </div>    <div class="ui fullscreen">        <i class="icomoon icomoon-expand"></i>    </div></div>');return __p.join("")}}),define("modules/clouddata/main/toolbar/view",["app","U","Logger","core/functions/UI","dispatcher","./addColumn/view","./deleteColumn/view","./setPermission/view","./filter/FilterView","tpl!./template.html","marionette","jquery","underscore","i18n","semanticui_dropdown","semanticui_checkbox"],function(e,t,i,n,o,a,s,r,l,c,d,u,p,h){return d.ItemView.extend({events:{"click .button.add-row":"addRow","click .button.delete-row":"deleteRow","click .button.add-col":"addCol","click .item.delete-col":"deleteCol","click .item.delete-class":"deleteClass","click .item.set-permission":"setPermission","click .ui.refresh":"refreshGrid","click .ui.fullscreen":"toggleFullScreen","click .ui.show-column":"renderColumnMenuBeforeOpen","click .ui.show-column .item":"toggleColumnItem","click .button.filter":"toggleFilter"},template:c,beforeShow:function(){o.on("show:Class",this.toggleStatusClass,this,"Layout"),o.on("show:Pointer",this.toggleStatusPointer,this,"Layout"),o.on("show:Relation",this.toggleStatusRelation,this,"Layout"),o.on("apply:Condition",this.applyCondition,this,"Component"),o.on("Request.get:condition",this.getValue,this,"Component"),o.on("select:Row",this.toggleDelRow,this,"Component")},beforeHide:function(){o.off("show:Class","Layout"),o.off("show:Pointer","Layout"),o.off("show:Relation","Layout"),o.off("apply:Condition","Component"),o.off("Request.get:condition","Component"),o.off("select:Row","Component")},addRow:function(e){u(e.currentTarget).hasClass("disabled")||o.trigger("add:Row",{},"Component")},deleteRow:function(e){u(e.currentTarget).hasClass("disabled")||n.showDialog(h.t("clouddata.title.delete-row"),h.t("clouddata.tip.sure-delete"),{size:"small",success:function(){o.trigger("delete:Row",{},"Component"),n.hideDialog()}})},addCol:function(t){u(t.currentTarget).hasClass("disabled")||n.showDialog(h.t("clouddata.title.add-column"),a,{success:function(t){if(t.isValid()){var o=t.getValue();t.showLoading(),e.DataRepository.getStore("Store:Schemas").addKey(e.currentClass,o.className,o.type,o.targetClass).then(function(){e.DataRepository.refresh("Store:Schemas"),i.success(h.t("common.success.create")),n.hideDialog()}).finally(function(){t.hideLoading()})}}})},deleteCol:function(t){u(t.currentTarget).hasClass("disabled")||n.showDialog(h.t("clouddata.title.delete-column"),s,{size:"small",success:function(t){if(t.isValid()){var o=t.getValue();t.showLoading(),e.DataRepository.getStore("Store:Schemas").deleteKey(e.currentClass,o.className).then(function(){i.success(h.t("common.success.delete")),e.DataRepository.refresh("Store:Schemas"),n.hideDialog()}).finally(function(){t.hideLoading()})}}})},deleteClass:function(o){u(o.currentTarget).hasClass("disabled")||n.showDialog(h.t("clouddata.title.delete-class"),h.t("clouddata.tip.sure-delete"),{size:"small",success:function(){e.DataRepository.getStore("Store:Schemas").deleteData(e.currentClass).done(function(){i.success(h.t("common.success.delete")),e.DataRepository.refresh("Store:Schemas"),t.goTo("classes"),n.hideDialog()})}})},setPermission:function(t){u(t.currentTarget).hasClass("disabled")||n.showDialog(h.t("clouddata.title.set-permission"),r,{success:function(t){var o=t.getValue();t.showLoading(),e.DataRepository.getStore("Store:Schemas").setPermission(e.currentClass,o).then(function(){i.success(h.t("common.success.change")),e.DataRepository.refresh("Store:Schemas"),n.hideDialog()}).finally(function(){t.hideLoading()})}})},toggleDelRow:function(e){this.$(".delete-row").addClass("disabled"),e.disabled||this.$(".delete-row").hasClass("locked")||this.$(".delete-row").removeClass("disabled")},toggleFullScreen:function(e){u("#clouddata-main").toggleClass("full"),u(e.currentTarget).children("i").toggleClass("icomoon-expand icomoon-quit-fullscreen"),o.request("set:Hscroll",{},"Component")},toggleStatusClass:function(){this.clearCondition(),this.$(".add-row,.add-col,.more,.filter,.refresh").removeClass("disabled"),this.$(".delete-row").removeClass("locked"),u("#data-page-grid .pagination .perpage.buttons").removeClass("disabled")},toggleStatusPointer:function(){this.clearCondition(),this.$(".add-row,.add-col,.more,.filter,.refresh").addClass("disabled"),this.$(".delete-row").addClass("locked"),u("#data-page-grid .pagination .perpage.buttons").addClass("disabled")},toggleStatusRelation:function(){this.clearCondition(),this.$(".add-row,.refresh").removeClass("disabled"),this.$(".add-col,.more,.filter").addClass("disabled"),this.$(".delete-row").removeClass("locked"),u("#data-page-grid .pagination .perpage.buttons").removeClass("disabled")},render:function(){d.ItemView.prototype.render.call(this),this.$el.i18n(),this.$(".ui.dropdown.more").dropdown({action:"hide"}),this.$(".ui.dropdown.show-column").dropdown({action:"nothing"})},refreshGrid:function(e){u(e.currentTarget).hasClass("disabled")||(u(e.currentTarget).addClass("active"),setTimeout(function(){u(e.currentTarget).removeClass("active")},300),o.trigger("refresh:Grid",{},"Component"))},renderColumnMenuBeforeOpen:function(e){if(!u(e.currentTarget).hasClass("visible")){var t=o.request("get:originColumns",{},"Component"),i=o.request("get:mask",{},"Component"),n=[];p.forEach(["objectId","createdAt","updatedAt","ACL"],function(e){n.push({name:e,checked:!p.contains(i,e)})}),p.forEach(t,function(e){n.push({name:e.name,checked:!p.contains(i,e.name)})});var a=this.$(".ui.dropdown.show-column .scrolling.menu").html("");p.forEach(n,function(e){a.append('<div class="item"><div class="ui checkbox" data-value="'+e.name+'"><input type="checkbox" '+(e.checked?"checked":"")+" ><label>"+e.name+"</label></div></div>")}),this.$(".ui.dropdown.show-column").dropdown("refresh"),this.$(".ui.dropdown.show-column .checkbox").checkbox()}},toggleColumnItem:function(e){var t=u(e.srcElement||e.target);if("item"==t.attr("class"))return t.find("label").click(),!1;if(t.is("label")){var i=[];this.$(".show-column .item>.checkbox").each(function(e,t){u(t).checkbox("is checked")||i.push(u(t).attr("data-value"))}),o.request("set:mask",i,"Component"),e.stopPropagation()}},toggleFilter:function(t){var i=this;u(t.currentTarget).hasClass("disabled")||e.DataRepository.getStore("Store:Schemas").getKeysByName(e.currentClass).done(function(e){n.showDialog(h.t("clouddata.title.set-filter"),l,p.extend({},{specialDialogUI:"set-filter",btns:{negative:"common.form.cancel",positive:"common.form.apply",others:[{name:"common.title.add-condition",className:"icon basic add-condition",icon:"plus",onClick:"addCondition"}]},observeChanges:!0,columns:e,condition:i.filterCondition?i.filterCondition:{},success:function(e){e.applyCondition(),n.hideDialog()}},i.options.filter))})},getValue:function(){return this.filterCondition},clearCondition:function(){this.$(".button.filter").removeClass("active"),this.filterCondition=!1},applyCondition:function(e){this.filterCondition=e,e&&0!=p.keys(e).length?this.$(".button.filter").addClass("active"):this.$(".button.filter").removeClass("active")}})}),define("core/functions/Editors/Base",["dispatcher","jquery","underscore"],function(e,t,i){function n(n,o){i.extend(o,{init:function(){o.input=t("<input type=text class='editor-text' />").appendTo(n.container).bind("keydown.nav",function(e){(e.keyCode===t.ui.keyCode.LEFT||e.keyCode===t.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}).focus().select(),o.afterInit&&o.afterInit()},destroy:function(){o.input.unbind(".slick"),o.input.parents(".slick-cell").removeClass("error"),o.input.remove()},focus:function(){o.input.focus()},getValue:function(){return o.input.val()},setValue:function(e){o.input.val(e)},serializeValue:function(){return o.input.val()},loadValue:function(e){o.defaultValue=e[n.column.field]||"",o.input.val(o.defaultValue),o.input[0].defaultValue=o.defaultValue,o.input.select()},isValueChanged:function(){return!(""==o.input.val()&&null==o.defaultValue)&&o.input.val()!=o.defaultValue},validate:function(){if(n.column.validator){var e=n.column.validator(o.input.val());if(!e.valid)return e}return{valid:!0,msg:null}},applyValue:function(t,o){var a=n.grid.getActiveCell().row,s=n.grid.getData()[a],r={};t[n.column.field]=o,""!=t.objectId&&t.objectId?(r[n.column.field]=t[n.column.field],e.trigger("update:Class",{model:s,data:r},"Component")):(i.forEach(t,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(r[t]=e)}),e.trigger("create:Class",{model:s,data:r},"Component"))}})}return n}),define("core/functions/Editors/Text",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(o){this.input={},this.defaultValue="";var a=this;e(o,a),n.extend(this,{init:function(){a.input=i("<textarea></textarea>").appendTo(o.container).bind("keydown.nav",function(e){(e.keyCode===i.ui.keyCode.LEFT||e.keyCode===i.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}),setTimeout(function(){a.input.focus().select()},0)},loadValue:function(e){a.defaultValue="string"==typeof e[o.column.field]?e[o.column.field]:"",a.input.val(a.defaultValue),a.input[0].defaultValue=a.defaultValue,a.input.select()},isValueChanged:function(){return!0},applyValue:function(e,i){if(e[o.column.field]!=i){var a=o.grid.getActiveCell().row,s=o.grid.getData()[a],r={};e[o.column.field]=i,""!=e.objectId&&e.objectId?(r[o.column.field]=e[o.column.field],t.trigger("update:Class",{model:s,data:r},"Component")):(n.forEach(e,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(r[t]=e)}),t.trigger("create:Class",{model:s,data:r},"Component"))}}}),this.init()}return o}),define("core/functions/Editors/Integer",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(t){this.input={},this.defaultValue="";var i=this;e(t,i),n.extend(this,{afterInit:function(){i.input.bind("keyup.slick",function(){1==i.validate().valid?i.input.parent(".slick-cell").removeClass("error"):i.input.parent(".slick-cell").addClass("error")})},validate:function(){return isNaN(i.input.val())?{valid:!1,msg:"error.format.integer"}:{valid:!0,msg:null}},serializeValue:function(){return parseFloat(i.input.val())||0}}),this.init()}return o
}),define("core/functions/Editors/Date",["C","Storage","./Base","dispatcher","jquery","underscore","moment","daterangepicker"],function(e,t,i,n,o,a,s){function r(e){this.input={},this.defaultValue="";var r=this;i(e,r),a.extend(this,{init:function(){r.input=o('<input type="text" class="app-calendar" name="daterangepicker_start">'),r.input.appendTo(e.container).bind("keydown.nav",function(e){(e.keyCode===o.ui.keyCode.LEFT||e.keyCode===o.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}),s.locale(t.get("moment")),r.input.daterangepicker({singleDatePicker:!0,autoApply:!0,opens:"left",timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0}),r.input.on("apply.daterangepicker",function(){e.commitChanges()}),r.input.on("cancel.daterangepicker",function(){e.cancelChanges()})},loadValue:function(t){var i=t[e.column.field]||{};if(r.defaultValue=i.iso||"",r.input.val(r.defaultValue),r.defaultValue){var n=r.input.data("daterangepicker");n&&(n.setStartDate(r.defaultValue),n.setEndDate(r.defaultValue))}r.input.focus()},isValueChanged:function(){return!(""==r.input.val()&&null==r.defaultValue)&&r.input.val()+".000"!=r.defaultValue},destroy:function(){r.input.data("daterangepicker").remove(),r.input.remove()},applyValue:function(t,i){var o=e.grid.getActiveCell().row,r=e.grid.getData()[o],c={},d=s(i,l).format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z";t[e.column.field]={__type:"Date",iso:d},""!=t.objectId&&t.objectId?(c[e.column.field]=t[e.column.field],n.trigger("update:Class",{model:r,data:c},"Component")):(a.forEach(t,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(c[t]=e)}),n.trigger("create:Class",{model:r,data:c},"Component"))}}),this.init()}var l="YYYY-MM-DD HH:mm:ss.SSS";return r}),define("core/functions/Editors/Boolean",["./Base","dispatcher","jquery","underscore","semanticui_checkbox"],function(e,t,i,n){function o(t){this.input={},this.defaultValue="";var o=this;e(t,o),n.extend(this,{init:function(){o.input=i('<div class="boolean-editor"><div class="ui radio checkbox true"><input type="radio" name="boolean" value="true" class="hidden"><label>True</label></div><div class="ui radio checkbox false"><input type="radio" name="boolean" value="false" class="hidden"><label>False</label></div></div>'),o.input.appendTo(t.container),o.input.children(".ui.radio").checkbox()},destroy:function(){o.input.children(".ui.radio").checkbox("destroy"),o.input.unbind(".slick"),o.input.remove()},isValueChanged:function(){return o.input.find(".checked").is(".true")!=o.defaultValue||"boolean"!=typeof o.defaultValue},serializeValue:function(){return o.input.find(".checked").is(".true")},loadValue:function(e){var i=e[t.column.field]?!0:!1;"object"!=typeof e[t.column.field]&&(o.defaultValue=e[t.column.field]),o.input.find(".ui.radio."+i).checkbox("set checked")}}),this.init()}return o}),define("core/functions/Editors/Fixed",["./Base","dispatcher","jquery","moment","underscore"],function(e,t,i,n,o){function a(t){this.input={},this.defaultValue="";var n=this;e(t,n),o.extend(this,{init:function(){n.input=i("<input type=text class='editor-text' readonly />").appendTo(t.container).bind("keydown.nav",function(e){(e.keyCode===i.ui.keyCode.LEFT||e.keyCode===i.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}),setTimeout(function(){n.input.focus().select()},0)},isValueChanged:function(){return!(""==n.input.val()&&null==n.defaultValue)&&n.input.val()!=n.defaultValue},loadValue:function(e){if("Date"==t.column.type){var i=e[t.column.field];i&&(n.defaultValue=i,n.input.val(n.defaultValue))}else n.defaultValue=e[t.column.field]||"",n.input.val(n.defaultValue)}}),this.init()}return a}),define("core/functions/Editors/Array",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(o){this.input={},this.defaultValue="";var a=this;e(o,a),n.extend(this,{init:function(){a.input=i("<input type=text class='editor-text' placeholder='[\"var\",\"foo\",0...]'/>").appendTo(o.container).bind("keydown.nav",function(e){(e.keyCode===i.ui.keyCode.LEFT||e.keyCode===i.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}).focus().select(),a.afterInit&&a.afterInit()},loadValue:function(e){null==e[o.column.field]&&(e[o.column.field]=void 0);var t=JSON.stringify(e[o.column.field]);a.defaultValue=t,a.input.val(t)},afterInit:function(){a.input.bind("keyup.slick",function(){1==a.validate().valid?a.input.parent(".slick-cell").removeClass("error"):a.input.parent(".slick-cell").addClass("error")})},validate:function(){try{JSON.parse(a.input.val())}catch(e){return{valid:!1,msg:"error.format.json"}}return/^\[.*\]$/.test(a.input.val())?{valid:!0,msg:null}:{valid:!1,msg:"error.format.array"}},applyValue:function(e,i){var a=o.grid.getActiveCell().row,s=o.grid.getData()[a],r={};e[o.column.field]=JSON.parse(i),""!=e.objectId&&e.objectId?(r[o.column.field]=e[o.column.field],t.trigger("update:Class",{model:s,data:r},"Component")):(n.forEach(e,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(r[t]=e)}),t.trigger("create:Class",{model:s,data:r},"Component"))}}),this.init()}return o}),define("core/functions/Editors/Object",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(o){this.input={},this.defaultValue="";var a=this;e(o,a),n.extend(this,{init:function(){a.input=i("<input type=text class='editor-text' placeholder='{\"key\":\"val\",...}'/>").appendTo(o.container).bind("keydown.nav",function(e){(e.keyCode===i.ui.keyCode.LEFT||e.keyCode===i.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}).focus().select(),a.afterInit&&a.afterInit()},afterInit:function(){a.input.bind("keyup.slick",function(){1==a.validate().valid?a.input.parent(".slick-cell").removeClass("error"):a.input.parent(".slick-cell").addClass("error")})},loadValue:function(e){null==e[o.column.field]&&(e[o.column.field]=void 0);var t=JSON.stringify(e[o.column.field]);a.defaultValue=t,a.input.val(t)},validate:function(){try{JSON.parse(a.input.val())}catch(e){return{valid:!1,msg:"error.format.json"}}return/^\{.*\}$/.test(a.input.val())?{valid:!0,msg:null}:{valid:!1,msg:"error.format.object"}},applyValue:function(e,i){var a=o.grid.getActiveCell().row,s=o.grid.getData()[a],r={};e[o.column.field]=JSON.parse(i),""!=e.objectId&&e.objectId?(r[o.column.field]=e[o.column.field],t.trigger("update:Class",{model:s,data:r},"Component")):(n.forEach(e,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(r[t]=e)}),t.trigger("create:Class",{model:s,data:r},"Component"))}}),this.init()}return o}),define("core/functions/Editors/Pointer",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(i){this.input={},this.defaultValue="";var o=this;e(i,o),n.extend(this,{loadValue:function(e){var t=e[i.column.field]||{},n=t.objectId||"";o.defaultValue=n,o.input.val(n)},applyValue:function(e,o){var a=i.grid.getActiveCell().row,s=i.grid.getData()[a],r={},l=i.grid.getActiveCell().cell,c=i.grid.getColumns()[l];e[i.column.field]={objectId:o,__type:"Pointer",className:c.className},""!=e.objectId&&e.objectId?(r[i.column.field]=e[i.column.field],t.trigger("update:Class",{model:s,data:r},"Component")):(n.forEach(e,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(r[t]=e)}),t.trigger("create:Class",{model:s,data:r},"Component"))}}),this.init()}return o}),define("core/functions/Editors/GeoPoint",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(o){this.input={},this.defaultValue="";var a=this;e(o,a),n.extend(this,{init:function(){a.input=i('<input type="text" placeholder="0,0" />').appendTo(o.container).bind("keydown.nav",function(e){(e.keyCode===i.ui.keyCode.LEFT||e.keyCode===i.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}).focus().select()},loadValue:function(e){var t=e[o.column.field]||"";t?(a.defaultValue=[t.latitude,t.longitude],a.input.val(t.latitude+","+t.longitude)):a.defaultValue=[0,0]},validate:function(){var e;try{e=JSON.parse("["+a.input.val()+"]")}catch(t){return{valid:!1,msg:"error.format.array"}}return 2!=e.length?{valid:!1,msg:"error.format.geo"}:i.isNumeric(e[0])&&i.isNumeric(e[1])?Math.abs(e[0])>90||Math.abs(e[1])>180?{valid:!1,msg:"error.format.geo"}:{valid:!0,msg:null}:{valid:!1,msg:"error.format.integer"}},getValue:function(){var e=[0,0];try{e=JSON.parse("["+a.input.val()+"]")}catch(t){return[0,0]}return e},setValue:function(e){a.input.val(e.latitude+","+e.longitude)},isValueChanged:function(){var e;try{e=JSON.parse("["+a.input.val()+"]")}catch(t){return!0}return 2!=e.length||e[0]!=a.defaultValue[0]||e[1]!=a.defaultValue[1]},serializeValue:function(){var e=a.input.val();return JSON.parse("["+e+"]")},applyValue:function(e,i){var a=o.grid.getActiveCell().row,s=o.grid.getData()[a],r={};e[o.column.field]={__type:"GeoPoint",latitude:parseFloat(i[0]||0),longitude:parseFloat(i[1]||0)},""!=e.objectId&&e.objectId?(r[o.column.field]=e[o.column.field],t.trigger("update:Class",{model:s,data:r},"Component")):(n.forEach(e,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(r[t]=e)}),t.trigger("create:Class",{model:s,data:r},"Component"))}}),this.init()}return o}),define("core/functions/Editors/ACL",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(o){this.input={},this.defaultValue="";var a=this;e(o,a),n.extend(this,{init:function(){a.input=i("<input type=text class='editor-text' placeholder='{\"key\":\"val\",...}'/>").appendTo(o.container).bind("keydown.nav",function(e){(e.keyCode===i.ui.keyCode.LEFT||e.keyCode===i.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}),setTimeout(function(){a.input.focus().select()},0)},loadValue:function(e){null==e[o.column.field]&&(e[o.column.field]=void 0);var t=JSON.stringify(e[o.column.field]);a.defaultValue=t,a.input.val(t)},validate:function(){try{JSON.parse(a.input.val())}catch(e){return{valid:!1,msg:"error.format.json"}}return/^\{.*\}$/.test(a.input.val())?{valid:!0,msg:null}:{valid:!1,msg:"error.format.object"}},applyValue:function(e,i){var a=o.grid.getActiveCell().row,s=o.grid.getData()[a],r={};e[o.column.field]=JSON.parse(i),""!=e.objectId&&e.objectId?(r[o.column.field]=e[o.column.field],t.trigger("update:Class",{model:s,data:r},"Component")):(n.forEach(e,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(r[t]=e)}),t.trigger("create:Class",{model:s,data:r},"Component"))}}),this.init()}return o}),define("core/functions/Editors/Password",["./Base","dispatcher","jquery","underscore"],function(e){function t(t){this.input={},this.defaultValue="";var i=this;e(t,i),this.init()}return t}),define("core/functions/Editors/File",["./Base","dispatcher","jquery","underscore"],function(e,t,i,n){function o(t){this.input={},this.defaultValue="";var o=this;e(t,o),n.extend(this,{init:function(){o.input=i("<INPUT type=text class='editor-text' readonly />").appendTo(t.container).bind("keydown.nav",function(e){(e.keyCode===i.ui.keyCode.LEFT||e.keyCode===i.ui.keyCode.RIGHT)&&e.stopImmediatePropagation()}),setTimeout(function(){o.input.focus().select()},0)},isValueChanged:function(){return!1},loadValue:function(e){o.defaultValue=e[t.column.field]||"",o.input.val(o.defaultValue.url)}}),this.init()}return o}),define("core/functions/Editor",["./Editors/Text","./Editors/Integer","./Editors/Date","./Editors/Boolean","./Editors/Fixed","./Editors/Array","./Editors/Object","./Editors/Pointer","./Editors/GeoPoint","./Editors/ACL","./Editors/Password","./Editors/File"],function(e,t,i,n,o,a,s,r,l,c,d,u){return{Password:d,Text:e,Integer:t,Fixed:o,Boolean:n,Date:i,Array:a,Pointer:r,Object:s,GeoPoint:l,ACL:c,File:u}}),define("core/functions/ColumnFormatter",["moment","i18n"],function(e,t){var i="YYYY-MM-DD HH:mm:ss.SSS",n="YYYY-MM-DDTHH:mm:ss.SSS";return{EmptyFormatter:function(e,t,i){return"undefined"==typeof i||"object"==typeof i?'<span class="light">(undefined)</span><i class="icon btn-edit pencil"></i>':i+'<i class="icon btn-edit pencil"></i>'},NumberFormatter:function(e,t,i){return""===i||null==i?'<span class="light">(undefined)</span><i class="icon btn-edit pencil"></i>':parseFloat(i)+'<i class="icon btn-edit pencil"></i>'},PasswordFormatter:function(){return'<span>(hidden)</span><i class="icon btn-edit pencil"></i>'},PointerFormatter:function(e,t,i){return"undefined"==typeof i||null==i||"undefined"==typeof i.className?'<span class="light">(undefined)</span><i class="icon btn-edit pencil"></i>':'<div class="wrapper"><a href="#classes/'+i.className+"/"+i.objectId+'">'+i.objectId+'</a></div><i class="icon btn-edit pencil"></i>'},RelationFormatter:function(e,i,n,o,a){var s=a.objectId,r=o.className;return"undefined"==typeof s||null==s?'<div class="wrapper"><a href="javascript:void(0)">'+t.t("clouddata.tag.add-relation")+"</a></div>":'<div class="wrapper"><a href="#relation/'+r+"/"+a.objectId+"/"+o.field+'">'+t.t("clouddata.tag.view-relation")+"</a></div>"},JSONFormatter:function(e,t,i){return"undefined"==typeof i||null==i?'<span class="light">(undefined)</span><i class="icon btn-edit pencil"></i>':JSON.stringify(i)+'<i class="icon btn-edit pencil"></i>'},ACLFormatter:function(e,t,i){return"undefined"==typeof i||null==i?'<i class="icon btn-edit pencil"></i>':JSON.stringify(i)+'<i class="icon btn-edit pencil"></i>'},DateFormatter:function(t,o,a){if("undefined"==typeof a||null==a||"undefined"==typeof a.iso)return'<span class="light">(undefined)</span><i class="icon btn-edit pencil"></i>';var s=a.iso?a.iso:a;return e(s,n).format(i)+'<i class="icon btn-edit pencil"></i>'},FixedDateFormatter:function(t,o,a){return"undefined"==typeof a||null==a?'<span class="light">(undefined)</span>':e(a,n).format(i)},FileFormatter:function(e,t,i){return"undefined"!=typeof i&&null!=i&&i.url?"<span>"+i.url+'</span><i class="icon btn-remove remove"></i>':'<div class="progress-bar"><div class="percent"></div></div><span class="light">(undefined)</span><i class="icon btn-edit pencil"></i><input type="file"/>'},GeoPointFormatter:function(e,t,i){if("undefined"==typeof i||null==i||"undefined"==typeof i.latitude||"undefined"==typeof i.longitude)return'<span class="light">(undefined)</span><i class="icon btn-edit pencil"></i>';var n=Math.floor(100*i.latitude)/100,o=Math.floor(100*i.longitude)/100;return n+","+o+'<i class="icon btn-edit pencil"></i>'}}}),define("core/functions/Column",["jquery","underscore","slickgrid","moment","core/functions/Editor","core/functions/ColumnFormatter"],function(e,t,i,n,o,a){function s(e,i){this.name=e,this.id=e.toLowerCase(),this.field=e,t.extend(this,i)}return{String:function(e,t){this.cssClass="cell-string",this.editor=o.Text,this.formatter=a.EmptyFormatter,this.sortable=!0,this.width=260,this.maxWidth=260,this.type="String",s.call(this,e,t),this.name="objectId"==e?e+'<span class="light">OBJECTID</span>':e+'<span class="light">STRING</span>'},Password:function(e,t){this.cssClass="cell-string",this.editor=o.Password,this.formatter=a.PasswordFormatter,this.sortable=!0,this.width=260,this.maxWidth=260,this.type="String",s.call(this,e,t),this.name=e+'<span class="light">STRING</span>'},Number:function(e,t){this.cssClass="cell-number",this.editor=o.Integer,this.width=260,this.maxWidth=260,this.type="Number",this.formatter=a.NumberFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">NUMBER</span>'},Date:function(e,t){this.cssClass="cell-date",this.editor=o.Date,this.width=260,this.maxWidth=260,this.type="Date",this.formatter=a.DateFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">DATE</span>'},File:function(e,t){this.cssClass="cell-file",this.editor=o.File,this.width=260,this.maxWidth=260,this.formatter=a.FileFormatter,this.sortable=!0,this.type="File",s.call(this,e,t),this.name=e+'<span class="light">FILE</span>'},Boolean:function(e,t){this.cssClass="cell-bool",this.editor=o.Boolean,this.width=260,this.maxWidth=260,this.type="Boolean",this.formatter=a.EmptyFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">BOOLEAN</span>'},GeoPoint:function(e,t){this.cssClass="cell-geopoint",this.editor=o.GeoPoint,this.width=260,this.maxWidth=260,this.type="GeoPoint",this.formatter=a.GeoPointFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">GEOPOINT</span>'},Array:function(e,t){this.cssClass="cell-array",this.editor=o.Array,this.width=260,this.maxWidth=260,this.type="Array",this.formatter=a.JSONFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">ARRAY</span>'},Object:function(e,t){this.cssClass="cell-object",this.editor=o.Object,this.width=260,this.maxWidth=260,this.type="Object",this.formatter=a.JSONFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">OBJECT</span>'},Pointer:function(e,t){this.cssClass="cell-pointer",this.editor=o.Pointer,this.width=260,this.maxWidth=260,this.type="Pointer",this.formatter=a.PointerFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">POINTER</span>'},Relation:function(e,t){this.cssClass="cell-relation",this.editor=null,this.width=260,this.maxWidth=260,this.type="Relation",this.formatter=a.RelationFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">RELATION</span>'},ACL:function(e,t){this.cssClass="cell-acl",this.width=260,this.maxWidth=260,this.type="ACL",this.editor=o.ACL,this.formatter=a.ACLFormatter,this.sortable=!0,s.call(this,e,t),this.name=e+'<span class="light">ACL</span>'}}}),define("modules/clouddata/main/EditorView/StringEditor/view",["underscore","component/dialog/BasicDialog"],function(e,t){return t.extend({events:{"keyup textarea":"autoCheck"},template:e.template('<div class="field"><textarea name="content"></textarea></div>'),getValue:function(){return this.$("textarea").val()},render:function(e){t.prototype.render.call(this,e),this.$("textarea").val(e.options.value)}})}),define("modules/clouddata/main/EditorView/JSONEditor/view",["jquery","underscore","core/functions/Validator","component/dialog/BasicDialog"],function(e,t,i,n){return n.extend({events:{"keyup textarea":"autoCheck"},template:t.template('<div class="field"><textarea name="content" class="validate"></textarea></div>'),getValue:function(){return this.$("textarea").val()},render:function(e){n.prototype.render.call(this,e),this.$("textarea").addClass("validate-"+e.options.type).val(e.options.value)}})}),define("tpl!modules/clouddata/main/EditorView/GeoEditor/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="ui inline field">        <label data-i18n="clouddata.tag.longitude"></label>        <input type="text" name="longitude" class="validate validate-latitude"/>    </div>    <div class="ui inline field">        <label data-i18n="clouddata.tag.latitude"></label>        <input type="text" name="latitude" class="validate validate-latitude"/>    </div>    <p class="tip" data-i18n="clouddata.tips.geo"></p></div>');return __p.join("")}}),define("modules/clouddata/main/EditorView/GeoEditor/view",["tpl!./template.html","component/dialog/BasicDialog"],function(e,t){return t.extend({events:{"keyup input":"autoCheck"},template:e,getValue:function(){return{__type:"GeoPoint",latitude:parseFloat(this.$("[name=latitude]").val()),longitude:parseFloat(this.$("[name=longitude]").val())}},render:function(e){t.prototype.render.call(this,e),e.options.value&&(this.$("[name=latitude]").val(e.options.value.latitude||0),this.$("[name=longitude]").val(e.options.value.longitude||0))}})}),define("tpl!modules/clouddata/main/EditorView/ACLEditor/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="ui form">    <div class="inline fields">        <label data-i18n="clouddata.tag.creator-type" data-tip="clouddata.tips.creator-type"></label>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="OrgUser" checked="checked">                <label>OrgUser</label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="MasterKey">                <label>MasterKey</label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="AppUser">                <label>AppUser</label>            </div>        </div>        <div class="field">            <div class="ui radio checkbox">                <input type="radio" name="acl-type" value="APIKey">                <label>APIKey</label>            </div>        </div>    </div>    <div class="field append" style="display:none;">        <label>ID</label>        <input class="validate validate-required" type="text" name="id" placeholder="e.g. 55e69ab160b2734dc034b81d "/>    </div></div>');return __p.join("")}}),define("modules/clouddata/main/EditorView/ACLEditor/view",["app","C","U","Logger","API","tpl!./template.html","component/dialog/BasicDialog","jquery"],function(e,t,i,n,o,a,s,r){var l=["OrgUser","MasterKey","AppUser","APIKey"];return s.extend({template:a,events:{"change input[name=acl-type]":"toggleType","keyup input":"autoCheck"},renderComponent:function(e){if(e.creator&&e.creator.type){var t=e.creator.type;r.inArray(t,l)>=0&&(this.$("input[value="+t+"]").prop("checked",!0),("AppUser"==t||"OrgUser"==t)&&(this.$(".field.append").show(),this.$("[name=id]").val(e.creator.id)))}else this.$(".field.append").show()},isValid:function(){var e=this.$("[name=acl-type]:checked").val();return"MasterKey"==e||"APIKey"==e?!0:s.prototype.isValid.call(this)},toggleType:function(){var e=this.$("[name=acl-type]:checked").val();"AppUser"==e||"OrgUser"==e?this.$(".field.append").show():this.$(".field.append").hide()},getValue:function(){var e=this.$("[name=acl-type]:checked").val(),t={type:e};return("AppUser"==e||"OrgUser"==e)&&(t.id=this.$("[name=id]").val()),{creator:t}},render:function(e){s.prototype.render.call(this),this.renderComponent(e.acl_value)}})}),define("tpl!modules/clouddata/main/PageGrid/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="portlet">    <div class="portlet-body">        <div class="grid-view">            <div class="grid-content" style="min-height:330px;"></div>            <div class="h-scroll left">                <i class="icon caret left"></i>            </div>            <div class="h-scroll right">                <i class="icon caret right"></i>            </div>            <div class="view-placeholder">                <div class="no-data-view-with-create" style="display:none">                    <i class="empty-icon"></i>                    <div class="empty-message" data-i18n="common.title.no-data-view"></div>                    <p data-i18n="common.tip.click-create"></p>                    <div class="action">                        <div class="ui labeled icon green button add-row">                            <i class="plus icon"></i>                            <span data-i18n="clouddata.tag.add-row"></span>                        </div>                    </div>                </div>                <div class="loading-view" style="display:none">                    <div class="loading-icon">                        <div class="cube cube1"></div>                        <div class="cube cube2"></div>                        <div class="cube cube3"></div>                        <div class="cube cube4"></div>                    </div>                </div>            </div>        </div>    </div>    <div class="pagination">        <div class="ui basic buttons perpage pull-left"></div>        <div class="ui basic buttons page pull-right" style="margin-right:50px;">            <div class="ui button prev disabled" data-i18n="common.tag.prev"></div>            <div class="ui button page-status">1 - 1</div>            <div class="ui button next disabled" data-i18n="common.tag.next"></div>        </div>    </div>   </div>');return __p.join("")}}),define("tpl!component/slickgrid/PageGrid/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="portlet">    <div class="portlet-title">        <div class="caption"></div>        <div class="tabs">            <ul class="nav nav-tabs" role="tablist">            </ul>        </div>        <div class="tools">        </div>    </div>    <div class="portlet-body">        <div class="grid-view">            <div class="grid-content" style="min-height:330px;"></div>            <div class="table-overlay"></div>            <div class="no-data-view">No Data To Display</div>        </div>    </div>    <div class="pagination">        <div class="ui basic buttons perpage pull-left"></div>        <div class="ui basic buttons page pull-right">            <div class="ui button prev disabled" data-i18n="common.tag.prev"></div>            <div class="ui button page-status">1 - 1</div>            <div class="ui button next disabled" data-i18n="common.tag.next"></div>        </div>    </div></div>');return __p.join("")}}),define("tpl!component/slickgrid/BasicGrid/template.html",function(){return function(obj){var __p=[];with(obj||{})__p.push('<div class="portlet box blue">    <div class="portlet-title">        <div class="caption">            <span class="app-icon app-icon-close"></span>            OverView        </div>        <div class="tabs">            <ul class="nav nav-tabs" role="tablist">            </ul>        </div>        <div class="tools">        </div>    </div>    <div class="portlet-body">        <div class="grid-view">            <div class="grid-content" style="min-height:330px;"></div>            <div class="table-overlay"></div>            <div class="no-data-view">No Data To Display</div>        </div>    </div></div>');return __p.join("")}}),define("component/slickgrid/BasicGrid/view",["app","U","dispatcher","tpl!./template.html","marionette","jquery","underscore","slickgrid","slick_rowselect","slick_checkbox"],function(e,t,i,n,o,a,s,r){return o.ItemView.extend({template:n,events:{},init:function(){var e=this.options.storeName;i.on("refresh:"+e,this.renderComponent,this,"Component")},beforeShow:function(){},initGrid:function(){var e=this.options.doI18n?i18n.t(this.options.title):this.options.title;this.$(".caption").html(e)},renderComponent:function(){var t=this,i=this.options.storeName,n=this.options.stateName;e.DataRepository.fetch(i,n).done(function(e){t.renderGrid(e)})},showLoading:function(){this.$(".table-overlay").show()},hideLoading:function(){this.$(".table-overlay").hide()},showNoData:function(){this.$(".no-data-view").show()},hideNoData:function(){this.$(".no-data-view").hide()},renderGrid:function(e){this.hideLoading(),e&&0!=e.length?this.hideLoading():this.showNoData(),this.grid.setData(e),this.grid.invalidate()},getValue:function(){return{}},render:function(){o.ItemView.prototype.render.call(this);var e,t=[];this.initColumn&&"function"==typeof this.initColumn?this.initColumn(t,this.options.columns):t=this.options.columns,this.options.with_checkbox&&(e=new r.CheckboxSelectColumn({cssClass:"slick-cell-checkboxsel"}),t=[e.getColumnDefinition()].concat(t)),this.grid=new r.Grid(this.$(".grid-content"),[],t,this.options.options),this.options.with_checkbox&&(this.grid.setSelectionModel(new r.RowSelectionModel({selectActiveRow:!1})),this.grid.registerPlugin(e)),this.initGrid(),this.options.static_data?this.renderComponent():this.refresh()},refresh:function(){var t=this.options.storeName;this.showLoading(),e.DataRepository.refresh(t,this.getValue())},beforeHide:function(){this.grid.destroy()}})}),define("component/slickgrid/PageGrid/view",["app","U","dispatcher","tpl!./template.html","component/slickgrid/BasicGrid/view","jquery","underscore","i18n","semanticui_dropdown"],function(e,t,i,n,o,a,s,r){return o.extend({template:n,events:{"click .perpage.buttons>.button":"changePerpage","click .page.buttons>.button":"changePage","click th.sortable":"changeSort"},beforeShow:function(){var e=this.options.valueEventName;i.on("Request.getValue:"+e,this.getValue,this,"Component")},initGrid:function(){var e=this.options.doI18n?r.t(this.options.title):this.options.title;this.$(".caption").html('<span class="app-icon app-icon-close"></span>'+e),this.options.page&&this.options.page.length>0&&this.initPage(),this.initSort()},initPage:function(){var e=this.options.page,t=[];s.forEach(e,function(e){var i=a('<div class="ui button" data-value="'+e.value+'">'+e.name+"</div>");t.push(i)}),this.pagebar={start:1,end:1},this.perpage=e[0].value,this.page=1,this.maxPage=1,this.$(".perpage.buttons").html(t),this.$(".perpage.buttons>.button[data-value="+this.perpage+"]").addClass("active")},initSort:function(){var e=this;this.grid.onSort.subscribe(function(t,i){var n=i.sortCol.field,o=i.sortAsc?1:-1;n&&(e.order={rule:o,field:n},e.refresh())}),this.order=this.options.order},changePerpage:function(e){a(e.currentTarget).is(".active")||a(e.currentTarget).is(".disabled")||(this.$(".perpage.buttons>.button").removeClass("active"),a(e.currentTarget).addClass("active"),this.perpage=parseInt(a(e.currentTarget).attr("data-value")),this.page=1,this.options.static_data?this.renderComponent():this.refresh())},changePage:function(e){a(e.currentTarget).hasClass("disabled")||(a(e.currentTarget).hasClass("prev")?this.page>1&&(a(e.currentTarget).addClass("disabled"),this.page--,this.options.static_data?this.renderComponent():this.refresh()):a(e.currentTarget).hasClass("next")&&this.page<this.maxPage&&(a(e.currentTarget).addClass("disabled"),this.page++,this.options.static_data?this.renderComponent():this.refresh()))},getValue:function(){var e=this.perpage+1,t=(this.page-1)*this.perpage,i=this.order;return{limit:e,skip:t,order:i}},renderPagebar:function(e,t){this.pagebar.start=e,this.pagebar.end=t,this.$(".page-status").text(e+" - "+t),this.$(".button.next,.button.prev").addClass("disabled"),this.maxPage>this.page&&this.$(".page.buttons>.next").removeClass("disabled"),this.page>1&&this.$(".page.buttons>.prev").removeClass("disabled")},renderGrid:function(e){var t,i;this.hideLoading(),e&&0!=e.length?this.hideLoading():this.showNoData();var n=(this.page-1)*this.perpage+1;e&&e.length>this.perpage?(this.maxPage=this.page+1,t=e.slice(0,-1),i=n+e.length-2):(this.maxPage=this.page,t=e,i=n+e.length-1),this.renderPagebar(n,i),this.grid.setData(t),this.grid.invalidate()},showNoData:function(){this.$(".no-data-view").show(),this.$(".advanced-table").hide(),this.$(".pagination").hide()},hideNoData:function(){this.$(".no-data-view").hide(),this.$(".advanced-table").show(),this.$(".pagination").show()},renderComponent:function(){var t=this,i=this.options.storeName,n=this.options.stateName;this.showLoading();var o=this.getValue();e.DataRepository.fetch(i,n,o).done(function(e){t.renderGrid(e)})},beforeHide:function(){var e=this.options.valueEventName;i.off("Request.getValue:"+e,"Component"),this.table&&this.table.destroy()}})}),define("modules/clouddata/main/PageGrid/view",["app","U","Q","core/functions/UI","core/functions/Column","core/functions/ColumnFormatter","core/functions/Editor","../EditorView/StringEditor/view","../EditorView/JSONEditor/view","../EditorView/GeoEditor/view","../EditorView/ACLEditor/view","i18n","basic/net/Uploader","Logger","tpl!./template.html","dispatcher","component/slickgrid/PageGrid/view","marionette","jquery","scrollTo","underscore","slickgrid","slick_rowselect","slick_checkbox"],function(e,t,i,n,o,a,s,r,l,c,d,u,p,h,m,f,v,g,b,y,w,_){var C=300;return v.extend({template:m,events:{"click .perpage.buttons:not(.disabled)>.button":"changePerpage","click .page.buttons>.button":"changePage","click th.sortable":"changeSort","click .h-scroll.left":"scrollLeft","click .h-scroll.right":"scrollRight","click .button.add-row":"addRow","click .cell-string>.btn-edit":"editString","click .cell-geopoint>.btn-edit":"editGeo","click .cell-file>.btn-edit":"chooseImage","change .cell-file>input[type=file]":"uploadImage","click .cell-file>.btn-remove":"removeImage","click .cell-acl>.btn-edit":"editACL","click .cell-array>.btn-edit,.cell-object>.btn-edit":"editJSON","click .cell-date>.btn-edit,.cell-number>.btn-edit,.cell-bool>.btn-edit,.cell-pointer>.btn-edit":"editGrid"},beforeShow:function(){v.prototype.beforeShow.call(this),f.on("show:Class",this.renderClass,this,"Layout"),f.on("show:Pointer",this.renderPointer,this,"Layout"),f.on("show:Relation",this.renderRelation,this,"Layout"),f.on("add:Row",this.addRow,this,"Component"),f.on("delete:Row",this.deleteRow,this,"Component"),f.on("apply:Condition",this.refreshGrid,this,"Component"),f.on("create:Class",this.createRecord,this,"Component"),f.on("Request.create:Class",this.createRecord,this,"Component"),f.on("update:Class",this.updateRecord,this,"Component"),f.on("Request.update:Class",this.updateRecord,this,"Component"),f.on("refresh:Grid",this.refreshGrid,this,"Component"),f.on("refresh:Store:Schemas",this.updateColumn,this,"Component"),f.on("Request.get:mask",this.getMask,this,"Component"),f.on("Request.get:originColumns",this.getOriginColumns,this,"Component"),f.on("Request.set:mask",this.setMask,this,"Component"),f.on("Request.set:Hscroll",this.initHorizontalScroll,this,"Component");
var e=this.options.valueEventName;f.on("Request.getValue:"+e,this.getValue,this,"Component"),b(window).bind("resize."+this.cid,this,this.resizeGrid.bind(this))},beforeHide:function(){v.prototype.beforeHide.call(this),f.off("show:Class","Layout"),f.off("show:Pointer","Layout"),f.off("show:Relation","Layout"),f.off("add:Row","Component"),f.off("delete:Row","Component"),f.off("apply:Condition","Component"),f.off("create:Class","Component"),f.off("Request.create:Class","Component"),f.off("update:Class","Component"),f.off("Request.update:Class","Component"),f.off("refresh:Grid","Component"),f.off("refresh:Store:Schemas","Component"),f.off("Request.get:mask","Component"),f.off("Request.get:originColumns","Component"),f.off("Request.set:mask","Component"),f.off("Request.set:Hscroll","Component");var e=this.options.valueEventName;f.off("Request.getValue:"+e,"Component"),b(window).unbind("resize."+this.cid),this.$(".slick-viewport").unbind("scroll."+this.cid)},initGrid:function(){this.options.page&&this.options.page.length>0&&this.initPage(),this.initSort(),this.mask=[],this.changeColumn=!0,this.columnDef=[]},initColumns:function(t){var i=[],n=this;return this.options.with_checkbox&&i.push(this.checkboxColumn.getColumnDefinition()),i.push(new o.String("objectId",{editor:s.Fixed,cssClass:"cell-fixed"})),i.push(new o.Date("createdAt",{editor:s.Fixed,cssClass:"cell-fixed",formatter:a.FixedDateFormatter})),i.push(new o.Date("updatedAt",{editor:s.Fixed,cssClass:"cell-fixed",formatter:a.FixedDateFormatter})),i.push(new o.ACL("ACL")),w.forEach(t,function(t){var n=t.type,a=e.currentClass;"Relation"==n?i.push(new o[n](t.name,{className:t.className,targetClass:t.targetClass})):"Pointer"==n?i.push(new o[n](t.name,{className:t.className})):("_User"==a&&"password"==t.name&&(n="Password"),o[n]&&i.push(new o[n](t.name)))}),this.columnDef=i,w.reject(i,function(e){return w.contains(n.mask,e.field)})},resizeGrid:function(){var e=this;this.onInterval&&clearTimeout(this.onInterval),this.onInterval=setTimeout(function(){e.resizeGridHandler()},100)},resizeGridHandler:function(){var e=b(window).height()-C;this.$(".grid-content").css("min-height",e),this.$(".grid-content").css("height",e),this.grid.invalidate(),this.initHorizontalScroll()},scrollGrid:function(){var e=this;this.onInterval&&clearTimeout(this.onInterval),this.onInterval=setTimeout(function(){e.initHorizontalScroll()},100)},getMask:function(){return this.mask},setMask:function(e){this.mask=e,this.updateColumn()},refreshGrid:function(){this.page=1,this.refresh()},addRow:function(){this.grid.getEditorLock().commitCurrentEdit();var e={};this.columnDef.forEach(function(t){"sel"!=t.field&&(e[t.field]=null)}),this.grid.setSelectedRows([]);var t=this.grid.getData();t.splice(0,0,e),this.grid.invalidate(),this.hideNoData()},deleteRow:function(){var t=this,i=this.grid.getSelectedRows();this.grid.setSelectedRows([]);var n=this.grid.getData(),o=[],a=w.reject(n,function(e,t){return w.contains(i,t)?(e.objectId&&o.push(e.objectId),!0):!1});if(this.grid.setData(a),this.grid.invalidate(),o.length>0){var s=this.options.storeName;this.isRelation?e.DataRepository.getStore(s).batchRemoveRelation(o,this.columnName,this.relationClass,this.relationId).done(function(){h.success(u.t("common.success.delete")),t.refreshGrid(),e.DataRepository.refresh("Store:Schemas")}):e.DataRepository.getStore(s).batchRemove(o).done(function(){h.success(u.t("common.success.delete")),t.refreshGrid(),e.DataRepository.refresh("Store:Schemas")})}},createRecord:function(t){var i,n=this,o=t.data,a={},s=this.options.storeName;return w.forEach(o,function(e,t){null!=e&&(a[t]=e)}),this.isRelation?(i=e.DataRepository.getStore(s).addRelationData(a,this.relationClass,this.columnName,this.relationId),i.done(function(){h.success(u.t("common.success.create")),n.refreshGrid(),e.DataRepository.refresh("Store:Schemas")})):(i=e.DataRepository.getStore(s).addData(a),i.done(function(){h.success(u.t("common.success.create")),n.refreshGrid(),e.DataRepository.refresh("Store:Schemas")})),i},updateRecord:function(t){var i,n=this,o=t.data,a=t.model.objectId,s=this.options.storeName;return a?(i=this.isRelation?e.DataRepository.getStore(s).updateRelationData(a,this.relationClass,o):e.DataRepository.getStore(s).updateData(a,o),i.done(function(){h.success(u.t("common.success.update")),n.refreshGrid()}),i):void h.error("objectId is needed")},showNoData:function(){this.$(".view-placeholder").show(),this.$(".view-placeholder>.no-data-view-with-create").show(),this.$(".pagination").hide()},hideNoData:function(){this.$(".view-placeholder").hide(),this.$(".view-placeholder>.no-data-view-with-create").hide(),this.$(".pagination").show()},showLoading:function(){this.$(".view-placeholder").show(),this.$(".view-placeholder>.loading-view").show()},hideLoading:function(){this.$(".view-placeholder").hide(),this.$(".view-placeholder>.loading-view").hide()},render:function(){g.ItemView.prototype.render.call(this),this.$el.i18n(),this.options.with_checkbox&&(this.checkboxColumn=new _.CheckboxSelectColumn({cssClass:"slick-cell-checkboxsel"}));var e=b(window).height()-C;this.$(".grid-content").css("height",e),this.grid=new _.Grid(this.$(".grid-content"),[],[],this.options.options),this.options.with_checkbox&&(this.grid.setSelectionModel(new _.RowSelectionModel({selectActiveRow:!1})),this.grid.registerPlugin(this.checkboxColumn)),this.grid.onSelectedRowsChanged.subscribe(function(e,t){f.trigger("select:Row",{disabled:0==t.rows.length},"Component")}),this.grid.onValidationError.subscribe(function(e,t){b(t.cellNode).addClass("error"),h.error(u.t(t.validationResults.msg))}),this.$(".slick-viewport").bind("scroll."+this.cid,this,this.scrollGrid.bind(this)),this.initGrid(),b("#upload-icon").bind("click.dataie",function(){(b(this).hasClass("complete")||b(this).hasClass("error"))&&(f.request("ImportClass",{isWaiting:b(this).hasClass("complete")},"Component"),b(this).removeClass("complete error"))})},getColumns:function(){var t=i.defer(),n=this,o=this.isRelation?this.relationClass:e.currentClass;return e.DataRepository.getStore("Store:Schemas").getKeysByName(o).done(function(e){n.originColumnDef=e,t.resolve(w.reject(e,function(e){return w.contains(n.mask,e.name)}))}),t.promise},getOriginColumns:function(){return this.originColumnDef},renderGrid:function(e){var t,i,n=this;this.hideLoading(),e&&0!=e.length?this.hideNoData():this.showNoData();var o=(this.page-1)*this.perpage+1;e&&e.length>this.perpage?(this.maxPage=this.page+1,t=e.slice(0,-1),i=o+e.length-2):(this.maxPage=this.page,t=e,i=o+e.length-1),this.renderPagebar(o,i),this.getColumns().done(function(e){var t=b("#data-sidebar>.container .list-item.active").attr("data-count"),i=n.initColumns(e);t>=5e5?(w.forEach(i,function(e){e.sortable=!1}),b("#data-toolbar .button.filter").unbind("click.filter").bind("click.filter",function(){return h.error(u.t("clouddata.tips.cannotsearch")),!1}),b("#data-toolbar>.ui.message").show(),C=370):(b("#data-toolbar .button.filter").unbind("click.filter"),b("#data-toolbar>.ui.message").hide(),C=300),n.resizeGrid(),n.grid.setColumns(i),n.grid.invalidate(),n.initHorizontalScroll(),n.changeColumn=!1}),this.grid.setData(t),this.changeColumn||this.grid.invalidate()},renderClass:function(t){var i=t.className,n=this.options.storeName;i&&(this.showLoading(),this.isRelation=!1,this.isPointer=!1,this.changeColumn=!0,this.page=1,this.mask=[],this.order={},this.grid.setSortColumns([]),this.grid.setSelectedRows([]),e.DataRepository.refresh(n))},renderPointer:function(t){var i=t.className,n=this.options.storeName,o=this;i&&(this.showLoading(),this.isRelation=!1,this.isPointer=!0,this.pointerId=t.objectId,this.changeColumn=!0,this.page=1,this.mask=[],this.order={},this.grid.setSortColumns([]),this.grid.setSelectedRows([]),e.DataRepository.refresh(n,{pointer:o.pointerId}))},renderRelation:function(t){var i=t.className,n=this.options.storeName,o=this;i&&(this.showLoading(),this.isRelation=!0,this.isPointer=!1,this.relationId=t.objectId,this.columnName=t.columnName,this.changeColumn=!0,this.page=1,this.mask=[],this.order={},this.grid.setSortColumns([]),this.grid.setSelectedRows([]),e.DataRepository.fetch("Store:Schemas").done(function(t){o.relationClass=o.getTargetClass(t,e.currentClass,o.columnName),e.DataRepository.refresh(n,{relation:{relationId:o.relationId,columnName:o.columnName,targetClass:o.relationClass}})}))},getValue:function(){var e=this.perpage+1,t=(this.page-1)*this.perpage,i=this.order;return this.isRelation?{limit:e,skip:t,order:i,relation:{relationId:this.relationId,columnName:this.columnName,targetClass:this.relationClass}}:this.isPointer?{limit:e,skip:t,order:i,pointer:this.pointerId}:{limit:e,skip:t,order:i}},getTargetClass:function(e,t,i){var n=w.find(e,function(e){return e.className==t}),o=w.find(n?n.keys:{},function(e,t){return t==i});return o?o.className:!1},updateColumn:function(){var e=this;this.getColumns().done(function(t){e.grid.setColumns(e.initColumns(t)),e.grid.invalidate(),e.initHorizontalScroll()})},refresh:function(){var t=this.options.storeName;this.showLoading(),e.DataRepository.refresh(t,this.getValue()),e.DataRepository.refresh("Store:Schemas",this.getValue())},initHorizontalScroll:function(){var e=this.$(".slick-viewport"),t=this.$(".slick-viewport>.grid-canvas"),i=t.width()-e.width(),n=e.scrollLeft();this.$(".h-scroll.left").toggleClass("disabled",1>=n),this.$(".h-scroll.right").toggleClass("disabled",1>=i-n)},scrollLeft:function(e){if(b(e.currentTarget).hasClass("disabled"))return!1;var t=this.$(".slick-viewport").width();this.$(".slick-viewport").scrollTo({left:"-="+t+"px",top:"+=0px"},200)},scrollRight:function(e){if(b(e.currentTarget).hasClass("disabled"))return!1;var t=this.$(".slick-viewport").width();this.$(".slick-viewport").scrollTo({left:"+="+t+"px",top:"+=0px"},200)},editACL:function(){var e=this.grid.getActiveCell(),t=this.grid.getData()[e.row];n.showDialog(u.t("clouddata.title.edit-acl"),d,{acl_value:w.extend({},t.ACL,!0),size:"small",success:function(e){if(e.isValid()){var i=e.getValue();e.showLoading(),f.request("update:Class",{model:t,data:{ACL:i}},"Component").then(function(){n.hideDialog()}).done(function(){e.hideLoading()})}}})},editGrid:function(e){b(e.currentTarget).parent().trigger("dblclick")},editString:function(){var e=this.grid.getActiveCell(),t=this.grid.getData()[e.row],i=this.grid.getColumns()[e.cell];n.showDialog("",r,{specialDialogUI:"editor",options:{value:t[i.field]},onVisible:function(){var e=this;setTimeout(function(){b(e).find("textarea").focus().select()},0)},success:function(e){var o={};o[i.field]=e.getValue(),e.showLoading(),f.request("update:Class",{model:t,data:o},"Component").then(function(){n.hideDialog()}).done(function(){e.hideLoading()})}})},editJSON:function(e){var t=b(e.currentTarget).parent().is(".cell-array")?"array":"object",i=this.grid.getActiveCell(),o=this.grid.getData()[i.row],a=this.grid.getColumns()[i.cell];n.showDialog("",l,{specialDialogUI:"editor",options:{type:t,value:o[a.field]?JSON.stringify(o[a.field]):""},onVisible:function(){var e=this;setTimeout(function(){b(e).find("textarea").focus().select()},0)},success:function(e){if(e.isValid()){var t={};t[a.field]=JSON.parse(e.getValue()),e.showLoading(),f.request("update:Class",{model:o,data:t},"Component").then(function(){n.hideDialog()}).done(function(){e.hideLoading()})}}})},editGeo:function(){var e=this.grid.getActiveCell(),t=this.grid.getData()[e.row],i=this.grid.getColumns()[e.cell];n.showDialog("",c,{specialDialogUI:"geo-editor",options:{value:t[i.field]},autofocus:!0,success:function(e){if(e.isValid()){var o={};o[i.field]=e.getValue(),e.showLoading(),f.request("update:Class",{model:t,data:o},"Component").then(function(){n.hideDialog()}).done(function(){e.hideLoading()})}}})},chooseImage:function(e){b(e.currentTarget).hasClass("disabled")||b(e.currentTarget).next("input[type=file]").click()},startUploadAnimation:function(e,t){var i=409600/t;.1>i&&(i=.1),i>.8&&(i=.8);var n,o=0,a=.5,s=.98;e.parent().unbind("dblclick.me").bind("dblclick.me",function(e){e.stopPropagation()});var r=function(){n=setTimeout(function(){o+=i,o>s&&(o=s),e.prevAll(".progress-bar").children(".percent").css("width",100*o+"%"),i>.001&&(i*=a),s>o&&r()},400)};return r(),function(){clearTimeout(n),e.parent().unbind("dblclick.me")}},uploadImage:function(e){var i=b(e.currentTarget);i.siblings(".btn-edit").hide(),i.siblings(".progress-bar").addClass("active");var n=this.grid,o=n.getColumns(),a=n.getActiveCell(),s=o[a.cell].field,r=n.getData()[a.row],l=this.startUploadAnimation(i,e.target.files[0].size),c=new p({$el:i,checkImage:!1,onSuccess:function(e){var n,o={};try{n=JSON.parse(e)}catch(a){n={}}r[s]={__type:"File",name:n.name,url:t.parseUrl(n.url)},l(),i.prevAll(".progress-bar").children(".percent").css("width","100%"),""!=r.objectId&&r.objectId?(o[s]=r[s],f.trigger("update:Class",{model:r,data:o},"Component")):(w.forEach(r,function(e,t){"objectId"!=t&&"createdAt"!=t&&"updatedAt"!=t&&(o[t]=e)}),f.trigger("create:Class",{model:r,data:o},"Component")),h.success(u.t("common.success.upload"))},onError:function(e){l(),i.prevAll(".progress-bar").addClass("error"),h.error(e)}});c.uploadFile()},removeImage:function(){var e=this.grid,t=e.getColumns(),i=e.getActiveCell(),n=t[i.cell].field,o={},a=e.getData()[i.row];a[n]={__type:"File",name:"",url:""},o[n]=a[n],f.trigger("update:Class",{model:a,data:o},"Component")}})}),define("modules/clouddata/main/layout",["C","underscore","core/functions/Formatter","../common/CloudDataLayout","../common/CloudDataContainer","../common/CloudDataToolbarContainer","text!./toolbar/filter/FilterItem.html","./headerbar/ImportData/controller","./headerbar/view","./sidebar/view","./toolbar/view","./PageGrid/view","i18n"],function(e,t,i,n,o,a,s,r,l,c,d,u,p){return{main:{constructor:n,root:"#clouddata-main",state:{"default":[{container:a,template:'<div class="container-normal"></div>',components:[{name:"import-controller",constructor:r,options:{}},{name:"data-headerbar",constructor:l,options:{table:{doI18n:!0,title:"",valueEventName:"TaskList",storeName:"Store:DataIE",page:[{value:10,name:"10"},{value:20,name:"20"},{value:30,name:"30"}],columns:[{name:"clouddata.tag.classname",field:"classNames",id:"classNames",width:250,sortable:!0,formatter:function(e,t,i){return $.isArray(i)?i.join(", "):""}},{name:"clouddata.tag.type",field:"type",id:"type",formatter:function(e,t,i){return p.t("clouddata.tag.task-type-"+i)}},{name:"clouddata.tag.process",field:"process",id:"process",formatter:function(e,t,i,n,o){var a=parseFloat(i);return isNaN(a)&&(a=0),'<span data-value="'+o.objectId+'">'+(100*a).toFixed(0)+"%</span>"}},{name:"clouddata.tag.status",field:"status",id:"status",formatter:function(e,t,i){return p.t("clouddata.tag.task-status-"+i)}},{name:"clouddata.tag.download",field:"s3path",id:"s3path",width:100,formatter:function(e,t,i,n,o){return 0==o.type?'<a class="action" href="'+i+'" target="_blank"><i class="action icon download"></i></a>':""}},{name:"clouddata.tag.logs",field:"objectId",id:"objectId",formatter:function(e,t,i){return'<a class="link btn-detail" data-value="'+i+'" href="javascript:void(0)">'+p.t("clouddata.tag.details")+"</a>"}}],options:t.extend({},e.get("UI.Table"),{doI18n:!0})}},extend:{}}]},{container:o,root:".sidebar",template:'<div class="sidebar"></div>',components:[{name:"data-sidebar",constructor:c,options:{},extend:{storeName:"Store:Schemas"}}]},{container:o,root:".content",template:'<div class="main-content"></div>',components:[{name:"data-toolbar",constructor:d,options:{filter:{childOptions:{childTemplate:s}}},extend:{}},{name:"data-page-grid",constructor:u,options:{title:"",with_checkbox:!0,valueEventName:"Page",page:[{value:100,name:"100"},{value:50,name:"50"},{value:25,name:"25"}],columns:[{name:"CreatedAt",field:"createdAt",id:"createdAt",sortable:!0},{name:"ObjectId",field:"objectId",id:"objectId",sortable:!0},{name:"String",field:"string_col",id:"string_col",sortable:!0}],options:e.get("UI.SlickGrid")},extend:{storeName:"Store:Classes"}}]}],pointer:[],relation:[]}}}}),define("modules/clouddata/router",["app","dispatcher","jquery","backbone","marionette"],function(e,t,i,n){return n.Marionette.AppRouter.extend({appRoutes:{"":"showClass","classes(/:className)":"showClass","classes/:className/:oid":"showPointer","relation/:className/:rowid/:columnName":"showRelation"},controller:{showClass:function(e){t.trigger("hide",{action:"main",state:"class"},"Layout"),t.trigger("show",{action:"main",state:"class",options:{className:e}},"Layout")},showPointer:function(e,i){t.trigger("hide",{action:"main",state:"pointer"},"Layout"),t.trigger("show",{action:"main",state:"pointer",options:{className:e,oid:i}},"Layout")},showRelation:function(e,i,n){t.trigger("hide",{action:"main",state:"relation"},"Layout"),t.trigger("show",{action:"main",state:"relation",options:{className:e,oid:i,columnName:n}},"Layout")}}})}),define("core/functions/State",["underscore","jquery"],function(e){return{page:function(t,i){if(!e.isArray(t))return[];var n,o=i.skip,a=i.limit,s=i.order,r=s.field||t.sort_key||!1;if(r){n=e.sortBy(t,function(e){return e[r]});var l=s.rule||-1;0>l&&(n=n.reverse())}else n=t;return n.slice(o,o+a)}}}),define("modules/clouddata/common/ExportStore",["C","API","data/Task","store/RestStore","Q","jquery","underscore"],function(e,t,i,n,o,a,s){var r=n.extend({updateTaskById:function(e){var t=this._origin_data.data,n=o.defer(),a=t.options.url+"/"+e;return i.create({url:a}).start().done(function(e){n.resolve(e)}),n.promise},ImportData:function(n){var a=o.defer(),s=t.get("DataIE")+"/apps/"+e.get("User.AppId")+"/import",r=i.create({url:s,method:"post",params:n});return r.start().done(function(e){3!=r.state?a.resolve(e):a.reject(e)}),a.promise},ExportData:function(n){var a=o.defer(),s=t.get("DataIE")+"/apps/"+e.get("User.AppId")+"/export",r=i.create({url:s,method:"post",params:n});return r.start().done(function(e){3!=r.state?a.resolve(e):a.reject(e)}),a.promise},getProcess:function(n){var a=o.defer(),s=t.get("DataIE")+"/tasks/"+e.get("User.AppId")+"/process",r=i.create({url:s,method:"post",params:n||[]});return r.start().done(function(e){3!=r.state?a.resolve(e):a.reject(e)}),a.promise},getLogFromTask:function(e){var n=o.defer(),r=t.get("DataIE")+"/tasks/"+e+"/log",l=i.create({url:r,formatter:function(e){if(!a.isArray(e))return{error:[],info:[]};var t=[],i=[];return s.forEach(e,function(e){"2"==e.level?t.push(a('<p class="error">'+e.createdAt+(e.seq>0?" "+e.seq+" ":"")+" "+e.message+"</p>")):"0"==e.level?i.push(a('<p class="info">'+e.createdAt+(e.seq>0?" "+e.seq+" ":"")+" "+e.message+"</p>")):"1"==e.level&&i.push(a('<p class="warning">'+e.createdAt+(e.seq>0?" "+e.seq+" ":"")+" "+e.message+"</p>"))}),{error:t,info:i}}});return l.start().done(function(e){3!=l.state?n.resolve(e):n.reject(e)}),n.promise}});return r.create=function(e){var t=new r;return 0==t.initialize(e||{})?!1:t},r}),define("modules/common/SchemaStore",["API","data/Task","store/RestStore","Q","underscore"],function(e,t,i,n,o){var a=i.extend({addKey:function(i,o,a,s){var r=n.defer(),l=e.get("Schema")+"/"+i+"/addKey",c={};c[o]={type:a},("Pointer"==a||"Relation"==a)&&(c[o].className=s);var d=t.create({url:l,method:"put",params:{keys:c}});return d.start().done(function(e){3!=d.state?r.resolve(e):r.reject(e)}),r.promise},deleteKey:function(i,o){var a=n.defer(),s=e.get("Schema")+"/"+i+"/delKey",r={};r[o]={__op:"Delete"};var l=t.create({url:s,method:"put",params:{keys:r}});return l.start().done(function(e){3!=l.state?a.resolve(e):a.reject(e)}),a.promise},getPermissionByName:function(e){var t=n.defer();return this.getData().done(function(i){var n=o.find(i,function(t){return t.className==e});t.resolve(n?n.clientPermission:{})}),t.promise},getKeysByName:function(e){var t=n.defer();return this.getData().done(function(i){var n=o.find(i,function(t){return t.className==e});t.resolve(n?o.map(n.keys,function(t,i){var n={name:i,type:t.type};return"Relation"==t.type?(n.className=e,n.targetClass=t.className):t.className&&(n.className=t.className),n}):[])}),t.promise},setPermission:function(i,o){var a=n.defer(),s=e.get("Schema")+"/"+i+"/permissions",r=t.create({url:s,method:"put",params:o});return r.start().done(function(e){3!=r.state?a.resolve(e):a.reject(e)}),a.promise}});return a.create=function(e){var t=new a;return 0==t.initialize(e||{})?!1:t},a}),define("modules/common/ClassStore",["app","API","data/Task","store/RestStore","Q","underscore"],function(e,t,i,n,o,a){var s=n.extend({updateData:function(n,s){var r=this._origin_data.data,l=o.defer(),c=this._origin_data.type;if("data"==c){var d=a.find(r,function(e){return e.id==n});a.extend(d,s),l.resolve(d)}else{var u=t.get("Class")+"/"+e.currentClass+"/"+n,p=i.create({url:u,method:"put",params:s});p.start().done(function(e){3!=p.state?l.resolve(e):l.reject(e)})}return l.promise},updateRelationData:function(e,n,s){var r=this._origin_data.data,l=o.defer(),c=this._origin_data.type;if("data"==c){var d=a.find(r,function(t){return t.id==e});a.extend(d,s),l.resolve(d)}else{var u=t.get("Class")+"/"+n+"/"+e,p=i.create({url:u,method:"put",params:s});p.start().done(function(e){3!=p.state?l.resolve(e):l.reject(e)})}return l.promise},addRelationData:function(e,n,a,s){var r=o.defer(),l=this,c=i.create({url:t.get("Class")+"/"+n,method:"post",params:e});return c.start().done(function(e){3!=c.state?l.updateRelation(a,n,e.objectId,s).done(function(e){r.resolve(e)},function(){r.reject(e)}):r.reject(e)}),r.promise},updateRelation:function(n,a,s,r){var l=o.defer(),c=JSON.parse('{"'+n+'":{"__op":"AddRelation","objects":[{"__type":"Pointer","className":"'+a+'","objectId":"'+s+'"}]}}'),d=i.create({url:t.get("Class")+"/"+e.currentClass+"/"+r,method:"put",params:c});return d.start().done(function(e){3!=d.state?l.resolve(e):l.reject(e)}),l.promise},batchRemoveRelation:function(n,s,r,l){var c=o.defer();if(!a.isArray(n)||0==n.length)throw new Error("length must gt 0");var d=[];a.forEach(n,function(e){var t={__type:"Pointer"};t.className=r,t.objectId=e,d.push(t)});var u=JSON.parse('{"'+s+'":{"__op":"RemoveRelation"}}');u[s].objects=d;var p=i.create({url:t.get("Class")+"/"+e.currentClass+"/"+l,method:"put",params:u});return p.start().done(function(e){3!=p.state?c.resolve(e):c.reject(e)}),c.promise},batchRemove:function(n){var s=o.defer();if(!a.isArray(n)||0==n.length)throw new Error("length must gt 0");var r=t.get("Data.Batch"),l=t.get("Class")+"/"+e.currentClass,c=[];a.forEach(n,function(e){c.push({method:"delete",path:l+"/"+e})});var d=i.create({url:r,method:"post",params:{requests:c}});return d.start().done(function(e){3!=d.state?s.resolve(e):s.reject(e)}),s.promise}});return s.create=function(e){var t=new s;return 0==t.initialize(e||{})?!1:t},s}),define("modules/clouddata/store",["app","C","API","dispatcher","data/Task","data/Store","core/functions/State","./common/ExportStore","../common/SchemaStore","../common/ClassStore","moment","jquery","underscore","U"],function(e,t,i,n,o,a,s,r,l,c,d,u,p,h){return[{name:"Store:Schemas",constructor:l,initialize:!0,task:o,taskOptions:{url:"Schema",formatter:function(e){return e=p.isArray(e)?e:[],p.each(e,function(e){e.className&&(e.classDisplayName=h.strEllip(e.className,25))}),e},buffer:[]}},{name:"Store:Classes",constructor:c,generator:function(t){var o={},a=n.request("getValue:Page",{},"Component")||{};o.skip=a.skip,o.limit=a.limit,a.order&&a.order.field&&(o.order=(a.order.rule>0?"-":"")+a.order.field);var s=n.request("get:condition",{},"Component")||{};return o.where=JSON.stringify(s),t.relation?(s.$relatedTo={object:{__type:"Pointer",className:e.currentClass,objectId:t.relation.relationId},key:t.relation.columnName},o.where=JSON.stringify(s),{params:o,url:i.get("Class")+"/"+t.relation.targetClass}):t.pointer?{pointer:!0,params:o,url:i.get("Class")+"/"+e.currentClass+"/"+t.pointer}:{params:o,url:i.get("Class")+"/"+e.currentClass}},initialize:!1,task:o,taskOptions:{url:"Class",formatter:function(e){return e?p.isArray(e.results)?e.results:e.objectId?[e]:[]:[]},buffer:[]}},{name:"Store:DataIE",constructor:r,initialize:!1,generator:function(e){var i={};if(e.params)i=e.params;else{var o=n.request("getValue:TaskList",{},"Component"),a=n.request("getValue:TaskCondition",{},"Component"),s={};""!=u.trim(a.search)&&(s.className={$regex:"\\Q"+u.trim(a.q)+"\\E",$options:"i"}),"all"!=a.type&&(s.type=parseInt(a.type)),s.appId=t.get("User.AppId"),"week"==a.time?s.createdAt={$gte:1e3*d().subtract(7,"days").unix()}:"month"==a.time?s.createdAt={$gte:1e3*d().subtract(1,"month").unix()}:"3month"==a.time&&(s.createdAt={$gte:1e3*d().subtract(3,"month").unix()}),o&&(i.skip=o.skip,i.limit=o.limit,i.where=JSON.stringify(s)),i.order=o.order&&o.order.field?(o.order.rule>0?"":"-")+o.order.field:"-updatedAt"}return{params:i}},task:o,taskOptions:{url:"DataIE.tasks",formatter:function(e){return e=p.isArray(e)?e:[]},buffer:[]}}]}),define("modules/clouddata/bootstrapper",["app","C","core/functions/UI","core/functions/LayoutRender","core/functions/StoreLoader","modules/common/bootstrapper","./main/layout","./router","./store","jquery","backbone","i18n"],function(e,t,i,n,o,a,s,r,l,c,d,u){a.init(!0).done(function(){var i=t.get("User.AppId");i&&t.set("Ajax.HTTPHEADER.X-LAS-AppId",i),c("#main-toolbar .module-name").append('<div class="menu-name">'+u.t("common.module.clouddata")+"</div>"),n.render(s),o.load(l),e.Router=new r,d.history.start()})}),require(["main","jquery"],function(){require(["extra"],function(){require(["modules/clouddata/bootstrapper"])})}),define("clouddataMain",function(){});